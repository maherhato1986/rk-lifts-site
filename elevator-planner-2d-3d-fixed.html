<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>RKL | Elevator 3D Viewer</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    background: #0b1220;
    overflow: hidden;
    font-family: Arial, sans-serif;
    color: #e5e7eb;
  }
  #app {
    display: grid;
    grid-template-columns: 1fr 320px;
    height: 100%;
  }
#viewer {
  width: 100%;
  height: 100%;
  position: relative;
}

  #panel {
    padding: 16px;
    background: #0e1627;
    border-left: 1px solid #1f2937;
  }
  h3 {
    margin-top: 0;
    margin-bottom: 12px;
  }
  .field {
    margin-bottom: 10px;
  }
  .field label {
    display: block;
    font-size: 12px;
    margin-bottom: 4px;
    color: #9ca3af;
  }
  .field input {
    width: 100%;
    padding: 6px 8px;
    background: #020617;
    border: 1px solid #1f2937;
    color: #fff;
    border-radius: 4px;
  }
  button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    background: #22c55e;
    border: none;
    color: #052e16;
    font-weight: bold;
    cursor: pointer;
    border-radius: 6px;
  }
</style>
</head>

<body>

<div id="app">
  <div id="viewer"></div>

  <div id="panel">
    <h3>بيانات المصعد (mm)</h3>

    <div class="field">
      <label>عرض البئر (Shaft W)</label>
      <input id="shaftW" type="number" value="3000">
    </div>

    <div class="field">
      <label>عمق البئر (Shaft D)</label>
      <input id="shaftD" type="number" value="3000">
    </div>

    <div class="field">
      <label>ارتفاع الرحلة (Travel Height)</label>
      <input id="travelH" type="number" value="12000">
    </div>

    <div class="field">
      <label>عرض الكابينة (Cabin W)</label>
      <input id="cabinW" type="number" value="2000">
    </div>

    <div class="field">
      <label>عمق الكابينة (Cabin D)</label>
      <input id="cabinD" type="number" value="2000">
    </div>

    <div class="field">
      <label>ارتفاع الكابينة (Cabin H)</label>
      <input id="cabinH" type="number" value="2200">
    </div>

    <button onclick="buildElevator()">تحديث النموذج</button>
  </div>
</div>

<!-- THREE LOCAL -->
<script src="/public/js/three/three.min.js"></script>

<script>
  let scene, camera, renderer;
  let shaftMesh, cabinMesh;

  init();
  buildElevator();
  animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0b1220);

  const viewer = document.getElementById('viewer'); // ✅ لازم أول شي

  camera = new THREE.PerspectiveCamera(
    60,
    viewer.clientWidth / viewer.clientHeight,
    1,
    50000
  );

  camera.position.set(4000, 6000, 9000);
  camera.lookAt(0, 3000, 0);

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(viewer.clientWidth, viewer.clientHeight);

  viewer.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff, 0.8));

  const dir = new THREE.DirectionalLight(0xffffff, 0.6);
  dir.position.set(3000, 8000, 5000);
  scene.add(dir);

  window.addEventListener('resize', () => {
    const w = viewer.clientWidth;
    const h = viewer.clientHeight;
    camera.aspect = w / h;
    camera.updateProjectionMatrix();
    renderer.setSize(w, h);
  });
}


  function buildElevator() {
    // remove old
    if (shaftMesh) scene.remove(shaftMesh);
    if (cabinMesh) scene.remove(cabinMesh);

    const shaftW = +shaftWInput().value;
    const shaftD = +shaftDInput().value;
    const travelH = +travelHInput().value;

    const cabinW = +cabinWInput().value;
    const cabinD = +cabinDInput().value;
    const cabinH = +cabinHInput().value;

    // Shaft
    shaftMesh = new THREE.Mesh(
      new THREE.BoxGeometry(shaftW, travelH, shaftD),
      new THREE.MeshBasicMaterial({ color: 0x00ff88, wireframe: true })
    );
    shaftMesh.position.y = travelH / 2;
    scene.add(shaftMesh);

    // Cabin
    cabinMesh = new THREE.Mesh(
      new THREE.BoxGeometry(cabinW, cabinH, cabinD),
      new THREE.MeshStandardMaterial({ color: 0xaaaaaa })
    );
    cabinMesh.position.y = cabinH / 2;
    scene.add(cabinMesh);
  }

  function animate() {
    requestAnimationFrame(animate);
    if (cabinMesh && shaftMesh) {
      cabinMesh.position.y += 4;
      if (cabinMesh.position.y > shaftMesh.geometry.parameters.height - 1000) {
        cabinMesh.position.y = cabinMesh.geometry.parameters.height / 2;
      }
    }
    renderer.render(scene, camera);
  }

  // shortcuts
  const shaftWInput = () => document.getElementById('shaftW');
  const shaftDInput = () => document.getElementById('shaftD');
  const travelHInput = () => document.getElementById('travelH');
  const cabinWInput = () => document.getElementById('cabinW');
  const cabinDInput = () => document.getElementById('cabinD');
  const cabinHInput = () => document.getElementById('cabinH');
</script>

</body>
</html>
