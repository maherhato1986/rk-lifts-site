<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù…ØµØ¹Ø¯</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f3f4f6;
            margin: 0;
            padding: 0;
        }

        .page-wrapper {
            max-width: 1100px;
            margin: 30px auto;
            padding: 16px;
        }

        .layout {
            display: grid;
            grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
            gap: 16px;
        }
        .table-wrapper {
    margin-top: 10px;
    overflow-x: auto;
}

#quotes-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

#quotes-table th,
#quotes-table td {
    padding: 6px 8px;
    border-bottom: 1px solid #e5e7eb;
    text-align: right;
    white-space: nowrap;
}

#quotes-table th {
    background: #f9fafb;
    font-weight: 600;
    color: #374151;
}


        .card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
            padding: 18px 20px;
            margin-bottom: 16px;
        }

        .card-header {
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 12px;
            padding-bottom: 6px;
        }

        .card-header h1,
        .card-header h2 {
            margin: 0;
            color: #111827;
        }

        .card-header h1 {
            font-size: 22px;
        }

        .card-header h2 {
            font-size: 18px;
        }

        .card-header p {
            margin: 4px 0 0;
            font-size: 13px;
            color: #6b7280;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 12px 14px;
        }

        label {
            display: block;
            font-size: 13px;
            color: #374151;
            margin-bottom: 4px;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            font-size: 14px;
            box-sizing: border-box;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.25);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .hint {
            font-size: 11px;
            color: #9ca3af;
            margin-top: 2px;
        }

        .section-title {
            margin: 10px 0 4px;
            font-size: 14px;
            font-weight: 600;
            color: #111827;
        }

        .inline {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        .inline input[type="checkbox"] {
            width: auto;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }

        .number-box {
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            padding: 8px 10px;
            background: #f9fafb;
        }

        .number-box .label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .number-box .value {
            font-weight: 600;
            font-size: 15px;
            color: #111827;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 11px;
            background: #ecfdf5;
            color: #166534;
            margin-right: 6px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 999px;
            border: none;
            padding: 7px 16px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.05s;
        }

        .btn-primary {
            background: #059669;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #047857;
            box-shadow: 0 4px 10px rgba(4, 120, 87, 0.25);
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #111827;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        .actions {
            margin-top: 12px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        @media (max-width: 900px) {
            .layout {
                grid-template-columns: minmax(0, 1fr);
            }
        }
    </style>
</head>
<body>
<div class="page-wrapper">

    <div class="layout">
        <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ -->
        <div>
            <div class="card">
                <div class="card-header">
                    <h1>Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù…ØµØ¹Ø¯</h1>
                    <p>ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø§Ù…Ø© Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (FUJI MRL ÙƒÙ…Ø±Ø­Ù„Ø© Ø£ÙˆÙ„Ù‰).</p>
                </div>

                <form id="quote-form">
                    <div class="section-title">Ù¡. Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø§Ù…Ø©</div>

<!-- Ù‚Ø³Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø®Ø§Ø±Ø¬ form-grid -->

<div class="section-title">Ù¡. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
<div class="form-grid">
    <div>
        <label for="customer_select">Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„Ù‹Ø§ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ (Ù…Ø­ÙÙˆØ¸ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²)</label>
        <select id="customer_select">
            <option value="">â€” Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„Ù‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€”</option>
        </select>
        <div class="hint">
            ÙŠØªÙ… Ø³Ø­Ø¨ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ù† ØµÙØ­Ø© "Ø¥Ø¶Ø§ÙØ© / Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„" (localStorage).
        </div>
    </div>

    <div>
        <label for="customer_name">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§)</label>
        <input type="text" id="customer_name" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ø§Ø¯Ø© / Ø´Ø±ÙƒØ© ...." />
    </div>

    <div>
        <label for="project_name">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input type="text" id="project_name" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…ÙƒØ§ØªØ¨ - Ø§Ù„Ø±ÙŠØ§Ø¶" />
    </div>
</div>
                    <div class="card" id="customer-details-card" style="display:none; margin-top:10px;">
    <div class="card-header">
        <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
    </div>

    <div class="form-grid" id="customer-details">
        <!-- ØªÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ -->
    </div>
</div>





                    <div class="section-title">Ù¢. Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ¹Ø¯</div>
                    <div class="form-grid">
                        <div>
                            <label for="brand">
                                Ø§Ù„Ù…Ø§Ø±ÙƒØ© / Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…
                            </label>
                            <select id="brand" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ©...</option>
                                <option value="FUJI_MRL">FUJI â€“ MRL Passenger (Ù…Ù† Ø§Ù„ØµÙŠÙ†)</option>
                                <!-- Ù„Ø§Ø­Ù‚Ù‹Ø§: Ù†Ø¶ÙŠÙ Ø®ÙŠØ§Ø±Ø§Øª Ø£Ø®Ø±Ù‰ Ù…Ø«Ù„ VERTILIFT, FUJI_HOME, Local Assembly ... -->
                            </select>
                            <div class="hint">Ø­Ø§Ù„ÙŠÙ‹Ø§ Ø§Ù„Ù…Ø±Ø¨ÙˆØ· ÙØ¹Ù„ÙŠÙ‹Ø§ Ù‡Ùˆ FUJI â€“ MRLØŒ ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ù†Ø¶ÙŠÙÙ‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ù†ÙØ³ Ø§Ù„ÙÙƒØ±Ø©.</div>
                        </div>

                        <div>
                            <label for="capacity">Ø§Ù„Ø³Ø¹Ø© (kg)</label>
                            <select id="capacity" required disabled>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¹Ø©...</option>
                            </select>
                        </div>

                        <div>
                            <label for="speed">Ø§Ù„Ø³Ø±Ø¹Ø© (m/s)</label>
                            <select id="speed" required disabled>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø±Ø¹Ø©...</option>
                            </select>
                        </div>

                        <div>
                            <label for="floors">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (Stops)</label>
                            <input type="number" id="floors" min="2" value="2" required />
                            <div class="hint">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙŠØ´Ù…Ù„ Ø¹Ø§Ø¯Ø©Ù‹ Ø¯ÙˆØ±ÙŠÙ†. Ø§Ù„Ø²ÙŠØ§Ø¯Ø© ØªÙØ­Ø³Ø¨ Ù„ÙƒÙ„ Ø¯ÙˆØ± Ø¥Ø¶Ø§ÙÙŠ.</div>
                        </div>
                    </div>
                    <div class="section-title">ğŸ“Œ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© (EN81)</div>

<table class="standard-table">
    <thead>
        <tr>
            <th>Ø§Ù„Ø­Ù…ÙˆÙ„Ø© (kg)</th>
            <th>Ù…Ù‚Ø§Ø³ Ø§Ù„ÙƒØ§Ø¨ÙŠÙ†Ø© (mm)</th>
            <th>Ù…Ù‚Ø§Ø³ Ø§Ù„Ø¨Ø¦Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (mm)</th>
            <th>Ø¨Ø§Ø¨ Ø§Ù„Ù…ØµØ¹Ø¯ (mm)</th>
            <th>Pit</th>
            <th>OH</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>450</td>
            <td>1100 Ã— 1000</td>
            <td>1700 Ã— 1500</td>
            <td>800</td>
            <td>1200</td>
            <td>3500</td>
        </tr>
        <tr>
            <td>630</td>
            <td>1100 Ã— 1400</td>
            <td>1800 Ã— 1600</td>
            <td>800</td>
            <td>1200</td>
            <td>3500</td>
        </tr>
        <tr>
            <td>800</td>
            <td>1350 Ã— 1400</td>
            <td>2000 Ã— 1600</td>
            <td>900</td>
            <td>1300</td>
            <td>3600</td>
        </tr>
        <tr>
            <td>1000</td>
            <td>1600 Ã— 1500</td>
            <td>2200 Ã— 1800</td>
            <td>900</td>
            <td>1400</td>
            <td>3700</td>
        </tr>
        <tr>
            <td>1275</td>
            <td>1800 Ã— 1600</td>
            <td>2400 Ã— 1900</td>
            <td>1100</td>
            <td>1400</td>
            <td>3800</td>
        </tr>
        <tr>
            <td>1600</td>
            <td>1800 Ã— 2000</td>
            <td>2600 Ã— 2400</td>
            <td>1100</td>
            <td>1500</td>
            <td>4000</td>
        </tr>
    </tbody>
</table>

<style>
.standard-table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0 25px 0;
    font-size: 14px;
    background: #fff;
}
.standard-table th {
    background: #f0f0f0;
    padding: 10px;
    border: 1px solid #ddd;
    font-weight: bold;
}
.standard-table td {
    padding: 8px;
    border: 1px solid #ddd;
    text-align: center;
}
</style>

              </div>

<div class="section-title">Ù¢.Ù£ ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ¨ÙŠÙ†Ù‡ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</div>
<div class="form-grid">

    <div>
        <label for="cabin_design">Ù†ÙˆØ¹ Ø§Ù„ØªØ´Ø·ÙŠØ¨ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ÙƒØ¨ÙŠÙ†Ù‡</label>
        <select id="cabin_design">
            <option value="">â€” Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØµÙ…ÙŠÙ… â€”</option>
            <option value="SS304-Hairline">Ø³ØªØ§Ù†Ù„Ø³ Ø³ØªÙŠÙ„ 304 â€“ Hairline</option>
            <option value="SS304-Mirror">Ø³ØªØ§Ù†Ù„Ø³ Ø³ØªÙŠÙ„ 304 â€“ Ù…Ø±Ø§ÙŠØ§</option>
            <option value="Mirror-SS304">Ù…Ø±Ø§ÙŠØ§ + Ø³ØªØ§Ù†Ù„Ø³</option>
            <option value="Wood-SS304">Ø®Ø´Ø¨ÙŠ + Ø³ØªØ§Ù†Ù„Ø³</option>
            <option value="Custom">ØªØµÙ…ÙŠÙ… Ø®Ø§Øµ (Custom)</option>
        </select>
    </div>

    <div>
        <label for="floor_finish">ØªØ´Ø·ÙŠØ¨ Ø§Ù„Ø£Ø±Ø¶ÙŠØ©</label>
        <select id="floor_finish">
            <option value="">â€” Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø£Ø±Ø¶ÙŠØ© â€”</option>
            <option value="Vinyl">ÙÙŠÙ†ÙŠÙ„</option>
            <option value="Granite">Ø¬Ø±Ø§Ù†ÙŠØª</option>
            <option value="Marble">Ø±Ø®Ø§Ù…</option>
            <option value="Aluminum-Checker">Ø£Ù„Ù…Ù†ÙŠÙˆÙ… Checker Plate</option>
        </select>
    </div>

</div>

                        <div class="section-title">Ù¢.Ù¡ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª</div>
<div class="form-grid">
    <div>
        <label for="lifts_count">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯ Ø¨Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª</label>
        <input type="number" id="lifts_count" min="1" value="1" />
        <div class="hint">
            Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¹Ø¯ Ø¨Ù†ÙØ³ Ø§Ù„Ø­Ù…ÙˆÙ„Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±ØŒ Ø¶Ø¹ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù‡Ù†Ø§ (Ù…Ø«Ø§Ù„: 5 Ù…ØµØ§Ø¹Ø¯).
            Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…ÙˆØ§ØµÙØ§Øª Ù…Ø®ØªÙ„ÙØ©ØŒ Ø§Ø­Ø³Ø¨ ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù„ÙˆØ­Ø¯Ù‡Ø§ (Ù…Ø«Ø§Ù„: 3 Ã— 800kg Ø«Ù… 2 Ã— 1000kg).
        </div>
    </div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ù„ÙƒÙ„ Ù…ØµØ¹Ø¯ -->
<div id="shaft-table-container" style="margin-top:20px; display:none;">
    <h3>âš™ï¸ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…ØµØ§Ø¹Ø¯</h3>
    <table class="table" id="shaft-table">
        <thead>
            <tr>
                <th>Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ¹Ø¯</th>
                <th>Ù…Ù‚Ø§Ø³ Ø§Ù„Ø¨Ø¦Ø± (Shaft)</th>
                <th>Ø§Ù„ÙƒØ§Ø¨ÙŠÙ†Ø© (Cabin)</th>
                <th>Ø§Ù„Ø¨Ø§Ø¨ (Door)</th>
                <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

                    <div class="section-title">Ù£. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ±</div>
                    <div class="form-grid">
                        <div>
                            <label for="currency">Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø­Ø³Ø§Ø¨</label>
                            <select id="currency">
                                <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)</option>
                                <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                            </select>
                        </div>

                        <div>
                            <label for="vat_rate">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© %</label>
                            <input type="number" id="vat_rate" value="15" step="0.1" />
                        </div>

                        <div>
                            <label>Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                            <div class="inline">
                                <input type="checkbox" id="include_vat" checked />
                                <label for="include_vat" style="margin: 0;">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</label>
                            </div>
                        </div>
                    </div>

                    <div class="actions">
                        <button type="button" class="btn btn-primary" id="calc-btn">Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±</button>
                        <button type="reset" class="btn btn-secondary" id="reset-btn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                    </div>
                </form>
            </div>

            <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© -->
            <div class="card">
                <div class="card-header">
                    <h2>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h2>
                </div>

                <div id="numbers-wrapper">
                    <div class="hint">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© Ø«Ù… Ø§Ø¶ØºØ· "Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±" Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„.</div>
                </div>
            </div>
        </div>

        <!-- Ø¨Ø·Ø§Ù‚Ø© Ù…Ù„Ø®Øµ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†ØµÙŠ -->
        <div>
            <div class="card">
                <div class="card-header">
                    <h2>Ù…Ù„Ø®Øµ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± (Ù†ØµÙŠ)</h2>
                    <p>ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ ÙˆÙ„ØµÙ‚Ù‡ ÙÙŠ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø±Ø³Ù…ÙŠ Ø£Ùˆ Ù…Ù„Ù Word.</p>
                </div>

                <textarea id="quote_text" placeholder="Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù†Øµ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨..."></textarea>

                <div class="actions">
                    <button type="button" class="btn btn-secondary" id="copy-btn">Ù†Ø³Ø® Ø§Ù„Ù†Øµ</button>
                </div>
            </div>
        </div>
    </div>
</div>
            <!-- Ø¨Ø·Ø§Ù‚Ø© Ø³Ø¬Ù„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
        <div style="margin-top: 16px;">
            <div class="card">
                <div class="card-header">
                    <h2>Ø³Ø¬Ù„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²</h2>
                    <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø«Ù… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø¥Ù„Ù‰ Ù…Ù„Ù Excel (CSV).</p>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-primary" id="save-quote-btn">
                        Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
                    </button>
                    <button type="button" class="btn btn-secondary" id="export-quotes-btn">
                        ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„ Ø¥Ù„Ù‰ Excel (CSV)
                    </button>
                    <button id="printOfferButton" type="button">
    Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±
</button>

                </div>

                <div class="table-wrapper">
                    <table id="quotes-table">
                        <thead>
                          <tr>
  
<tr>
    <th>âœ“</th>
    <th>#</th>
    <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶</th>
    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>

    <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
    <th>Ù†ÙˆØ¹Ù‡</th>
    <th>Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
    <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
    <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
    <th>Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</th>
    <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</th>
    <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>

    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
   <th>Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª</th>
<th>Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…ØµØ§Ø¹Ø¯</th>
<th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯</th>
<th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø´Ø§Ù…Ù„)</th>

</tr>
</thead>

                        <tbody>
                            <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

<script>
    // ======================= Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ø­Ø³Ø¨Ø© (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§) =======================
const COST_PARAMS = {
    shippingUsdPerLift: 500,
    insurancePercent: 1,
    clearanceSar: 1200,
    inlandTransportSar: 1500,
    installationSar: 9000,   // â† Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    commissioningSar: 2000,  // â† Ø¹Ø¯Ù‘Ù„ Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ
    overheadPercent: 12,     // â† Ù„Ùˆ ØªØ±ÙŠØ¯ ØªÙ‚Ù„ÙŠÙ„ Ø£Ùˆ Ø±ÙØ¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©
    profitPercent: 25
};
const CABIN_DESIGN_ADDITIONAL = {
    "SS304-Hairline": 0,
    "SS304-Mirror": 2500,
    "Mirror-SS304": 4000,
    "Wood-SS304": 6000,
    "Custom": 10000
};


        // ØªØ®Ø²ÙŠÙ† Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    const QUOTES_STORAGE_KEY = 'rkl_quotes';
    let lastQuoteSnapshot = null; // Ø¢Ø®Ø± Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù…Ø­Ø³ÙˆØ¨ (Ù„Ù†Ø­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„)


    // ========================== Ø±Ø¨Ø· ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ==========================
    function renderCustomerDetails(customer) {
    const card = document.getElementById('customer-details-card');
    const container = document.getElementById('customer-details');

    if (!card || !container) return;

    // Ù„Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…ÙŠÙ„
    if (!customer) {
        card.style.display = 'none';
        container.innerHTML = '';
        return;
    }

    const fields = [
        { label: 'Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„', value: customer.customer_type },
        { label: 'Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', value: customer.contact_person },
        { label: 'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', value: customer.id_number },
        { label: 'Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ', value: customer.cr_number },
        { label: 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ', value: customer.tax_number },
        { label: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', value: customer.city },
        { label: 'Ø§Ù„Ø­ÙŠ', value: customer.district },
        { label: 'Ø§Ù„Ø´Ø§Ø±Ø¹', value: customer.street },
        { label: 'Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰', value: customer.building_no },
        { label: 'Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ', value: customer.postal_code },
        { label: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„', value: customer.full_address },
        { label: 'Ø§Ù„Ø¬ÙˆØ§Ù„', value: customer.mobile },
        { label: 'Ø§Ù„Ù‡Ø§ØªÙ', value: customer.phone },
        { label: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', value: customer.email },
        { label: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª', value: customer.notes }
    ];

    container.innerHTML = '';

    fields.forEach(f => {
        if (!f.value) return;

        const div = document.createElement('div');
        div.innerHTML = `
            <strong>${f.label}:</strong>
            <div style="color:#374151;font-size:13px;">${f.value}</div>
        `;
        container.appendChild(div);
    });

    card.style.display = 'block';
}

    const CUSTOMER_STORAGE_KEY = 'rkl_customers';

    let currentBrandData = null;
    let selectedCustomer = null; // Ø¢Ø®Ø± Ø¹Ù…ÙŠÙ„ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬

    function loadStoredCustomers() {
        try {
            return JSON.parse(localStorage.getItem(CUSTOMER_STORAGE_KEY) || '[]');
        } catch (e) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† localStorage', e);
            return [];
        }
    }

    function populateCustomerDropdown() {
        const select = document.getElementById('customer_select');
        if (!select) return;

        const customers = loadStoredCustomers();

        select.innerHTML = '<option value="">â€” Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„Ù‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€”</option>';

        customers.forEach((c, index) => {
            const name = c.customer_name || '(Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…)';
            const city = c.city ? ` - ${c.city}` : '';
            const opt = document.createElement('option');
            opt.value = index.toString();
            opt.textContent = `${name}${city}`;
            select.appendChild(opt);
        });

        if (!customers.length) {
            const opt = document.createElement('option');
            opt.value = '';
            opt.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­';
            select.appendChild(opt);
            select.disabled = true;
        } else {
            select.disabled = false;
        }
    }

    function applyCustomerToForm(customer) {
    selectedCustomer = customer || null;

    if (customer) {
        document.getElementById('customer_name').value = customer.customer_name || '';

        const projectInput = document.getElementById('project_name');
        if (projectInput && !projectInput.value) {
            projectInput.value = `Ù…Ø´Ø±ÙˆØ¹ Ù„Ù„Ø¹Ù…ÙŠÙ„ ${customer.customer_name}`;
        }

        renderCustomerDetails(customer); // âœ… Ù‡Ù†Ø§ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    } else {
        renderCustomerDetails(null);
    }
}


        // ========================== ØªØ®Ø²ÙŠÙ† Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙŠ LocalStorage ==========================

    function loadStoredQuotes() {
        try {
            return JSON.parse(localStorage.getItem(QUOTES_STORAGE_KEY) || '[]');
        } catch (e) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ù† localStorage', e);
            return [];
        }
    }

  function saveQuotesToStorage(quotes) {
    try {
        localStorage.setItem(QUOTES_STORAGE_KEY, JSON.stringify(quotes));
    } catch (e) {
        console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:", e);
        alert("ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².");
    }
}


  function renderQuotesTable() {
    const tbody = document.querySelector('#quotes-table tbody');
    if (!tbody) return;

    const quotes = loadStoredQuotes();
    tbody.innerHTML = '';

    // âœ… ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¹Ø±ÙˆØ¶
    if (!quotes.length) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 18;
        td.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø£Ø³Ø¹Ø§Ø± Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.';
        td.style.textAlign = 'center';
        td.style.color = '#9ca3af';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
    }

    // âœ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
    quotes.forEach((q, index) => {
        const tr = document.createElement('tr');

        // ğŸŸ© 1) Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± (Checkbox)
        const tdCheck = document.createElement('td');
        tdCheck.innerHTML = `
            <input 
                type="checkbox" 
                class="quote-check" 
                data-index="${index}"
            >
        `;
        tr.appendChild(tdCheck);

        const dateStr = q.timestamp ? q.timestamp.slice(0, 10) : '';
        const totalStr = formatCurrency(q.totalWithVat, q.currency || 'SAR');

        // ğŸŸ© 2) Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
        const cd = q.customerDetails || {};

const cols = [
    index + 1,
    q.quoteNumber || '',
    dateStr,

    q.customerName || '',
    cd.customer_type || '',
    cd.contact_person || '',
    cd.mobile || '',
    cd.email || '',
    cd.cr_number || '',
    cd.tax_number || '',
    cd.city || '',

    q.projectName || '',
    `${q.brandLabel || q.brandKey} / ${q.capacity} / ${q.speed}`,

    // âœ… Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª
    (q.shaftsSummary && q.shaftsSummary.length)
        ? q.shaftsSummary.join(' | ')
        : 'â€”',

    q.liftsCount || '',
    totalStr
];



        cols.forEach(val => {
            const td = document.createElement('td');
            td.textContent = val;
            tr.appendChild(td);
        });

        tbody.appendChild(tr);
    });
}




    // ========================== ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª ÙˆÙ…Ù„ÙØ§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ==========================
    const BRAND_SOURCES = {
    'FUJI_MRL': {
        label: 'FUJI â€“ MRL Passenger',
        jsonPath: '/fuji_mrl_prices.json'
    }
};


    async function loadBrandData(brandKey) {
        const config = BRAND_SOURCES[brandKey];
        if (!config) {
            currentBrandData = null;
            return null;
        }

        const res = await fetch(config.jsonPath);
        if (!res.ok) {
            alert('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ù„Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.');
            currentBrandData = null;
            return null;
        }

        const data = await res.json();
        currentBrandData = data;
        return data;
    }

    function fillCapacityOptions() {
        const capacitySelect = document.getElementById('capacity');
        const speedSelect = document.getElementById('speed');

        capacitySelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¹Ø©...</option>';
        speedSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø±Ø¹Ø©...</option>';
        speedSelect.disabled = true;

        if (!currentBrandData || !currentBrandData.models) {
            capacitySelect.disabled = true;
            return;
        }

        const capacities = Array.from(
            new Set(currentBrandData.models.map(m => m.capacityKg))
        );

        capacities.forEach(cap => {
            const opt = document.createElement('option');
            opt.value = cap;
            opt.textContent = cap + ' kg';
            capacitySelect.appendChild(opt);
        });

        capacitySelect.disabled = false;
    }

function fillSpeedOptions() {
    const capacitySelect = document.getElementById('capacity');
    const speedSelect = document.getElementById('speed');

    const selectedCapacity = capacitySelect.value;
    speedSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø±Ø¹Ø©...</option>';

    if (!currentBrandData || !selectedCapacity) {
        speedSelect.disabled = true;
        return;
    }

    // ğŸ”¥ Ø¯Ø¹Ù… Ø§Ù„Ø³Ø¹Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù…Ø«Ù„ 320-450
    const speeds = Array.from(
        new Set(
            currentBrandData.models
                .filter(m => {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø³Ø¹Ø© Ù…Ø«Ù„ 320-450
                    if (m.capacityKg.includes('-')) {
                        const [min, max] = m.capacityKg.split('-').map(Number);
                        return Number(selectedCapacity) >= min && Number(selectedCapacity) <= max;
                    }
                    // Ø³Ø¹Ø§Øª Ù…ÙØ±Ø¯Ø©
                    return m.capacityKg === selectedCapacity;
                })
                .map(m => m.speedMps)
        )
    ).sort((a, b) => a - b);

    speeds.forEach(sp => {
        const opt = document.createElement('option');
        opt.value = sp;
        opt.textContent = sp + ' m/s';
        speedSelect.appendChild(opt);
    });

    speedSelect.disabled = false;
}


    function findModel(capacity, speed) {
        if (!currentBrandData || !currentBrandData.models) return null;
        return currentBrandData.models.find(
            m => m.capacityKg === capacity && Number(m.speedMps) === Number(speed)
        );
    }

    function formatCurrency(value, currency) {
        if (isNaN(value)) return '-';
        const v = Number(value).toFixed(2);
        return currency === 'USD'
            ? `${v} USD`
            : `${v} SAR`;
    }

    function generateNumbersView(result, model, currency) {
        const wrapper = document.getElementById('numbers-wrapper');

        const per = (v) => formatCurrency(v, currency);
        const both = (perLift, total) =>
            `${per(perLift)} <span style="font-size:11px;color:#6b7280;">/ Ù„ÙƒÙ„ Ù…ØµØ¹Ø¯</span><br>` +
            `${per(total)} <span style="font-size:11px;color:#6b7280;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ (${result.liftsCount})</span>`;

        wrapper.innerHTML = `
        <div class="numbers-grid">
            <div class="number-box">
                <div class="label">Ø³Ø¹Ø± Ø§Ù„Ù…ØµÙ†Ø¹ (FOB)</div>
                <div class="value">
                    ${both(result.factoryCostPerLift, result.factoryCost)}
                </div>
            </div>

            <div class="number-box">
                <div class="label">Ø§Ù„Ø´Ø­Ù† + Ø§Ù„ØªØ£Ù…ÙŠÙ†</div>
                <div class="value">
                    ${both(result.shippingInsurancePerLift, result.shippingInsuranceCost)}
                </div>
            </div>

            <div class="number-box">
                <div class="label">Ø§Ù„ØªØ®Ù„ÙŠØµ + Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</div>
                <div class="value">
                    ${both(result.clearanceTransportPerLift, result.clearanceTransportCost)}
                </div>
            </div>

            <div class="number-box">
                <div class="label">Ø§Ù„ØªØ±ÙƒÙŠØ¨ + Ø§Ù„ØªØ´ØºÙŠÙ„</div>
                <div class="value">
                    ${both(result.installationCommissioningPerLift, result.installationCommissioningCost)}
                </div>
            </div>

            <div class="number-box">
                <div class="label">Ù…ØµØ§Ø±ÙŠÙ ØªØ´ØºÙŠÙ„ (${result.overheadPercent}%)</div>
                <div class="value">
                    ${both(result.overheadPerLift, result.overheadCost)}
                </div>
            </div>

            <div class="number-box">
                <div class="label">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø¨Ø­</div>
                <div class="value">
                    ${both(result.costBeforeProfitPerLift, result.costBeforeProfit)}
                </div>
            </div>

            <div class="number-box">
                <div class="label">Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (${result.profitPercent}%)</div>
                <div class="value">
                    ${both(result.profitPerLift, result.profitAmount)}
                </div>
            </div>

            <div class="number-box">
                <div class="label">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</div>
                <div class="value">
                    ${both(result.totalBeforeVatPerLift, result.totalBeforeVat)}
                </div>
            </div>

            <div class="number-box">
                <div class="label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (${result.vatRate}%)</div>
                <div class="value">
                    ${both(result.vatAmountPerLift, result.vatAmount)}
                </div>
            </div>

            <div class="number-box">
                <div class="label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${result.includeVat ? 'Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©' : 'Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©'}</div>
                <div class="value">
                    ${both(result.totalWithVatPerLift, result.totalWithVat)}
                </div>
            </div>
        </div>

        <div style="margin-top: 10px; font-size: 12px; color:#6b7280;">
            <span class="badge">${BRAND_SOURCES[result.brandKey].label}</span>
            Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯: ${result.liftsCount} â€“ Ø³Ø¹Ø© ${model.capacityKg} kg â€“ Ø³Ø±Ø¹Ø© ${model.speedMps} m/s â€“ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: ${result.floors} (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ${model.baseFloors} Ø¯ÙˆØ±).
        </div>
    `;
    }

    function generateQuoteText(result, model, currency) {
        const manualCustomerName = document.getElementById('customer_name').value.trim();
        const projectName = document.getElementById('project_name').value.trim();

        const currencyLabel = currency === 'USD' ? 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ' : 'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ';
        const finalCustomerName = selectedCustomer?.customer_name || manualCustomerName || 'Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„ÙƒØ±ÙŠÙ…';

        const lines = [];

        lines.push(`Ø§Ù„Ø³Ø§Ø¯Ø© / ${finalCustomerName}`);
        if (projectName) {
            lines.push(`Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: Ø¹Ø±Ø¶ Ø³Ø¹Ø± ØªÙˆØ±ÙŠØ¯ ÙˆØªØ±ÙƒÙŠØ¨ Ù…ØµØ¹Ø¯ Ù„Ù…Ø´Ø±ÙˆØ¹ (${projectName}).`);
        } else {
            lines.push(`Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: Ø¹Ø±Ø¶ Ø³Ø¹Ø± ØªÙˆØ±ÙŠØ¯ ÙˆØªØ±ÙƒÙŠØ¨ Ù…ØµØ¹Ø¯.`);
        }

        lines.push('');
        lines.push(`Ù†ÙˆØ¯ Ø£Ù† Ù†Ø´ÙƒØ±ÙƒÙ… Ø¹Ù„Ù‰ ØªÙˆØ§ØµÙ„ÙƒÙ… Ù…Ø¹ Ù…Ø¤Ø³Ø³Ø© Ø¢Ø± ÙƒÙŠ Ø§Ù„ RKLØŒ ÙˆÙŠØ³Ø±Ù‘Ù†Ø§ Ø£Ù† Ù†Ù‚Ø¯Ù‘Ù… Ù„ÙƒÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ØªØ§Ù„ÙŠ:`);

        if (selectedCustomer) {
            lines.push('');
            lines.push(`Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¬Ù‘Ù„Ø© Ù„Ø¯ÙŠÙ†Ø§:`);
            if (selectedCustomer.customer_type === 'company') {
                lines.push(`- Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„: Ø´Ø±ÙƒØ© / Ù…Ø¤Ø³Ø³Ø©.`);
            } else if (selectedCustomer.customer_type === 'individual') {
                lines.push(`- Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„: ÙØ±Ø¯.`);
            }
            if (selectedCustomer.contact_person) {
                lines.push(`- Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø®ÙˆÙ‘Ù„ Ø¨Ø§Ù„ØªÙˆÙ‚ÙŠØ¹: ${selectedCustomer.contact_person}`);
            }
            if (selectedCustomer.cr_number) {
                lines.push(`- Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ: ${selectedCustomer.cr_number}`);
            }
            if (selectedCustomer.tax_number) {
                lines.push(`- Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ: ${selectedCustomer.tax_number}`);
            }
            const addrParts = [
                selectedCustomer.city,
                selectedCustomer.district,
                selectedCustomer.street,
                selectedCustomer.full_address
            ].filter(Boolean);
            if (addrParts.length) {
                lines.push(`- Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${addrParts.join(' - ')}`);
            }
            if (selectedCustomer.mobile) {
                lines.push(`- Ø¬ÙˆØ§Ù„ Ø±Ù‚Ù…: ${selectedCustomer.mobile}`);
            }
            if (selectedCustomer.email) {
                lines.push(`- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${selectedCustomer.email}`);
            }
        }

        lines.push(``);
        lines.push(`1) Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¹Ø¯:`);
        lines.push(`- Ø§Ù„Ù…Ø§Ø±ÙƒØ©: ${BRAND_SOURCES[result.brandKey].label}`);
        lines.push(`- Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª: ${result.liftsCount} Ù…ØµØ¹Ø¯/Ù…ØµØ§Ø¹Ø¯.`);
        lines.push(`- Ø§Ù„Ø³Ø¹Ø©: ${model.capacityKg} kg`);
        lines.push(`- Ø§Ù„Ø³Ø±Ø¹Ø©: ${model.speedMps} m/s`);
        lines.push(`- Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: ${result.floors} Ø¯ÙˆØ± (Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„Ù…ØµÙ†Ø¹ ÙŠØ´Ù…Ù„ ${model.baseFloors} Ø¯ÙˆØ±).`);

        lines.push('');
        lines.push(`2) Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙƒÙ„ÙØ© (${currencyLabel}):`);
        lines.push(`- Ø³Ø¹Ø± Ø§Ù„Ù…ØµÙ†Ø¹ (FOB): ${formatCurrency(result.factoryCost, currency)}`);
        lines.push(`- Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªØ£Ù…ÙŠÙ†: ${formatCurrency(result.shippingInsuranceCost, currency)}`);
        lines.push(`- Ø§Ù„ØªØ®Ù„ÙŠØµ Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠ + Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ: ${formatCurrency(result.clearanceTransportCost, currency)}`);
        lines.push(`- Ø£Ø¬ÙˆØ± Ø§Ù„ØªØ±ÙƒÙŠØ¨ ÙˆØ§Ù„ØªØ´ØºÙŠÙ„: ${formatCurrency(result.installationCommissioningCost, currency)}`);
        lines.push(`- Ù…ØµØ§Ø±ÙŠÙ ØªØ´ØºÙŠÙ„ (${result.overheadPercent}%): ${formatCurrency(result.overheadCost, currency)}`);
        lines.push(`- Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø¨Ø­: ${formatCurrency(result.costBeforeProfit, currency)}`);
        lines.push(`- Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (${result.profitPercent}%): ${formatCurrency(result.profitAmount, currency)}`);

        lines.push('');
        lines.push(`3) Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (${currencyLabel}):`);
        lines.push(`- Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: ${formatCurrency(result.totalBeforeVat, currency)}`);
        lines.push(`- Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ù„Ù„Ù…ØµØ¹Ø¯ Ø§Ù„ÙˆØ§Ø­Ø¯: ${formatCurrency(result.totalBeforeVatPerLift, currency)}`);
        lines.push(`- Ù‚ÙŠÙ…Ø© Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© (${result.vatRate}%): ${formatCurrency(result.vatAmount, currency)}`);
        lines.push(`- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${result.includeVat ? 'Ø´Ø§Ù…Ù„' : 'Ø¨Ø¯ÙˆÙ†'} Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©: ${formatCurrency(result.totalWithVat, currency)}.`);

        lines.push('');
        lines.push(`*Ù…Ù„Ø§Ø­Ø¸Ø§Øª:*`);
        lines.push(`- Ø¨Ù„Ø¯ Ø§Ù„Ù…Ù†Ø´Ø£: ${model.notes || 'Ø­Ø³Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµÙ†Ø¹'}.`);
        lines.push(`- Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø©: ${model.machineType || 'Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª'} â€“ Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨: ${model.doorType || 'Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙÙ†ÙŠ'}.`);
        lines.push(`- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ø§ ØªØ´Ù…Ù„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠØ© ÙˆØ§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ù†ÙØµÙ‘ Ø¹Ù„Ù‰ Ø®Ù„Ø§Ù Ø°Ù„Ùƒ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙÙ†ÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ.`);
        lines.push('');
        lines.push(`Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ù…Ø¨Ø¯Ø¦ÙŠØŒ ÙˆÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆÙ…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠ ÙˆØ´Ø±ÙˆØ· Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.`);
        lines.push('');
        lines.push(`Ù…Ø¹ Ø®Ø§Ù„Øµ Ø§Ù„ØªØ­ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±ØŒ`);
        lines.push(`Ù…Ø¤Ø³Ø³Ø© Ø¢Ø± ÙƒÙŠ Ø§Ù„ RKL Ù„Ù„Ù…ØµØ§Ø¹Ø¯ ÙˆØ§Ù„Ø³Ù„Ø§Ù„Ù… Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©.`);

        document.getElementById('quote_text').value = lines.join('\n');
    }

    async function calculateQuote() {
        const brandKey = document.getElementById('brand').value;
        const capacity = document.getElementById('capacity').value;
        const speed = document.getElementById('speed').value;
        const floors = Number(document.getElementById('floors').value);
        const liftsCount = Number(document.getElementById('lifts_count').value) || 1;
        const currency = document.getElementById('currency').value;
        const vatRate = Number(document.getElementById('vat_rate').value) || 0;
        const includeVat = document.getElementById('include_vat').checked;
     


        if (!brandKey || !capacity || !speed || !floors || floors < 2 || liftsCount < 1) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ Ø£Ø¯ÙˆØ§Ø± ØµØ­ÙŠØ­ (Ù¢ ÙØ£ÙƒØ«Ø±) ÙˆØ¹Ø¯Ø¯ Ù…ØµØ§Ø¹Ø¯ ÙˆØ§Ø­Ø¯ ÙØ£ÙƒØ«Ø±.');
            return;
        }

        if (!currentBrandData) {
    await loadBrandData(brandKey);
}

if (!currentBrandData) {
    console.log("âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ø±ÙƒØ©");
    return;
}

        const model = findModel(capacity, speed);
        if (!model) {
            alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙ„ÙŠÙØ© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ÙÙŠ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¹Ø§Ø±.');
            return;
        }

        const rate = currentBrandData.exchangeRateToSAR || 1;

        // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø³Ø¹Ø± Ø§Ù„Ù…ØµÙ†Ø¹
        const extraFloors = Math.max(0, floors - model.baseFloors);

        // 1) Ø³Ø¹Ø± Ø§Ù„Ù…ØµÙ†Ø¹ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± + Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ù„ÙƒÙ„ Ø¯ÙˆØ± Ø¥Ø¶Ø§ÙÙŠ
        const factoryUsd = model.basePriceUsd + (model.extraPerFloorUsd * extraFloors);

        // ØªØ­ÙˆÙŠÙ„ Ù„Ø³Ø¹ÙˆØ¯ÙŠ
        const factorySar = factoryUsd * rate;

        // 2) Ø§Ù„Ø´Ø­Ù† + Ø§Ù„ØªØ£Ù…ÙŠÙ†
        const shippingSar = COST_PARAMS.shippingUsdPerLift * rate;
        const insuranceSar = factoryUsd * (COST_PARAMS.insurancePercent / 100) * rate;
        const shippingInsuranceSar = shippingSar + insuranceSar;

        // 3) Ø§Ù„ØªØ®Ù„ÙŠØµ + Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ
        const clearanceTransportSar = COST_PARAMS.clearanceSar + COST_PARAMS.inlandTransportSar;

        // 4) Ø§Ù„ØªØ±ÙƒÙŠØ¨ + Ø§Ù„ØªØ´ØºÙŠÙ„
        const installationCommissioningSar = COST_PARAMS.installationSar + COST_PARAMS.commissioningSar;

        // 5) Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ù‚Ø¨Ù„ Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„
        const directCostSar =
            factorySar +
            shippingInsuranceSar +
            clearanceTransportSar +
            installationCommissioningSar;
        const cabinDesign = document.getElementById("cabin_design").value;
const cabinExtraCost = CABIN_DESIGN_ADDITIONAL[cabinDesign] || 0;

const directCostSarFinal = directCostSar + cabinExtraCost;


        // 6) Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„
        const overheadSar = directCostSarFinal * (COST_PARAMS.overheadPercent / 100);



        // 7) ØªÙƒÙ„ÙØ© Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø¨Ø­
        const costBeforeProfitSar = directCostSarFinal + overheadSar;


        // 8) Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­
        const profitSar = costBeforeProfitSar * (COST_PARAMS.profitPercent / 100);

        // 9) Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
        const totalBeforeVatSar = costBeforeProfitSar + profitSar;

        // ØªØ­ÙˆÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© (Ù„Ù„Ù…ØµØ¹Ø¯ Ø§Ù„ÙˆØ§Ø­Ø¯)
        const divisor = (currency === 'USD') ? rate : 1;

        const factoryCostPerLift = factorySar / divisor;
        const shippingInsurancePerLift = shippingInsuranceSar / divisor;
        const clearanceTransportPerLift = clearanceTransportSar / divisor;
        const installationCommissioningPerLift = installationCommissioningSar / divisor;
        const overheadPerLift = overheadSar / divisor;
        const costBeforeProfitPerLift = costBeforeProfitSar / divisor;
        const profitPerLift = profitSar / divisor;
        const totalBeforeVatPerLift = totalBeforeVatSar / divisor;

        const vatAmountPerLift = totalBeforeVatPerLift * (vatRate / 100);
        const totalWithVatPerLift = includeVat
            ? totalBeforeVatPerLift + vatAmountPerLift
            : totalBeforeVatPerLift;

        // Ù…Ø¬Ø§Ù…ÙŠØ¹ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯
        const factoryCostTotal = factoryCostPerLift * liftsCount;
        const shippingInsuranceTotal = shippingInsurancePerLift * liftsCount;
        const clearanceTransportTotal = clearanceTransportPerLift * liftsCount;
        const installationCommissioningTotal = installationCommissioningPerLift * liftsCount;
        const overheadTotal = overheadPerLift * liftsCount;
        const costBeforeProfitTotal = costBeforeProfitPerLift * liftsCount;
        const profitTotal = profitPerLift * liftsCount;
        const totalBeforeVatTotal = totalBeforeVatPerLift * liftsCount;
        const vatAmountTotal = vatAmountPerLift * liftsCount;
        const totalWithVatTotal = totalWithVatPerLift * liftsCount;

        const result = {
            brandKey,
            floors,
            liftsCount,
            // Ù„Ù„Ù…ØµØ¹Ø¯ Ø§Ù„ÙˆØ§Ø­Ø¯
            factoryCostPerLift,
            shippingInsurancePerLift,
            clearanceTransportPerLift,
            installationCommissioningPerLift,
            overheadPerLift,
            costBeforeProfitPerLift,
            profitPerLift,
            totalBeforeVatPerLift,
            vatAmountPerLift,
            totalWithVatPerLift,
            // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ù…ØµØ§Ø¹Ø¯
            factoryCost: factoryCostTotal,
            shippingInsuranceCost: shippingInsuranceTotal,
            clearanceTransportCost: clearanceTransportTotal,
            installationCommissioningCost: installationCommissioningTotal,
            overheadCost: overheadTotal,
            costBeforeProfit: costBeforeProfitTotal,
            profitAmount: profitTotal,
            totalBeforeVat: totalBeforeVatTotal,
            vatRate,
            vatAmount: vatAmountTotal,
            totalWithVat: totalWithVatTotal,
            includeVat,
            overheadPercent: COST_PARAMS.overheadPercent,
            profitPercent: COST_PARAMS.profitPercent
        };

        generateNumbersView(result, model, currency);
        generateQuoteText(result, model, currency);

                // Ø­ÙØ¸ Ù„Ù‚Ø·Ø© Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±"
        const manualCustomerName = document.getElementById('customer_name').value.trim();
        const projectName = document.getElementById('project_name').value.trim();

        const finalCustomerName =
            (selectedCustomer?.customer_name || manualCustomerName || 'Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„ÙƒØ±ÙŠÙ…').trim();

        const brandLabel = BRAND_SOURCES[brandKey]?.label || brandKey;

// âœ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ù…Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ§Ø¹Ø¯
const shaftRows = document.querySelectorAll("#shaft-table tbody tr");
const shaftsSummary = [];

shaftRows.forEach((row, index) => {
    const shaft = row.querySelector(".shaft-select")?.value || "";
    const cabin = row.querySelector(".cabin-cell")?.innerText || "";
    const door  = row.querySelector(".door-cell")?.innerText || "";

    if (shaft || cabin || door) {
        shaftsSummary.push(
            `Ù…ØµØ¹Ø¯ ${index + 1}: Ø¨Ø¦Ø± ${shaft} | ÙƒØ§Ø¨ÙŠÙ† ${cabin} | Ø¨Ø§Ø¨ ${door}`
        );
    }
});
        
const quoteNumber = `RKL-${new Date().getFullYear()}-${Date.now().toString().slice(-5)}`;

// ============================================
// âœ… ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø¨Ø§Ù„ØªÙØµÙŠÙ„ Ù„ÙƒÙ„ Ù…ØµØ¹Ø¯
// ============================================
const selectedCabin = [];
const selectedShaft = [];
const selectedDoor  = [];
const selectedPit   = [];
const selectedOH    = [];

shaftRows.forEach((row) => {
    const shaft = row.querySelector(".shaft-select")?.value || '';
    const cabin = row.querySelector(".cabin-cell")?.innerText || '';
    const door  = row.querySelector(".door-cell")?.innerText || '';
    const pit   = row.querySelector(".pit-cell")?.innerText || '';
    const oh    = row.querySelector(".oh-cell")?.innerText || '';

    if (cabin) selectedCabin.push(cabin);
    if (shaft) selectedShaft.push(shaft);
    if (door)  selectedDoor.push(door);
    if (pit)   selectedPit.push(pit);
    if (oh)    selectedOH.push(oh);
});
        
        
lastQuoteSnapshot = {
    quoteNumber,

    /* =========================
       1) Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø§Ù…Ø©
    ========================= */
    timestamp: new Date().toISOString(),
    customerName: finalCustomerName || '',
    projectName: projectName || '',

    brandKey,
    brandLabel,

    capacity: capacity ? (capacity + ' kg') : '',
    speed: speed ? (speed + ' m/s') : '',
    floors: floors || '',
    liftsCount: liftsCount || 1,

    /* =========================
       2) Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª â€“ (Ù…Ø·Ø§Ø¨Ù‚ Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø±Ø¶)
    ========================= */
    shaftsSummary: shaftsSummary || '',

    // ØªØ¸Ù‡Ø± ÙÙŠ Page 3 + Page 4
    cabinSize: Array.isArray(selectedCabin) ? selectedCabin.join(' | ') : (selectedCabin || ''),
    shaftSize: Array.isArray(selectedShaft) ? selectedShaft.join(' | ') : (selectedShaft || ''),
    doors:     Array.isArray(selectedDoor)  ? selectedDoor.join(' | ')  : (selectedDoor || ''),
    pit:       Array.isArray(selectedPit)   ? selectedPit.join(' | ')   : (selectedPit || ''),
    oh:        Array.isArray(selectedOH)    ? selectedOH.join(' | ')    : (selectedOH || ''),

    /* =========================
       3) Ø§Ù„ØªØ´Ø·ÙŠØ¨
    ========================= */
    cabinDesign: document.getElementById("cabin_design")?.value || 'Standard',
    floorFinish: document.getElementById("floor_finish")?.value || 'Standard',

    /* =========================
       4) Ù…ÙˆØ§ØµÙØ§Øª ÙÙ†ÙŠØ©
    ========================= */
    machineType: model?.machineType || 'MRL â€“ Traction',
    stops: floors || '',

    /* =========================
/* =========================
   5) Ø§Ù„Ø³Ø¹Ø±
========================= */
totalWithVat: result?.totalWithVat || 0,

pricePerUnit: liftsCount && result?.totalWithVat
    ? (result.totalWithVat / liftsCount)
    : (result?.totalWithVat || 0),

currency: currency || 'SAR',

// Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙƒÙ†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© (15 = 15%)
vatRate: vatRate || 15,

includeVat: includeVat === true,

payments: {
    advance50: result?.totalWithVat
        ? (result.totalWithVat * 0.50)
        : 0,

    mechanical25: result?.totalWithVat
        ? (result.totalWithVat * 0.25)
        : 0,

    electrical20: result?.totalWithVat
        ? (result.totalWithVat * 0.20)
        : 0,

    handover5: result?.totalWithVat
        ? (result.totalWithVat * 0.05)
        : 0
},


    /* =========================
       6) Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ³Ø¹Ø©
       (Ù…Ø·Ø§Ø¨Ù‚Ø© 1:1 Ù…Ø¹ elevator-quote-offer.html)
    ========================= */
    preferredContact: selectedCustomer?.preferred_contact || '',

    customerDetails: selectedCustomer ? {
        customer_type: selectedCustomer.customer_type || '',
        contact_person: selectedCustomer.contact_person || '',
        id_number: selectedCustomer.id_number || '',
        cr_number: selectedCustomer.cr_number || '',
        tax_number: selectedCustomer.tax_number || '',
        city: selectedCustomer.city || '',
        district: selectedCustomer.district || '',
        street: selectedCustomer.street || '',
        building_no: selectedCustomer.building_no || '',
        postal_code: selectedCustomer.postal_code || '',
        full_address: selectedCustomer.full_address || '',
        mobile: selectedCustomer.mobile || '',
        phone: selectedCustomer.phone || '',
        email: selectedCustomer.email || '',
        preferred_contact: selectedCustomer.preferred_contact || '',
        notes: selectedCustomer.notes || ''
    } : {}
};



    }

    // ========================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ==========================
       // ========================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ==========================
    (function init() {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† ØµÙØ­Ø© customer-manager
        populateCustomerDropdown();

        // ØªØ­Ù…ÙŠÙ„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        renderQuotesTable();

        const customerSelect = document.getElementById('customer_select');
        if (customerSelect) {
            customerSelect.addEventListener('change', () => {
    const idx = customerSelect.value;

    if (idx === '') {
        selectedCustomer = null;
        renderCustomerDetails(null);
        return;
    }

    const customers = loadStoredCustomers();
    const customer = customers[Number(idx)];
    applyCustomerToForm(customer);
});

        }

   document.getElementById("printOfferButton").addEventListener("click", function () {
    const selected = document.querySelector(".quote-check:checked");

    if (!selected) {
        alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø±Ø¶ Ø³Ø¹Ø± ÙˆØ§Ø­Ø¯ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
    }

    const index = selected.dataset.index;

    // Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ØªØ§Ø±
    localStorage.setItem("rkl_current_quote_index", index);

    // ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¹Ø±Ø¶
    window.open("elevator-quote-offer.html", "_blank");
});




        // Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„ÙŠØ© ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        document.getElementById('numbers-wrapper').innerHTML =
            '<div class="hint">Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ø«Ù… Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±.</div>';

        // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ©: ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø³Ø¹Ø§Øª
        document.getElementById('brand').addEventListener('change', async function () {
            const brandKey = this.value;
            document.getElementById('capacity').disabled = true;
            document.getElementById('speed').disabled = true;

            if (!brandKey) {
                currentBrandData = null;
                document.getElementById('numbers-wrapper').innerHTML =
                    '<div class="hint">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ø£ÙˆÙ„Ø§Ù‹.</div>';
                return;
            }

            await loadBrandData(brandKey);
            if (!currentBrandData) return;

            fillCapacityOptions();
            document.getElementById('numbers-wrapper').innerHTML =
                '<div class="hint">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© Ø«Ù… Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ø¶ØºØ· "Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±".</div>';
        });

        // Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø¹Ø©: ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø³Ø±Ø¹Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        document.getElementById('capacity').addEventListener('change', fillSpeedOptions);

        // Ø²Ø± Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±
        document.getElementById('calc-btn').addEventListener('click', calculateQuote);

        // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        document.getElementById('reset-btn').addEventListener('click', function () {
            currentBrandData = null;
            document.getElementById('capacity').innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¹Ø©...</option>';
            document.getElementById('capacity').disabled = true;
            document.getElementById('speed').innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø±Ø¹Ø©...</option>';
            document.getElementById('speed').disabled = true;
            document.getElementById('numbers-wrapper').innerHTML =
                '<div class="hint">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© Ø«Ù… Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±.</div>';
            document.getElementById('quote_text').value = '';

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„
            populateCustomerDropdown();
            renderQuotesTable();

            selectedCustomer = null;
            if (customerSelect) customerSelect.value = '';
        });

        // Ø²Ø± Ù†Ø³Ø® Ø§Ù„Ù†Øµ
        document.getElementById('copy-btn').addEventListener('click', function () {
            const textarea = document.getElementById('quote_text');
            if (!textarea.value.trim()) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ Ù„Ù†Ø³Ø®Ù‡ØŒ Ù‚Ù… Ø¨Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            textarea.select();
            document.execCommand('copy');
            alert('ØªÙ… Ù†Ø³Ø® Ù†Øµ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±.');
        });

         // Ø²Ø± Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
    const saveBtn = document.getElementById('save-quote-btn');
    if (saveBtn) {
        saveBtn.addEventListener('click', () => {
            if (!lastQuoteSnapshot) {
                alert('Ù‚Ù… Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„ Ø­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„.');
                return;
            }

            // 1) Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ø®Ø²Ù†Ø© ÙˆØªØ¬Ù‡ÙŠØ² Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯
            const quotes = loadStoredQuotes();

            const nextIndex = quotes.length + 1;
            const today = new Date();
            const ymd = today.toISOString().slice(0, 10).replace(/-/g, '');
            const quoteNumber = 'Q-' + new Date().toISOString().slice(0,10).replaceAll('-','') 
                    + '-' + Math.floor(Math.random() * 1000);

            // 2) Ù‚Ø±Ø§Ø¡Ø© Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
            const manualCustomerName = document.getElementById('customer_name').value.trim();
            const projectName = document.getElementById('project_name').value.trim();

            const finalCustomerName =
                (selectedCustomer?.customer_name || manualCustomerName || 'Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„ÙƒØ±ÙŠÙ…').trim();

            // 3) ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø°ÙŠ ÙŠØ°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„
            const entry = {
    ...lastQuoteSnapshot,
    quoteNumber,
    customerName: finalCustomerName,
    projectName,

    // âœ… ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø©
    customerDetails: selectedCustomer ? {
        customer_type: selectedCustomer.customer_type || '',
        contact_person: selectedCustomer.contact_person || '',
        id_number: selectedCustomer.id_number || '',
        cr_number: selectedCustomer.cr_number || '',
        tax_number: selectedCustomer.tax_number || '',
        city: selectedCustomer.city || '',
        district: selectedCustomer.district || '',
        street: selectedCustomer.street || '',
        building_no: selectedCustomer.building_no || '',
        postal_code: selectedCustomer.postal_code || '',
        full_address: selectedCustomer.full_address || '',
        mobile: selectedCustomer.mobile || '',
        phone: selectedCustomer.phone || '',
        email: selectedCustomer.email || '',
        notes: selectedCustomer.notes || ''
    } : null
};


            // Ø­ÙØ¸Ù‡ ÙÙŠ Ù…ØµÙÙˆÙØ© Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
            quotes.push(entry);
            saveQuotesToStorage(quotes);
            renderQuotesTable();

            // 4) ØªØ¬Ù‡ÙŠØ² Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ (Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ elevator-quote-offer.html)
            const offerData = {
                quoteNumber,

                customer: {
                    name: finalCustomerName,
                    type: selectedCustomer?.customer_type || null,
                    contactPerson: selectedCustomer?.contact_person || null,
                    idNumber: selectedCustomer?.id_number || null,
                    crNumber: selectedCustomer?.cr_number || null,
                    tax_Number: selectedCustomer?.tax_number || null,
                    city: selectedCustomer?.city || null,
                    district: selectedCustomer?.district || null,
                    street: selectedCustomer?.street || null,
                    buildingNo: selectedCustomer?.building_no || null,
                    postalCode: selectedCustomer?.postal_code || null,
                    address: selectedCustomer?.full_address || null,
                    mobile: selectedCustomer?.mobile || null,
                    phone: selectedCustomer?.phone || null,
                    email: selectedCustomer?.email || null,
                    preferredContact: selectedCustomer?.preferred_contact || null,
                    notes: selectedCustomer?.notes || null
                },

                project: {
                    name: projectName,
                    date: entry.timestamp,
                    brandKey: entry.brandKey,
                    brandLabel: entry.brandLabel,
                    capacityKg: entry.capacity,
                    speedMps: entry.speed,
                    floors: entry.floors,
                    liftsCount: entry.liftsCount
                },

                pricing: {
                    currency: entry.currency,
                    vatRate: entry.vatRate,
                    includeVat: entry.includeVat,
                    totalWithVat: entry.totalWithVat
                },

                quoteText: document.getElementById('quote_text').value
            };
            // ØªØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ù…Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ§Ø¹Ø¯
const shaftRows = document.querySelectorAll("#shaft-table tbody tr");
const shaftData = [];

shaftRows.forEach((row, index) => {
    const shaft = row.querySelector(".shaft-select")?.value || "";
    const cabin = row.querySelector(".cabin-cell")?.innerText || "";
    const door = row.querySelector(".door-cell")?.innerText || "";
    const note = row.querySelector(".note-input")?.value || "";

    shaftData.push({
        elevator: index + 1,
        shaft,
        cabin,
        door,
        note
    });
});

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ offerData
offerData.shafts = shaftData;


            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ elevator-quote-offer.html
            localStorage.setItem('rkl_last_offer', JSON.stringify(offerData));

            alert('ØªÙ… Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø³Ø¬Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².');
        });
    }

        // Ø²Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„ Ø¥Ù„Ù‰ CSV
        const exportBtn = document.getElementById('export-quotes-btn');
        if (exportBtn) {
            exportBtn.addEventListener('click', () => {
                const quotes = loadStoredQuotes();
                if (!quotes.length) {
                    alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ø¹Ø±ÙˆØ¶ Ø£Ø³Ø¹Ø§Ø± Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„ØªØµØ¯ÙŠØ±.');
                    return;
                }

                const header = [
                    '#',
                    'Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±',
                    'Ø§Ù„ØªØ§Ø±ÙŠØ®',
                    'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„',
                    'Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
                    'Ø§Ù„Ù…Ø§Ø±ÙƒØ©',
                    'Ø§Ù„Ø³Ø¹Ø©',
                    'Ø§Ù„Ø³Ø±Ø¹Ø©',
                    'Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯',
                    'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©',
                    'Ø§Ù„Ø¹Ù…Ù„Ø©'
                ];

                const rows = [header.join(',')];

                quotes.forEach((q, index) => {
                    const dateStr = q.timestamp ? q.timestamp.slice(0, 10) : '';
                    const totalStr = (Number(q.totalWithVat) || 0).toFixed(2);

                    rows.push([
                        index + 1,
                        q.quoteNumber || '',
                        dateStr,
                        `"${q.customerName || ''}"`,
                        `"${q.projectName || ''}"`,
                        `"${q.brandLabel || q.brandKey || ''}"`,
                        q.capacity || '',
                        q.speed || '',
                        q.liftsCount || '',
                        totalStr,
                        q.currency || 'SAR'
                    ].join(','));
                });

                const csvContent = '\uFEFF' + rows.join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'rkl_elevator_quotes.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }
    })();

    const CURRENT_QUOTE_SELECTION_KEY = "rkl_current_quote_number";

    const en81Options = [
  { shaft: "1500 Ã— 1700", cabin: "1000 Ã— 1100", door: "800" },
  { shaft: "1600 Ã— 1800", cabin: "1100 Ã— 1200", door: "800" },
  { shaft: "1800 Ã— 2000", cabin: "1100 Ã— 1400", door: "900" },
  { shaft: "2000 Ã— 2400", cabin: "1400 Ã— 1600", door: "1000" },
  { shaft: "2400 Ã— 2600", cabin: "1600 Ã— 1800", door: "1100" }
];

// Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯
document.getElementById("lifts_count").addEventListener("input", function () {
    const count = Number(this.value);
    const container = document.getElementById("shaft-table-container");
    const tbody = document.querySelector("#shaft-table tbody");
    
    if (count > 0) container.style.display = "block";
    else container.style.display = "none";

    tbody.innerHTML = ""; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    
    for (let i = 1; i <= count; i++) {
        const row = document.createElement("tr");

        row.innerHTML = `
            <td>${i}</td>
            <td>
                <select class="shaft-select">
                    <option value="">Ø§Ø®ØªØ± Ù…Ù‚Ø§Ø³ Ø§Ù„Ø¨Ø¦Ø±â€¦</option>
                    ${en81Options.map(o => `<option value="${o.shaft}">${o.shaft}</option>`).join("")}
                </select>
            </td>
            <td class="cabin-cell"></td>
            <td class="door-cell"></td>
            <td><input type="text" class="note-input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª" /></td>
        `;
        
        tbody.appendChild(row);
    }

    // Ø±Ø¨Ø· ØªØºÙŠÙŠØ± ÙƒÙ„ Ø§Ø®ØªÙŠØ§Ø±
    document.querySelectorAll(".shaft-select").forEach((select, idx) => {
        select.addEventListener("change", function () {
            const opt = en81Options.find(o => o.shaft === this.value);
            const row = this.closest("tr");
            if (opt) {
                row.querySelector(".cabin-cell").innerText = opt.cabin;
                row.querySelector(".door-cell").innerText = opt.door;
            }
        });
    });
});



</script>



</body>
</html>








