<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù…ØµØ¹Ø¯</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f3f4f6;
            margin: 0;
            padding: 0;
        }

        .page-wrapper {
            max-width: 1100px;
            margin: 30px auto;
            padding: 16px;
        }

        .layout {
            display: grid;
            grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
            gap: 16px;
        }
        .table-wrapper {
    margin-top: 10px;
    overflow-x: auto;
}

#quotes-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

#quotes-table th,
#quotes-table td {
    padding: 6px 8px;
    border-bottom: 1px solid #e5e7eb;
    text-align: right;
    white-space: nowrap;
}

#quotes-table th {
    background: #f9fafb;
    font-weight: 600;
    color: #374151;
}


        .card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
            padding: 18px 20px;
            margin-bottom: 16px;
        }

        .card-header {
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 12px;
            padding-bottom: 6px;
        }

        .card-header h1,
        .card-header h2 {
            margin: 0;
            color: #111827;
        }

        .card-header h1 {
            font-size: 22px;
        }

        .card-header h2 {
            font-size: 18px;
        }

        .card-header p {
            margin: 4px 0 0;
            font-size: 13px;
            color: #6b7280;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 12px 14px;
        }

        label {
            display: block;
            font-size: 13px;
            color: #374151;
            margin-bottom: 4px;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            font-size: 14px;
            box-sizing: border-box;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.25);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .hint {
            font-size: 11px;
            color: #9ca3af;
            margin-top: 2px;
        }

        .section-title {
            margin: 10px 0 4px;
            font-size: 14px;
            font-weight: 600;
            color: #111827;
        }

        .inline {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        .inline input[type="checkbox"] {
            width: auto;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }

        .number-box {
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            padding: 8px 10px;
            background: #f9fafb;
        }

        .number-box .label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .number-box .value {
            font-weight: 600;
            font-size: 15px;
            color: #111827;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 11px;
            background: #ecfdf5;
            color: #166534;
            margin-right: 6px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 999px;
            border: none;
            padding: 7px 16px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.05s;
        }

        .btn-primary {
            background: #059669;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #047857;
            box-shadow: 0 4px 10px rgba(4, 120, 87, 0.25);
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #111827;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        .actions {
            margin-top: 12px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        @media (max-width: 900px) {
            .layout {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        /* =========================
   Password Gate (UI Lock)
========================= */
#rklLock {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.65);
  backdrop-filter: blur(6px);
  display: none;              /* Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡ Ù…Ù† JS */
  align-items: center;
  justify-content: center;
  z-index: 99999;
}

#rklLock .box{
  width: min(420px, 92vw);
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 18px 60px rgba(0,0,0,.25);
  padding: 18px 18px 14px;
  text-align: right;
}

#rklLock .title{
  font-size: 18px;
  font-weight: 700;
  color: #111827;
  margin: 0 0 6px;
}

#rklLock .sub{
  font-size: 13px;
  color: #6b7280;
  margin: 0 0 12px;
}

#rklLock .row{
  display: grid;
  gap: 10px;
}

#rklLock input{
  width: 100%;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid #d1d5db;
  font-size: 14px;
  box-sizing: border-box;
}

#rklLock .actions{
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

#rklLock .btnLock{
  border: none;
  border-radius: 999px;
  padding: 9px 14px;
  cursor: pointer;
  font-size: 13px;
}

#rklLock .btnEnter{
  background: #059669;
  color: #fff;
}
#rklLock .btnEnter:hover{ background:#047857; }

#rklLock .btnClear{
  background:#e5e7eb;
  color:#111827;
}
#rklLock .msg{
  margin-top: 8px;
  font-size: 12px;
  color: #b91c1c;
  min-height: 16px;
}

    </style>
</head>
<body>
<div class="page-wrapper">
<!-- =========================
     RKL Password Gate
========================= -->
<div id="rklLock" aria-hidden="true">
  <div class="box">
    <p class="title">Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ³Ø¹ÙŠØ±</p>
    <p class="sub">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</p>

    <div class="row">
      <input id="rklPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password" />
      <div class="actions">
        <button class="btnLock btnEnter" id="rklEnterBtn" type="button">Ø¯Ø®ÙˆÙ„</button>
        <button class="btnLock btnClear" id="rklClearBtn" type="button">Ù…Ø³Ø­</button>
      </div>
      <div class="msg" id="rklLockMsg"></div>
    </div>
  </div>
</div>

    <div class="layout">
        <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ -->
        <div>
            <div class="card">
                <div class="card-header">
                    <h1>Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù…ØµØ¹Ø¯</h1>
                    <p>ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø§Ù…Ø© Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (FUJI MRL ÙƒÙ…Ø±Ø­Ù„Ø© Ø£ÙˆÙ„Ù‰).</p>
                </div>

                <form id="quote-form">
                    <div class="section-title">Ù¡. Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø§Ù…Ø©</div>

<!-- Ù‚Ø³Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø®Ø§Ø±Ø¬ form-grid -->

<div class="section-title">Ù¡. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
<div class="form-grid">
    <div>
        <label for="customer_select">Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„Ù‹Ø§ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ (Ù…Ø­ÙÙˆØ¸ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²)</label>
        <select id="customer_select">
            <option value="">â€” Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„Ù‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€”</option>
        </select>
        <div class="hint">
            ÙŠØªÙ… Ø³Ø­Ø¨ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ù† ØµÙØ­Ø© "Ø¥Ø¶Ø§ÙØ© / Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„" (localStorage).
        </div>
    </div>

    <div>
        <label for="customer_name">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§)</label>
        <input type="text" id="customer_name" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ø§Ø¯Ø© / Ø´Ø±ÙƒØ© ...." />
    </div>

    <div>
        <label for="project_name">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ùˆ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ </label>
        <input type="text" id="project_name" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…ÙƒØ§ØªØ¨ " />
        <input type="text" id="project_location" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±ÙŠØ§Ø¶ â€“ Ø­ÙŠ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†" />
        
    </div>
</div>
                    <div class="card" id="customer-details-card" style="display:none; margin-top:10px;">
    <div class="card-header">
        <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
    </div>

    <div class="form-grid" id="customer-details">
        <!-- ØªÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ -->
    </div>
</div>





                    <div class="section-title">Ù¢. Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ¹Ø¯</div>
                    <div class="form-grid">
                        <div>
                            <label for="brand">
                                Ø§Ù„Ù…Ø§Ø±ÙƒØ© / Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…
                            </label>
                           <select id="brand" required>
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ©...</option>
    <option value="FUJI_MRL">JAPAN FUJI â€“ MRL</option>
    <option value="VERTILIFT_MRL">ITALY VERTILIFT â€“ MRL</option>
    <option value="LOCAL_MRL">LOCAL ASSEMBLY â€“ MRL </option>
</select>
             

                        <div>
                            <label for="capacity">Ø§Ù„Ø³Ø¹Ø© (kg)</label>
                            <select id="capacity" required disabled>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¹Ø©...</option>
                            </select>
                        </div>

                        <div>
                            <label for="speed">Ø§Ù„Ø³Ø±Ø¹Ø© (m/s)</label>
                            <select id="speed" required disabled>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø±Ø¹Ø©...</option>
                            </select>
                        </div>

                        <div>
                            <label for="floors">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (Stops)</label>
                            <input type="number" id="floors" min="2" value="2" required />
                            <div class="hint">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙŠØ´Ù…Ù„ Ø¹Ø§Ø¯Ø©Ù‹ Ø¯ÙˆØ±ÙŠÙ†. Ø§Ù„Ø²ÙŠØ§Ø¯Ø© ØªÙØ­Ø³Ø¨ Ù„ÙƒÙ„ Ø¯ÙˆØ± Ø¥Ø¶Ø§ÙÙŠ.</div>
                        </div>
                    </div>
                    <!-- Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¯ÙˆØ± -->
                    <!-- Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙˆØ§Ø­Ø¯ -->


<div class="form-group">
  <label>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙˆØ§Ø­Ø¯ (mm)</label>
  <input
    type="number"
    id="floorHeight"
    step="10"
    value="3500"
    placeholder="Ù…Ø«Ø§Ù„: 3500"
  >
</div>

<div class="form-group">
  <label>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„ÙƒÙ„ÙŠ (mm)</label>
  <input
    type="number"
    id="travelHeight"
    readonly
    placeholder="ÙŠØªÙ… Ø§Ù„Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§"
  >
</div>

                    <div class="section-title">ğŸ“Œ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© (EN81)</div>

<table class="standard-table">
  <thead>
    <tr>
      <th>Ø§Ù„Ø­Ù…ÙˆÙ„Ø© (kg)</th>
      <th>Ù…Ù‚Ø§Ø³ Ø§Ù„ÙƒØ§Ø¨ÙŠÙ†Ø© (mm)</th>
      <th>Ù…Ù‚Ø§Ø³ Ø§Ù„Ø¨Ø¦Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (mm)</th>
      <th>Ø¨Ø§Ø¨ Ø§Ù„Ù…ØµØ¹Ø¯ (mm)</th>
      <th>Pit</th>
      <th>OH</th>
    </tr>
  </thead>

  <tbody>
    <!-- 450 kg -->
    <tr
      data-capacity="450"
      data-cabin="1100x1000"
      data-shaft="1700x1500"
      data-door="700"
      data-pit="1200"
      data-oh="3500"
    >
      <td>450</td>
      <td>1100 Ã— 1000</td>
      <td>1700 Ã— 1500</td>
      <td>700</td>
      <td>1200</td>
      <td>3500</td>
    </tr>

    <!-- 630 kg -->
    <tr
      data-capacity="630"
      data-cabin="1100x1400"
      data-shaft="1800x1600"
      data-door="800"
      data-pit="1200"
      data-oh="3500"
    >
      <td>630</td>
      <td>1100 Ã— 1400</td>
      <td>1800 Ã— 1600</td>
      <td>800</td>
      <td>1200</td>
      <td>3500</td>
    </tr>

    <!-- 800 kg -->
    <tr
      data-capacity="800"
      data-cabin="1350x1400"
      data-shaft="2000x1600"
      data-door="900"
      data-pit="1300"
      data-oh="3600"
    >
      <td>800</td>
      <td>1350 Ã— 1400</td>
      <td>2000 Ã— 1600</td>
      <td>900</td>
      <td>1300</td>
      <td>3600</td>
    </tr>

    <!-- 1000 kg -->
    <tr
      data-capacity="1000"
      data-cabin="1600x1500"
      data-shaft="2200x1800"
      data-door="900"
      data-pit="1400"
      data-oh="3700"
    >
      <td>1000</td>
      <td>1600 Ã— 1500</td>
      <td>2200 Ã— 1800</td>
      <td>900</td>
      <td>1400</td>
      <td>3700</td>
    </tr>

    <!-- 1275 kg -->
    <tr
      data-capacity="1275"
      data-cabin="1800x1600"
      data-shaft="2400x1900"
      data-door="1100"
      data-pit="1400"
      data-oh="3800"
    >
      <td>1275</td>
      <td>1800 Ã— 1600</td>
      <td>2400 Ã— 1900</td>
      <td>1100</td>
      <td>1400</td>
      <td>3800</td>
    </tr>

    <!-- 1600 kg -->
    <tr
      data-capacity="1600"
      data-cabin="2000x1800"
      data-shaft="2600x2400"
      data-door="1100"
      data-pit="1500"
      data-oh="4000"
    >
      <td>1600</td>
      <td>1800 Ã— 2000</td>
      <td>2600 Ã— 2400</td>
      <td>1100</td>
      <td>1500</td>
      <td>4000</td>
    </tr>
  </tbody>
</table>


<style>
.standard-table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0 25px 0;
    font-size: 14px;
    background: #fff;
}
.standard-table th {
    background: #f0f0f0;
    padding: 10px;
    border: 1px solid #ddd;
    font-weight: bold;
}
.standard-table td {
    padding: 8px;
    border: 1px solid #ddd;
    text-align: center;
}
</style>

              </div>

<div class="section-title">Ù¢.Ù£ ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ¨ÙŠÙ†Ù‡ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</div>
<div class="form-grid">

    <div>
        <label for="cabin_design">Ù†ÙˆØ¹ Ø§Ù„ØªØ´Ø·ÙŠØ¨ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ÙƒØ¨ÙŠÙ†Ù‡</label>
        <select id="cabin_design">
            <option value="">â€” Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØµÙ…ÙŠÙ… â€”</option>
            <option value="SS304-Hairline">Ø³ØªØ§Ù†Ù„Ø³ Ø³ØªÙŠÙ„ 304 â€“ Hairline</option>
            <option value="SS304-Mirror">Ø³ØªØ§Ù†Ù„Ø³ Ø³ØªÙŠÙ„ 304 â€“ Ù…Ø±Ø§ÙŠØ§</option>
            <option value="Mirror-SS304">Ù…Ø±Ø§ÙŠØ§ + Ø³ØªØ§Ù†Ù„Ø³</option>
            <option value="Wood-SS304">Ø®Ø´Ø¨ÙŠ + Ø³ØªØ§Ù†Ù„Ø³</option>
            <option value="Custom">ØªØµÙ…ÙŠÙ… Ø®Ø§Øµ (Custom)</option>
        </select>
    </div>

    <div>
        <label for="floor_finish">ØªØ´Ø·ÙŠØ¨ Ø§Ù„Ø£Ø±Ø¶ÙŠØ©</label>
        <select id="floor_finish">
            <option value="">â€” Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø£Ø±Ø¶ÙŠØ© â€”</option>
            <option value="Vinyl">ÙÙŠÙ†ÙŠÙ„</option>
            <option value="Granite">Ø¬Ø±Ø§Ù†ÙŠØª</option>
            <option value="Marble">Ø±Ø®Ø§Ù…</option>
            <option value="Aluminum-Checker">Ø£Ù„Ù…Ù†ÙŠÙˆÙ… Checker Plate</option>
        </select>
    </div>

</div>

                        <div class="section-title">Ù¢.Ù¡ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª</div>
<div class="form-grid">
    <div>
        <label for="lifts_count">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯ Ø¨Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª</label>
        <input type="number" id="lifts_count" min="0" value="0" />
        <div class="hint">
            Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¹Ø¯ Ø¨Ù†ÙØ³ Ø§Ù„Ø­Ù…ÙˆÙ„Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±ØŒ Ø¶Ø¹ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù‡Ù†Ø§ (Ù…Ø«Ø§Ù„: 5 Ù…ØµØ§Ø¹Ø¯).
            Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…ÙˆØ§ØµÙØ§Øª Ù…Ø®ØªÙ„ÙØ©ØŒ Ø§Ø­Ø³Ø¨ ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù„ÙˆØ­Ø¯Ù‡Ø§ (Ù…Ø«Ø§Ù„: 3 Ã— 800kg Ø«Ù… 2 Ã— 1000kg).
        </div>
    </div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ù„ÙƒÙ„ Ù…ØµØ¹Ø¯ -->
<div id="shaft-table-container" style="margin-top:20px; display:none;">
    <h3>âš™ï¸ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…ØµØ§Ø¹Ø¯</h3>
    <table class="table" id="shaft-table">
       <thead>
  <tr>
    <th>No.ELE</th>
    <th>(Shaft)</th>
    <th>(Cabin)</th>
    <th> (Door)</th>
    <th>Pit</th>
    <th>OH</th>
       <th>FH</th>
    <th>TH</th>
   
  </tr>
</thead>
        <tbody></tbody>
    </table>
</div>

                    <div class="section-title">Ù£. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ±</div>
                    <div class="form-grid">
                        <div>
                            <label for="currency">Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø­Ø³Ø§Ø¨</label>
                            <select id="currency">
                                <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)</option>
                                <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                            </select>
                        </div>

                        <div>
                            <label for="vat_rate">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© %</label>
                            <input type="number" id="vat_rate" value="15" step="0.1" />
                        </div>

                        <div>
                            <label>Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                            <div class="inline">
                                <input type="checkbox" id="include_vat" checked />
                                <label for="include_vat" style="margin: 0;">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</label>
                            </div>
                        </div>
                    </div>

                    <div class="actions">
                        <button type="button" class="btn btn-primary" id="calc-btn">Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±</button>
                        <button type="reset" class="btn btn-secondary" id="reset-btn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                    </div>
                </form>
            </div>

            <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© -->
            <div class="card">
                <div class="card-header">
                    <h2>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h2>
                </div>

                <div id="numbers-wrapper">
                    <div class="hint">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© Ø«Ù… Ø§Ø¶ØºØ· "Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±" Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„.</div>
                </div>
            </div>
        </div>

        <!-- Ø¨Ø·Ø§Ù‚Ø© Ù…Ù„Ø®Øµ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†ØµÙŠ -->
        <div>
            <div class="card">
                <div class="card-header">
                    <h2>Ù…Ù„Ø®Øµ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± (Ù†ØµÙŠ)</h2>
                    <p>ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ ÙˆÙ„ØµÙ‚Ù‡ ÙÙŠ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø±Ø³Ù…ÙŠ Ø£Ùˆ Ù…Ù„Ù Word.</p>
                </div>

                <textarea id="quote_text" placeholder="Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù†Øµ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨..."></textarea>

                <div class="actions">
                    <button type="button" class="btn btn-secondary" id="copy-btn">Ù†Ø³Ø® Ø§Ù„Ù†Øµ</button>
                </div>
            </div>
        </div>
    </div>
</div>
            <!-- Ø¨Ø·Ø§Ù‚Ø© Ø³Ø¬Ù„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
        <div style="margin-top: 16px;">
            <div class="card">
                <div class="card-header">
                    <h2>Ø³Ø¬Ù„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²</h2>
                    <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø«Ù… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø¥Ù„Ù‰ Ù…Ù„Ù Excel (CSV).</p>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-primary" id="save-quote-btn">
                        Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
                    </button>
                    <button type="button" class="btn btn-secondary" id="export-quotes-btn">
                        ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„ Ø¥Ù„Ù‰ Excel (CSV)
                    </button>
                    <button id="printOfferButton" type="button">
    Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±
</button>

                </div>

                <div class="table-wrapper">
                    <table id="quotes-table">
                      <thead>
  <tr>
    <th>âœ“</th>
    <th>#</th>
    <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶</th>
    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>

    <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
    <th>Ù†ÙˆØ¹Ù‡</th>
    <th>Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
    <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
    <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
    <th>Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</th>
    <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</th>
    <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>

    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ / Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
    <th>Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª</th>
    <th>Ù…Ù‚Ø§Ø³ Ø§Ù„Ø¨Ø¦Ø±</th>
    <th>Ù…Ù‚Ø§Ø³ Ø§Ù„ÙƒØ§Ø¨ÙŠÙ†Ø©</th>
    <th>Ø§Ù„Ø¨Ø§Ø¨</th>
    <th>PIT</th>
    <th>OH</th>
    <th>FH</th>
    <th>TH</th>
    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯</th>
      <th>Ø³Ø¹Ø± Ø§Ù„Ù…ØµØ¹Ø¯ Ø§Ù„ÙˆØ§Ø­Ø¯ (Ø´Ø§Ù…Ù„)</th>
    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø´Ø§Ù…Ù„)</th>
  </tr>
</thead>


                        <tbody>
                            <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


    <script>
/* =========================
   RKL Password Gate (Client-Side)
   Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ø¬Ù‡Ø© ÙˆÙ„ÙŠØ³Øª Ø­Ù…Ø§ÙŠØ© Ø£Ù…Ù†ÙŠØ© ÙƒØ§Ù…Ù„Ø©.
========================= */
/* =========================
   RKL Pricing Password Gate (Client-Side)
   Ù…Ù„Ø§Ø­Ø¸Ø©: Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø· ÙˆÙ„ÙŠØ³Øª Ø­Ù…Ø§ÙŠØ© Ø£Ù…Ù†ÙŠØ© Ø­Ù‚ÙŠÙ‚ÙŠØ©.
========================= */
(function () {
  const PASS_TOTAL_ONLY = "Mahato@1986"; // âœ… ÙŠØ¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙ‚Ø·
  const PASS_FULL       = "EMANi@1986";  // âœ… ÙŠØ¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬

  const lockEl = document.getElementById("rklLock");
  const passEl = document.getElementById("rklPass");
  const msgEl  = document.getElementById("rklLockMsg");
  const enterBtn = document.getElementById("rklEnterBtn");
  const clearBtn = document.getElementById("rklClearBtn");

  let resolveFn = null;

  function openLock() {
    if (!lockEl) return;
    lockEl.style.display = "flex";
    lockEl.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
    if (msgEl) msgEl.textContent = "";
    if (passEl) passEl.value = "";
    setTimeout(() => passEl?.focus(), 50);
  }

  function closeLock() {
    if (!lockEl) return;
    lockEl.style.display = "none";
    lockEl.setAttribute("aria-hidden", "true");
    document.body.style.overflow = "";
  }

  function showError(text) {
    if (msgEl) msgEl.textContent = text || "";
  }

  function decideMode(pw) {
    if (pw === PASS_TOTAL_ONLY) return "totalOnly";
    if (pw === PASS_FULL) return "full";
    return null;
  }

  function tryLogin() {
    const v = (passEl?.value || "").trim();
    if (!v) return showError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.");

    const mode = decideMode(v);
    if (!mode) return showError("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.");

    showError("");
    closeLock();

    if (typeof resolveFn === "function") {
      const r = resolveFn;
      resolveFn = null;
      r(mode);
    }
  }

  // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
  enterBtn?.addEventListener("click", tryLogin);

  clearBtn?.addEventListener("click", () => {
    if (passEl) passEl.value = "";
    showError("");
    passEl?.focus();
  });

  passEl?.addEventListener("keydown", (e) => {
    if (e.key === "Enter") tryLogin();
    if (e.key === "Escape") {
      closeLock();
      if (typeof resolveFn === "function") {
        const r = resolveFn;
        resolveFn = null;
        r(null);
      }
    }
  });

  // âœ… Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© ØªÙØ³ØªØ¯Ø¹Ù‰ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø­Ø³Ø§Ø¨
  window.RKL_REQUEST_PRICING_MODE = function () {
    return new Promise((resolve) => {
      resolveFn = resolve;
      openLock();
    });
  };
})();


    // ======================= Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ø­Ø³Ø¨Ø© (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§) =======================
const COST_PARAMS = {
    shippingUsdPerLift: 500,
    insurancePercent: 1,
    clearanceSar: 1200,
    inlandTransportSar: 1500,
    installationSar: 9000,   // â† Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    commissioningSar: 2000,  // â† Ø¹Ø¯Ù‘Ù„ Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ
    overheadPercent: 12,     // â† Ù„Ùˆ ØªØ±ÙŠØ¯ ØªÙ‚Ù„ÙŠÙ„ Ø£Ùˆ Ø±ÙØ¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©
    profitPercent: 25
};
const CABIN_DESIGN_ADDITIONAL = {
    "SS304-Hairline": 0,
    "SS304-Mirror": 2500,
    "Mirror-SS304": 4000,
    "Wood-SS304": 6000,
    "Custom": 10000
};


        // ØªØ®Ø²ÙŠÙ† Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    const QUOTES_STORAGE_KEY = 'rkl_quotes';
    let lastQuoteSnapshot = null; // Ø¢Ø®Ø± Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù…Ø­Ø³ÙˆØ¨ (Ù„Ù†Ø­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„)


    // ========================== Ø±Ø¨Ø· ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ==========================
    function renderCustomerDetails(customer) {
    const card = document.getElementById('customer-details-card');
    const container = document.getElementById('customer-details');

    if (!card || !container) return;

    // Ù„Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…ÙŠÙ„
    if (!customer) {
        card.style.display = 'none';
        container.innerHTML = '';
        return;
    }

    const fields = [
        { label: 'Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„', value: customer.customer_type },
        { label: 'Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', value: customer.contact_person },
        { label: 'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', value: customer.id_number },
        { label: 'Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ', value: customer.cr_number },
        { label: 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ', value: customer.tax_number },
        { label: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', value: customer.city },
        { label: 'Ø§Ù„Ø­ÙŠ', value: customer.district },
        { label: 'Ø§Ù„Ø´Ø§Ø±Ø¹', value: customer.street },
        { label: 'Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰', value: customer.building_no },
        { label: 'Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ', value: customer.postal_code },
        { label: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„', value: customer.full_address },
        { label: 'Ø§Ù„Ø¬ÙˆØ§Ù„', value: customer.mobile },
        { label: 'Ø§Ù„Ù‡Ø§ØªÙ', value: customer.phone },
        { label: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', value: customer.email },
        { label: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª', value: customer.notes }
    ];

    container.innerHTML = '';

    fields.forEach(f => {
        if (!f.value) return;

        const div = document.createElement('div');
        div.innerHTML = `
            <strong>${f.label}:</strong>
            <div style="color:#374151;font-size:13px;">${f.value}</div>
        `;
        container.appendChild(div);
    });

    card.style.display = 'block';
}

    const CUSTOMER_STORAGE_KEY = 'rkl_customers';

    let currentBrandData = null;
    let selectedCustomer = null; // Ø¢Ø®Ø± Ø¹Ù…ÙŠÙ„ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬

    function loadStoredCustomers() {
        try {
            return JSON.parse(localStorage.getItem(CUSTOMER_STORAGE_KEY) || '[]');
        } catch (e) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† localStorage', e);
            return [];
        }
    }

    function populateCustomerDropdown() {
        const select = document.getElementById('customer_select');
        if (!select) return;

        const customers = loadStoredCustomers();

        select.innerHTML = '<option value="">â€” Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„Ù‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€”</option>';

        customers.forEach((c, index) => {
            const name = c.customer_name || '(Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…)';
            const city = c.city ? ` - ${c.city}` : '';
            const opt = document.createElement('option');
            opt.value = index.toString();
            opt.textContent = `${name}${city}`;
            select.appendChild(opt);
        });

        if (!customers.length) {
            const opt = document.createElement('option');
            opt.value = '';
            opt.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­';
            select.appendChild(opt);
            select.disabled = true;
        } else {
            select.disabled = false;
        }
    }

    function applyCustomerToForm(customer) {
    selectedCustomer = customer || null;

    if (customer) {
        document.getElementById('customer_name').value = customer.customer_name || '';

        const projectInput = document.getElementById('project_name');
        if (projectInput && !projectInput.value) {
            projectInput.value = `Ù…Ø´Ø±ÙˆØ¹ Ù„Ù„Ø¹Ù…ÙŠÙ„ ${customer.customer_name}`;
        }

        renderCustomerDetails(customer); // âœ… Ù‡Ù†Ø§ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    } else {
        renderCustomerDetails(null);
    }
}


        // ========================== ØªØ®Ø²ÙŠÙ† Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙŠ LocalStorage ==========================

    function loadStoredQuotes() {
        try {
            return JSON.parse(localStorage.getItem(QUOTES_STORAGE_KEY) || '[]');
        } catch (e) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ù† localStorage', e);
            return [];
        }
    }

  function saveQuotesToStorage(quotes) {
    try {
        localStorage.setItem(QUOTES_STORAGE_KEY, JSON.stringify(quotes));
    } catch (e) {
        console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:", e);
        alert("ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².");
    }
}


  function renderQuotesTable() {
    const tbody = document.querySelector('#quotes-table tbody');
    if (!tbody) return;

    const quotes = loadStoredQuotes();
    tbody.innerHTML = '';

    // âœ… ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¹Ø±ÙˆØ¶
    if (!quotes.length) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 24;
        td.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø£Ø³Ø¹Ø§Ø± Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.';
        td.style.textAlign = 'center';
        td.style.color = '#9ca3af';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
    }

    // âœ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
    quotes.forEach((q, index) => {
        const tr = document.createElement('tr');

        // ğŸŸ© 1) Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± (Checkbox)
        const tdCheck = document.createElement('td');
        tdCheck.innerHTML = `
            <input 
                type="checkbox" 
                class="quote-check" 
                data-index="${index}"
            >
        `;
        tr.appendChild(tdCheck);

        const dateStr = q.timestamp ? q.timestamp.slice(0, 10) : '';
        const totalStr = formatCurrency(q.totalWithVat, q.currency || 'SAR');

        // ğŸŸ© 2) Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
        const cd = (q.customerDetails && typeof q.customerDetails === 'object')
    ? q.customerDetails
    : {};


const cols = [
  index + 1,
  q.quoteNumber || '',
  dateStr,

  q.customerName || '',
  cd.customer_type || '',
  cd.contact_person || '',
  cd.mobile || '',
  cd.email || '',
  cd.cr_number || '',
  cd.tax_number || '',
  cd.city || '',

  (q.projectName || '') + 
  (q.projectLocation ? ' â€“ ' + q.projectLocation : ''),

  `${q.brandLabel} / ${q.capacity} / ${q.speed} / ${q.floors} Stops`,

  q.shaftSize || 'â€”',
  q.cabinSize || 'â€”',
  q.doors || 'â€”',
  q.pit || 'â€”',
  q.oh || 'â€”',
  q.floorHeight || 'â€”',
  q.travelHeight || 'â€”',

  q.liftsCount || '',

  // âœ… Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©
  formatCurrency(q.pricePerUnit || 0, q.currency || 'SAR'),

  // âœ… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
  formatCurrency(q.totalWithVat || 0, q.currency || 'SAR')
];





        cols.forEach(val => {
            const td = document.createElement('td');
            td.textContent = val;
            tr.appendChild(td);
        });

        tbody.appendChild(tr);
    });
}




    // ========================== ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª ÙˆÙ…Ù„ÙØ§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ==========================
const BRAND_SOURCES = {
    'FUJI_MRL': {
        label: 'JAPAN FUJI â€“ MRL Passenger',
        jsonPath: '/fuji_mrl_prices.json'
    },
    'VERTILIFT_MRL': {
        label: 'ITALY VERTILIFT â€“ MRL Passenger',
        jsonPath: '/vertilift_mrl_prices.json'
    },
    'LOCAL_MRL': {
        label: 'LOCAL ASSEMBLY â€“ MRL Passenger',
        jsonPath: '/scripts/LOCAL_ASSEMBLY.json'
    }
};


    async function loadBrandData(brandKey) {
        const config = BRAND_SOURCES[brandKey];
        if (!config) {
            currentBrandData = null;
            return null;
        }

        const res = await fetch(config.jsonPath);
        if (!res.ok) {
            alert('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ù„Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.');
            currentBrandData = null;
            return null;
        }

        const data = await res.json();
        currentBrandData = data;
        return data;
    }

function fillCapacityOptions() {
  const capacitySelect = document.getElementById('capacity');
  const speedSelect = document.getElementById('speed');

  capacitySelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¹Ø©...</option>';
  speedSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø±Ø¹Ø©...</option>';
  speedSelect.disabled = true;

  if (!currentBrandData || !Array.isArray(currentBrandData.models)) {
    capacitySelect.disabled = true;
    return;
  }

  // âœ… ÙŠØ¯Ø¹Ù… capacityKg Ø£Ùˆ capacityRange
  const capacities = Array.from(new Set(
    currentBrandData.models
      .map(m => (m.capacityKg || m.capacityRange || '').toString().trim())
      .filter(Boolean)
  ));

  capacities.forEach(cap => {
    const opt = document.createElement('option');
    opt.value = cap;
    opt.textContent = cap.includes('-') ? `${cap} kg` : `${cap} kg`;
    capacitySelect.appendChild(opt);
  });

  capacitySelect.disabled = false;
}

function fillSpeedOptions() {
  const capacitySelect = document.getElementById('capacity');
  const speedSelect = document.getElementById('speed');

  const selectedCapacity = (capacitySelect.value || '').trim();
  speedSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø±Ø¹Ø©...</option>';

  if (!currentBrandData || !selectedCapacity) {
    speedSelect.disabled = true;
    return;
  }

  let minCap = null;
  let maxCap = null;

  if (selectedCapacity.includes('-')) {
    [minCap, maxCap] = selectedCapacity.split('-').map(Number);
  }

  const speeds = Array.from(new Set(
    currentBrandData.models
      .filter(m => {
        const capKey = (m.capacityKg || m.capacityRange || '').toString().trim();
        if (!capKey) return false;

        // Ø¥Ø°Ø§ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Range
        if (minCap !== null) {
          if (capKey.includes('-')) {
            const [mMin, mMax] = capKey.split('-').map(Number);
            return (mMin <= maxCap && mMax >= minCap);
          } else {
            const n = Number(capKey);
            return (n >= minCap && n <= maxCap);
          }
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚ÙŠÙ…Ø© Ù…ÙØ±Ø¯Ø©
        return capKey === selectedCapacity;
      })
      .map(m => Number(m.speedMps))
      .filter(v => !Number.isNaN(v))
  )).sort((a,b)=>a-b);

  speeds.forEach(sp => {
    const opt = document.createElement('option');
    opt.value = sp;
    opt.textContent = `${sp} m/s`;
    speedSelect.appendChild(opt);
  });

  speedSelect.disabled = speeds.length === 0;
}

function syncEN81ByCapacity(capacity) {
  // 1) Ø­ÙˆÙ‘Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ø¹Ø© (Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª Range) Ø¥Ù„Ù‰ Ø±Ù‚Ù… EN81 Ù…Ù†Ø§Ø³Ø¨
  // Ù…Ø«Ø§Ù„: "320-450" => 450 (Ù†Ø£Ø®Ø° Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¹Ù„Ù‰)
  const nums = String(capacity || '').match(/\d+/g) || [];
  const capNum = nums.length ? Number(nums[nums.length - 1]) : 0; // Ø¢Ø®Ø± Ø±Ù‚Ù… = Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¹Ù„Ù‰
  const capKey = capNum ? String(capNum) : String(capacity || '').trim();

  const rows = document.querySelectorAll('.standard-table tbody tr');
  let matchedRow = null;

  rows.forEach(row => {
    row.classList.remove('en81-active');

    // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ data-capacity
    const rowCap = String(row.dataset.capacity || '').trim();

    if (rowCap && rowCap === capKey) {
      matchedRow = row;
      row.classList.add('en81-active');
    }
  });

  return matchedRow ? {
    cabin: matchedRow.dataset.cabin || '',
    shaft: matchedRow.dataset.shaft || '',
    door:  matchedRow.dataset.door  || '',
    pit:   matchedRow.dataset.pit   || '',
    oh:    matchedRow.dataset.oh    || ''
  } : null;
}



function findModel(capacity, speed) {
  if (!currentBrandData || !Array.isArray(currentBrandData.models)) return null;

  const cap = (capacity || '').toString().trim();
  const spd = Number(speed);

  return currentBrandData.models.find(m => {
    const capKey = (m.capacityKg || m.capacityRange || '').toString().trim();
    return capKey === cap && Number(m.speedMps) === spd;
  }) || null;
}


    function formatCurrency(value, currency) {
        if (isNaN(value)) return '-';
        const v = Number(value).toFixed(2);
        return currency === 'USD'
            ? `${v} USD`
            : `${v} SAR`;
    }

 function generateNumbersView(result, model, currency, mode) {
  const wrapper = document.getElementById('numbers-wrapper');

  const per = (v) => formatCurrency(v, currency);
  const both = (perLift, total) =>
    `${per(perLift)} <span style="font-size:11px;color:#6b7280;">/ Ù„ÙƒÙ„ Ù…ØµØ¹Ø¯</span><br>` +
    `${per(total)} <span style="font-size:11px;color:#6b7280;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ (${result.liftsCount})</span>`;

  // âœ… ÙˆØ¶Ø¹ "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙ‚Ø·"
  if (mode === "totalOnly") {
    wrapper.innerHTML = `
      <div class="numbers-grid">
        <div class="number-box" style="border:2px solid #059669;">
          <div class="label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${result.includeVat ? 'Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©' : 'Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©'}</div>
          <div class="value">${both(result.totalWithVatPerLift, result.totalWithVat)}</div>
        </div>
      </div>

      <div style="margin-top: 10px; font-size: 12px; color:#6b7280;">
        <span class="badge">${BRAND_SOURCES[result.brandKey].label}</span>
        Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯: ${result.liftsCount} â€“ Ø³Ø¹Ø© ${model.capacityKg} kg â€“ Ø³Ø±Ø¹Ø© ${model.speedMps} m/s â€“ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: ${result.floors}.
      </div>
    `;
    return;
  }

  // âœ… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙƒØ§Ù…Ù„ (ÙƒÙ…Ø§ Ù‡Ùˆ Ø¹Ù†Ø¯Ùƒ)
  wrapper.innerHTML = `
    <div class="numbers-grid">
      <div class="number-box">
        <div class="label">Ø³Ø¹Ø± Ø§Ù„Ù…ØµÙ†Ø¹ (FOB)</div>
        <div class="value">${both(result.factoryCostPerLift, result.factoryCost)}</div>
      </div>

      <div class="number-box">
        <div class="label">Ø§Ù„Ø´Ø­Ù† + Ø§Ù„ØªØ£Ù…ÙŠÙ†</div>
        <div class="value">${both(result.shippingInsurancePerLift, result.shippingInsuranceCost)}</div>
      </div>

      ${(!result.shippingDiscountTotalSar || result.shippingDiscountTotalSar <= 0) ? '' : `
        <div class="number-box">
          <div class="label">Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© (ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø­Ù† ${Math.round((result.shippingDiscountRate || 0) * 100)}%)</div>
          <div class="value">
            ${both(result.shippingDiscountPerLiftSar, result.shippingDiscountTotalSar)}
            <div style="margin-top:6px;font-size:11px;color:#6b7280;">
              Ø§Ù„Ø´Ø­Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ…: ${per(result.shippingBasePerLiftSar)} â€” Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: ${per(result.shippingAfterDiscountPerLiftSar)}
            </div>
          </div>
        </div>
      `}

      <div class="number-box">
        <div class="label">Ø§Ù„ØªØ®Ù„ÙŠØµ + Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</div>
        <div class="value">${both(result.clearanceTransportPerLift, result.clearanceTransportCost)}</div>
      </div>

      <div class="number-box">
        <div class="label">Ø§Ù„ØªØ±ÙƒÙŠØ¨ + Ø§Ù„ØªØ´ØºÙŠÙ„</div>
        <div class="value">${both(result.installationCommissioningPerLift, result.installationCommissioningCost)}</div>
      </div>

      <div class="number-box">
        <div class="label">ØªØ´Ø·ÙŠØ¨ Ø§Ù„ÙƒØ§Ø¨ÙŠÙ†Ø©</div>
        <div class="value">${both(result.cabinExtraPerLift || 0, result.cabinExtraTotal || 0)}</div>
      </div>

      <div class="number-box">
        <div class="label">Ù…ØµØ§Ø±ÙŠÙ ØªØ´ØºÙŠÙ„ (${result.overheadPercent}%)</div>
        <div class="value">${both(result.overheadPerLift, result.overheadCost)}</div>
      </div>

      <div class="number-box">
        <div class="label">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø¨Ø­</div>
        <div class="value">${both(result.costBeforeProfitPerLift, result.costBeforeProfit)}</div>
      </div>

      <div class="number-box">
        <div class="label">Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (${result.profitPercent}%)</div>
        <div class="value">${both(result.profitPerLift, result.profitAmount)}</div>
      </div>

      <div class="number-box">
        <div class="label">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</div>
        <div class="value">${both(result.totalBeforeVatPerLift, result.totalBeforeVat)}</div>
      </div>

      <div class="number-box">
        <div class="label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (${result.vatRate}%)</div>
        <div class="value">${both(result.vatAmountPerLift, result.vatAmount)}</div>
      </div>

      <div class="number-box">
        <div class="label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${result.includeVat ? 'Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©' : 'Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©'}</div>
        <div class="value">${both(result.totalWithVatPerLift, result.totalWithVat)}</div>
      </div>
    </div>

    <div style="margin-top: 10px; font-size: 12px; color:#6b7280;">
      <span class="badge">${BRAND_SOURCES[result.brandKey].label}</span>
      Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯: ${result.liftsCount} â€“ Ø³Ø¹Ø© ${model.capacityKg} kg â€“ Ø³Ø±Ø¹Ø© ${model.speedMps} m/s â€“ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: ${result.floors} (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ${model.baseFloors} Ø¯ÙˆØ±).
    </div>
  `;
}


    function generateQuoteText(result, model, currency) {
        const manualCustomerName = document.getElementById('customer_name').value.trim();
        const projectName = document.getElementById('project_name').value.trim();

        const currencyLabel = currency === 'USD' ? 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ' : 'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ';
        const finalCustomerName = selectedCustomer?.customer_name || manualCustomerName || 'Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„ÙƒØ±ÙŠÙ…';

        const lines = [];

        lines.push(`Ø§Ù„Ø³Ø§Ø¯Ø© / ${finalCustomerName}`);
        if (projectName) {
            lines.push(`Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: Ø¹Ø±Ø¶ Ø³Ø¹Ø± ØªÙˆØ±ÙŠØ¯ ÙˆØªØ±ÙƒÙŠØ¨ Ù…ØµØ¹Ø¯ Ù„Ù…Ø´Ø±ÙˆØ¹ (${projectName}).`);
        } else {
            lines.push(`Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: Ø¹Ø±Ø¶ Ø³Ø¹Ø± ØªÙˆØ±ÙŠØ¯ ÙˆØªØ±ÙƒÙŠØ¨ Ù…ØµØ¹Ø¯.`);
        }

        lines.push('');
        lines.push(`Ù†ÙˆØ¯ Ø£Ù† Ù†Ø´ÙƒØ±ÙƒÙ… Ø¹Ù„Ù‰ ØªÙˆØ§ØµÙ„ÙƒÙ… Ù…Ø¹ Ù…Ø¤Ø³Ø³Ø© Ø¢Ø± ÙƒÙŠ Ø§Ù„ RKLØŒ ÙˆÙŠØ³Ø±Ù‘Ù†Ø§ Ø£Ù† Ù†Ù‚Ø¯Ù‘Ù… Ù„ÙƒÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ØªØ§Ù„ÙŠ:`);

        if (selectedCustomer) {
            lines.push('');
            lines.push(`Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¬Ù‘Ù„Ø© Ù„Ø¯ÙŠÙ†Ø§:`);
            if (selectedCustomer.customer_type === 'company') {
                lines.push(`- Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„: Ø´Ø±ÙƒØ© / Ù…Ø¤Ø³Ø³Ø©.`);
            } else if (selectedCustomer.customer_type === 'individual') {
                lines.push(`- Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„: ÙØ±Ø¯.`);
            }
            if (selectedCustomer.contact_person) {
                lines.push(`- Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø®ÙˆÙ‘Ù„ Ø¨Ø§Ù„ØªÙˆÙ‚ÙŠØ¹: ${selectedCustomer.contact_person}`);
            }
            if (selectedCustomer.cr_number) {
                lines.push(`- Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ: ${selectedCustomer.cr_number}`);
            }
            if (selectedCustomer.tax_number) {
                lines.push(`- Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ: ${selectedCustomer.tax_number}`);
            }
            const addrParts = [
                selectedCustomer.city,
                selectedCustomer.district,
                selectedCustomer.street,
                selectedCustomer.full_address
            ].filter(Boolean);
            if (addrParts.length) {
                lines.push(`- Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${addrParts.join(' - ')}`);
            }
            if (selectedCustomer.mobile) {
                lines.push(`- Ø¬ÙˆØ§Ù„ Ø±Ù‚Ù…: ${selectedCustomer.mobile}`);
            }
            if (selectedCustomer.email) {
                lines.push(`- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${selectedCustomer.email}`);
            }
        }

        lines.push(``);
        lines.push(`1) Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¹Ø¯:`);
        lines.push(`- Ø§Ù„Ù…Ø§Ø±ÙƒØ©: ${BRAND_SOURCES[result.brandKey].label}`);
        lines.push(`- Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª: ${result.liftsCount} Ù…ØµØ¹Ø¯/Ù…ØµØ§Ø¹Ø¯.`);
        lines.push(`- Ø§Ù„Ø³Ø¹Ø©: ${model.capacityKg} kg`);
        lines.push(`- Ø§Ù„Ø³Ø±Ø¹Ø©: ${model.speedMps} m/s`);
        lines.push(`- Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: ${result.floors} Ø¯ÙˆØ± (Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„Ù…ØµÙ†Ø¹ ÙŠØ´Ù…Ù„ ${model.baseFloors} Ø¯ÙˆØ±).`);

        lines.push('');
        lines.push(`2) Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙƒÙ„ÙØ© (${currencyLabel}):`);
        lines.push(`- Ø³Ø¹Ø± Ø§Ù„Ù…ØµÙ†Ø¹ (FOB): ${formatCurrency(result.factoryCost, currency)}`);
        lines.push(`- Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªØ£Ù…ÙŠÙ†: ${formatCurrency(result.shippingInsuranceCost, currency)}`);
        lines.push(`- Ø§Ù„ØªØ®Ù„ÙŠØµ Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠ + Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ: ${formatCurrency(result.clearanceTransportCost, currency)}`);
        lines.push(`- Ø£Ø¬ÙˆØ± Ø§Ù„ØªØ±ÙƒÙŠØ¨ ÙˆØ§Ù„ØªØ´ØºÙŠÙ„: ${formatCurrency(result.installationCommissioningCost, currency)}`);
        lines.push(`- Ù…ØµØ§Ø±ÙŠÙ ØªØ´ØºÙŠÙ„ (${result.overheadPercent}%): ${formatCurrency(result.overheadCost, currency)}`);
        lines.push(`- Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø¨Ø­: ${formatCurrency(result.costBeforeProfit, currency)}`);
        lines.push(`- Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (${result.profitPercent}%): ${formatCurrency(result.profitAmount, currency)}`);

        lines.push('');
        lines.push(`3) Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (${currencyLabel}):`);
        lines.push(`- Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: ${formatCurrency(result.totalBeforeVat, currency)}`);
        lines.push(`- Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ù„Ù„Ù…ØµØ¹Ø¯ Ø§Ù„ÙˆØ§Ø­Ø¯: ${formatCurrency(result.totalBeforeVatPerLift, currency)}`);
        lines.push(`- Ù‚ÙŠÙ…Ø© Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© (${result.vatRate}%): ${formatCurrency(result.vatAmount, currency)}`);
        lines.push(`- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${result.includeVat ? 'Ø´Ø§Ù…Ù„' : 'Ø¨Ø¯ÙˆÙ†'} Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©: ${formatCurrency(result.totalWithVat, currency)}.`);

        lines.push('');
        lines.push(`*Ù…Ù„Ø§Ø­Ø¸Ø§Øª:*`);
        lines.push(`- Ø¨Ù„Ø¯ Ø§Ù„Ù…Ù†Ø´Ø£: ${model.notes || 'Ø­Ø³Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµÙ†Ø¹'}.`);
        lines.push(`- Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø©: ${model.machineType || 'Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª'} â€“ Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨: ${model.doorType || 'Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙÙ†ÙŠ'}.`);
        lines.push(`- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ø§ ØªØ´Ù…Ù„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠØ© ÙˆØ§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ù†ÙØµÙ‘ Ø¹Ù„Ù‰ Ø®Ù„Ø§Ù Ø°Ù„Ùƒ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙÙ†ÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ.`);
        lines.push('');
        lines.push(`Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ù…Ø¨Ø¯Ø¦ÙŠØŒ ÙˆÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆÙ…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠ ÙˆØ´Ø±ÙˆØ· Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.`);
        lines.push('');
        lines.push(`Ù…Ø¹ Ø®Ø§Ù„Øµ Ø§Ù„ØªØ­ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±ØŒ`);
        lines.push(`Ù…Ø¤Ø³Ø³Ø© Ø¢Ø± ÙƒÙŠ Ø§Ù„ RKL Ù„Ù„Ù…ØµØ§Ø¹Ø¯ ÙˆØ§Ù„Ø³Ù„Ø§Ù„Ù… Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©.`);

        document.getElementById('quote_text').value = lines.join('\n');
    }
function getRegionAdderSar(loc) {
  const s = (loc || "").toLowerCase();

  // Ø§Ù„Ø±ÙŠØ§Ø¶ = Ø¨Ø¯ÙˆÙ† Ø²ÙŠØ§Ø¯Ø©
  if (s.includes("Ø§Ù„Ø±ÙŠØ§Ø¶") || s.includes("riyadh")) return 0;

  // Ù…Ø¯Ù† Ù‚Ø±ÙŠØ¨Ø©
  if (s.includes("Ø§Ù„Ø®Ø±Ø¬") || s.includes("kharj")) return 800;
  if (s.includes("Ø§Ù„Ù‚ØµÙŠÙ…") || s.includes("qassim") || s.includes("Ø¨Ø±ÙŠØ¯Ø©")) return 1800;

  // Ù…Ø¯Ù† Ø¨Ø¹ÙŠØ¯Ø©
  if (s.includes("Ø¬Ø¯Ø©") || s.includes("jeddah") || s.includes("Ù…ÙƒØ©") || s.includes("makkah")) return 3500;
  if (s.includes("Ø§Ù„Ø¯Ù…Ø§Ù…") || s.includes("dammam") || s.includes("Ø§Ù„Ø®Ø¨Ø±") || s.includes("khobar")) return 3000;
  if (s.includes("Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©") || s.includes("madinah")) return 3200;
  if (s.includes("Ø£Ø¨Ù‡Ø§") || s.includes("abha") || s.includes("Ø®Ù…ÙŠØ³")) return 3800;
  if (s.includes("ØªØ¨ÙˆÙƒ") || s.includes("tabuk")) return 4500;
  if (s.includes("Ø¬Ø§Ø²Ø§Ù†") || s.includes("jazan")) return 4800;
  if (s.includes("Ù†Ø¬Ø±Ø§Ù†") || s.includes("najran")) return 5200;

  // Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ùˆ Ù…Ø¯ÙŠÙ†Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©
  return 2500;
}
  
function getShippingMetaByQty(qty) {
  const base = COST_PARAMS.shippingUsdPerLift; // 500
  let discount = 0;

  if (qty >= 10) discount = 0.22;
  else if (qty >= 6) discount = 0.15;
  else if (qty >= 3) discount = 0.08;

  const minPerLift = 280;
  const discounted = Math.max(base * (1 - discount), minPerLift);

  return {
    baseUsd: base,
    discountedUsd: discounted,
    discountRate: discount,
    discountUsd: Math.max(0, base - discounted)
  };
}

function getShippingUsdPerLiftByQty(qty) {
  const base = COST_PARAMS.shippingUsdPerLift; // 500
  let discount = 0;

  if (qty >= 10) discount = 0.22;
  else if (qty >= 6) discount = 0.15;
  else if (qty >= 3) discount = 0.08;

  const minPerLift = 280; // USD
  return Math.max(base * (1 - discount), minPerLift);
}

async function calculateQuote() {
  const brandKey = document.getElementById('brand').value;
  const divisor = 1; // Ø§Ù„Ø­Ø³Ø§Ø¨ per lift

  const capacity = document.getElementById('capacity').value;
  const speed = document.getElementById('speed').value;
  const floors = Number(document.getElementById('floors').value);
  const liftsCount = Number(document.getElementById('lifts_count').value) || 1;

  const currency = document.getElementById('currency').value;
  const vatRate = Number(document.getElementById('vat_rate').value) || 0;
  const includeVat = document.getElementById('include_vat').checked;

  const projectLocation = document.getElementById('project_location')?.value || '';

  if (!brandKey || !capacity || !speed || !floors || floors < 2 || liftsCount < 1) {
    alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ Ø£Ø¯ÙˆØ§Ø± ØµØ­ÙŠØ­ (Ù¢ ÙØ£ÙƒØ«Ø±) ÙˆØ¹Ø¯Ø¯ Ù…ØµØ§Ø¹Ø¯ ÙˆØ§Ø­Ø¯ ÙØ£ÙƒØ«Ø±.');
    return;
  }

  if (!currentBrandData) await loadBrandData(brandKey);
  if (!currentBrandData) {
    console.log("âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ø±ÙƒØ©");
    return;
  }

  const model = findModel(capacity, speed);
  if (!model) {
    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙ„ÙŠÙØ© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ÙÙŠ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¹Ø§Ø±.');
    return;
  }

  const rate = Number(currentBrandData.exchangeRateToSAR || 1);
  const isLocalAssembly = (brandKey === 'LOCAL_MRL');

  // =========================
  // 1) Extra floors safe
  // =========================
  const baseFloorsSafe = Number(model.baseFloors || 2);
  const extraFloors = Math.max(0, floors - baseFloorsSafe);

  // =========================
  // 2) Normalize base price
  // =========================
  const baseSar =
    (Number(model.basePriceSar) > 0)
      ? Number(model.basePriceSar)
      : (Number(model.basePriceUsd) > 0 ? Number(model.basePriceUsd) * rate : NaN);

  const extraSar =
    (Number(model.extraPerFloorSar) > 0)
      ? Number(model.extraPerFloorSar)
      : (Number(model.extraPerFloorUsd) > 0 ? Number(model.extraPerFloorUsd) * rate : 0);

  if (Number.isNaN(baseSar)) {
    alert('Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙŠØ­ØªÙˆÙŠ Ù…ÙˆØ¯ÙŠÙ„ Ø¨Ø¯ÙˆÙ† basePriceSar Ø£Ùˆ basePriceUsd Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.');
    return;
  }

  // âœ… Factory SAR
  let factorySar = baseSar + (extraSar * extraFloors);

  // USD (for insurance)
  const factoryUsd =
    (Number(model.basePriceUsd) > 0)
      ? (Number(model.basePriceUsd) + (Number(model.extraPerFloorUsd || 0) * extraFloors))
      : (factorySar / rate);

  // =========================
  // 3) Shipping + insurance
  // =========================
  const shipUsdPerLift = getShippingUsdPerLiftByQty(liftsCount);

  const shippingInsuranceSar = isLocalAssembly
    ? 0
    : (
      (shipUsdPerLift * rate) +
      (factoryUsd * (COST_PARAMS.insurancePercent / 100) * rate)
    );

  // =========================
  // 4) Clearance + inland + region
  // =========================
  const regionAdder = getRegionAdderSar(projectLocation);

  const clearanceTransportSar = isLocalAssembly
    ? (COST_PARAMS.inlandTransportSar + regionAdder)
    : (COST_PARAMS.clearanceSar + COST_PARAMS.inlandTransportSar + regionAdder);

  // Shipping meta for UI
  const shipMeta = getShippingMetaByQty(liftsCount);

  const shippingBasePerLiftSar = isLocalAssembly ? 0 : (shipMeta.baseUsd * rate);
  const shippingAfterDiscountPerLiftSar = isLocalAssembly ? 0 : (shipMeta.discountedUsd * rate);
  const shippingDiscountPerLiftSar = isLocalAssembly ? 0 : (shipMeta.discountUsd * rate);

  const shippingBaseTotalSar = shippingBasePerLiftSar * liftsCount;
  const shippingAfterDiscountTotalSar = shippingAfterDiscountPerLiftSar * liftsCount;
  const shippingDiscountTotalSar = shippingDiscountPerLiftSar * liftsCount;

  // =========================
  // 5) Install + commissioning
  // =========================
  const installationCommissioningSar = COST_PARAMS.installationSar + COST_PARAMS.commissioningSar;

  // Cabin extra
  const cabinDesign = document.getElementById("cabin_design").value;
  const cabinExtraCost = CABIN_DESIGN_ADDITIONAL[cabinDesign] || 0;

  // Profit percent (per brand)
  const profitPercent =
    brandKey === 'VERTILIFT_MRL'
      ? COST_PARAMS.profitPercent + 3
      : COST_PARAMS.profitPercent;

  // âœ… LOCAL compare with FUJI Â±5% (if you use it)
  if (isLocalAssembly && window.lastFujiFactorySar) {
    const maxDiff = window.lastFujiFactorySar * 0.05;
    factorySar = Math.min(
      Math.max(factorySar, window.lastFujiFactorySar - maxDiff),
      window.lastFujiFactorySar + maxDiff
    );
  }

  // =========================
  // 6) Direct cost (after final factorySar)
  // =========================
  const directCostSar =
    factorySar +
    shippingInsuranceSar +
    clearanceTransportSar +
    installationCommissioningSar +
    cabinExtraCost;

  // Overhead
  const overheadSar = directCostSar * (COST_PARAMS.overheadPercent / 100);

  // Cost before profit
  const costBeforeProfitSar = directCostSar + overheadSar;

  // Profit
  const profitSar = costBeforeProfitSar * (profitPercent / 100);

  // Total before VAT (per lift)
  const totalBeforeVatPerLift = (costBeforeProfitSar + profitSar) / divisor;

  // VAT per lift
  const vatAmountPerLift = totalBeforeVatPerLift * (vatRate / 100);

  // Total with VAT per lift (always real)
  const totalWithVatPerLift = totalBeforeVatPerLift + vatAmountPerLift;

  // =========================
  // Totals for all lifts
  // =========================
  const totalBeforeVatTotal = totalBeforeVatPerLift * liftsCount;
  const vatAmountTotal = vatAmountPerLift * liftsCount;
  const totalWithVatTotal = totalWithVatPerLift * liftsCount;

  // Other per-lift breakdowns (for your boxes)
  const factoryCostPerLift = factorySar / divisor;
  const shippingInsurancePerLift = shippingInsuranceSar / divisor;
  const clearanceTransportPerLift = clearanceTransportSar / divisor;
  const installationCommissioningPerLift = installationCommissioningSar / divisor;

  const overheadPerLift = overheadSar / divisor;
  const costBeforeProfitPerLift = costBeforeProfitSar / divisor;
  const profitPerLift = profitSar / divisor;

  // Totals breakdown
  const factoryCostTotal = factoryCostPerLift * liftsCount;
  const shippingInsuranceTotal = shippingInsurancePerLift * liftsCount;
  const clearanceTransportTotal = clearanceTransportPerLift * liftsCount;
  const installationCommissioningTotal = installationCommissioningPerLift * liftsCount;
  const overheadTotal = overheadPerLift * liftsCount;
  const costBeforeProfitTotal = costBeforeProfitPerLift * liftsCount;
  const profitTotal = profitPerLift * liftsCount;

  const result = {
    brandKey,
    floors,
    liftsCount,

    // per lift
    factoryCostPerLift,
    shippingInsurancePerLift,
    clearanceTransportPerLift,
    installationCommissioningPerLift,
    overheadPerLift,
    costBeforeProfitPerLift,
    profitPerLift,
    totalBeforeVatPerLift,
    vatAmountPerLift,
    totalWithVatPerLift,

    // shipping discount meta (for UI only)
    shippingDiscountRate: shipMeta.discountRate,
    shippingBasePerLiftSar,
    shippingAfterDiscountPerLiftSar,
    shippingDiscountPerLiftSar,
    shippingBaseTotalSar,
    shippingAfterDiscountTotalSar,
    shippingDiscountTotalSar,

    // totals
    factoryCost: factoryCostTotal,
    shippingInsuranceCost: shippingInsuranceTotal,
    clearanceTransportCost: clearanceTransportTotal,
    installationCommissioningCost: installationCommissioningTotal,
    overheadCost: overheadTotal,
    costBeforeProfit: costBeforeProfitTotal,
    profitAmount: profitTotal,
    totalBeforeVat: totalBeforeVatTotal,
    vatRate,
    vatAmount: vatAmountTotal,
    totalWithVat: totalWithVatTotal,

    // UI flag only
    includeVat,
    overheadPercent: COST_PARAMS.overheadPercent,
    cabinExtraPerLift: cabinExtraCost,
    cabinExtraTotal: cabinExtraCost * liftsCount,
    profitPercent
  };

  // âœ… Ø§Ø¬Ø¨Ø§Ø± LOCAL_MRL Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„
  const mode = (brandKey === "LOCAL_MRL") ? "full" : (window.__rklPricingMode || "full");
  generateNumbersView(result, model, currency, mode);
  generateQuoteText(result, model, currency);

  // =========================
  // âœ… IMPORTANT: Snapshot fields for saving + 7-1
  // =========================
  // âœ… 7-1 ÙŠØ­ØªØ§Ø¬ "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©" Ù„Ø£Ù† Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ØªÙØ¶Ø§Ù Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶
  const unitPriceBeforeVat = Number(result.totalBeforeVatPerLift || 0);
  const unitPriceWithVat   = Number(result.totalWithVatPerLift || 0);

  // ===== customer + project
  const manualCustomerName = document.getElementById('customer_name').value.trim();
  const projectName = document.getElementById('project_name').value.trim();

  const finalCustomerName =
    (selectedCustomer?.customer_name || manualCustomerName || 'Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„ÙƒØ±ÙŠÙ…').trim();

  const brandLabel = BRAND_SOURCES[brandKey]?.label || brandKey;

  // ===== sizes summary
  const shaftRows = document.querySelectorAll("#shaft-table tbody tr");
  const shaftsSummary = [];

  shaftRows.forEach((row, index) => {
    const shaft = row.querySelector(".shaft-select")?.value || "";
    const cabin = row.querySelector(".cabin-cell")?.innerText || "";
    const door  = row.querySelector(".door-cell")?.innerText || "";
    if (shaft || cabin || door) shaftsSummary.push(`Ù…ØµØ¹Ø¯ ${index + 1}: Ø¨Ø¦Ø± ${shaft} | ÙƒØ§Ø¨ÙŠÙ† ${cabin} | Ø¨Ø§Ø¨ ${door}`);
  });

  const selectedCabin = [];
  const selectedShaft = [];
  const selectedDoor  = [];
  const selectedPit   = [];
  const selectedOH    = [];

  shaftRows.forEach((row) => {
    const shaft = row.querySelector(".shaft-select")?.value || '';
    const cabin = row.querySelector(".cabin-cell")?.innerText || '';
    const door  = row.querySelector(".door-cell")?.innerText || '';
    const pit   = row.querySelector(".pit-cell")?.innerText || '';
    const oh    = row.querySelector(".oh-cell")?.innerText || '';

    if (cabin) selectedCabin.push(cabin);
    if (shaft) selectedShaft.push(shaft);
    if (door)  selectedDoor.push(door);
    if (pit)   selectedPit.push(pit);
    if (oh)    selectedOH.push(oh);
  });

  const quoteNumber = `RKL-${new Date().getFullYear()}-${Date.now().toString().slice(-5)}`;
    const en81 = syncEN81ByCapacity(capacity);
if (!en81) {
    alert("Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ù‚Ø§Ø³Ø§Øª EN81 Ù…Ø·Ø§Ø¨Ù‚Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚.");
    return;
}


  lastQuoteSnapshot = {
    quoteNumber,

    timestamp: new Date().toISOString(),
    customerName: finalCustomerName || '',
    projectName: projectName || '',
    projectLocation: projectLocation || '',

    brandKey,
    brandLabel,

    capacity: capacity ? (capacity + ' kg') : '',
    speed: speed ? (speed + ' m/s') : '',
    floors: floors || '',
    floorHeight: document.getElementById('floorHeight')?.value || '',
    travelHeight: document.getElementById('travelHeight')?.value || '',
    liftsCount: liftsCount || 1,

    shaftsSummary: shaftsSummary || '',

shaftSize: en81?.shaft || '',
cabinSize: en81?.cabin || '',
doors: en81?.door || '',
pit: en81?.pit || '',
oh: en81?.oh || '',



    cabinDesign: document.getElementById("cabin_design")?.value || 'Standard',
    floorFinish: document.getElementById("floor_finish")?.value || 'Standard',

    machineType: model?.machineType || 'MRL â€“ Traction',
    stops: floors || '',

    // âœ… Totals
    totalBeforeVat: Number(result.totalBeforeVat || 0),
    vatAmount: Number(result.vatAmount || 0),
    totalWithVat: Number(result.totalWithVat || 0),

    // âœ… Unit prices
    // Ù‡Ø°Ø§ ÙŠØ³ØªØ®Ø¯Ù…Ù‡ 7-1
    pricePerUnitBeforeVat: unitPriceBeforeVat,

    // Ù‡Ø°Ø§ Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„ "Ø³Ø¹Ø± Ø§Ù„Ù…ØµØ¹Ø¯ Ø§Ù„ÙˆØ§Ø­Ø¯ (Ø´Ø§Ù…Ù„)"
    pricePerUnitWithVat: unitPriceWithVat,

    // (Ù„Ù„ØªÙˆØ§ÙÙ‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ù†Ø¯Ùƒ ÙƒÙˆØ¯ Ù‚Ø¯ÙŠÙ… ÙŠÙ‚Ø±Ø£ pricePerUnit)
    // Ù†Ø¬Ø¹Ù„Ù‡ "Ø´Ø§Ù…Ù„" Ù„Ø£Ù† Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø¹Ù†Ø¯Ùƒ (Ø´Ø§Ù…Ù„)
    pricePerUnit: unitPriceWithVat,

    totalBeforeVatPerLift: Number(result.totalBeforeVatPerLift || 0),
    vatAmountPerLift: Number(result.vatAmountPerLift || 0),
    totalWithVatPerLift: Number(result.totalWithVatPerLift || 0),

    currency: currency || 'SAR',
    vatRate: vatRate || 15,
    includeVat: includeVat === true,

    payments: {
      advance50: Number(result.totalWithVat || 0) ? (Number(result.totalWithVat) * 0.50) : 0,
      mechanical25: Number(result.totalWithVat || 0) ? (Number(result.totalWithVat) * 0.25) : 0,
      electrical20: Number(result.totalWithVat || 0) ? (Number(result.totalWithVat) * 0.20) : 0,
      handover5: Number(result.totalWithVat || 0) ? (Number(result.totalWithVat) * 0.05) : 0
    },

    preferredContact: selectedCustomer?.preferred_contact || '',
    customerDetails: selectedCustomer ? {
      customer_type: selectedCustomer.customer_type || '',
      contact_person: selectedCustomer.contact_person || '',
      id_number: selectedCustomer.id_number || '',
      cr_number: selectedCustomer.cr_number || '',
      tax_number: selectedCustomer.tax_number || '',
      city: selectedCustomer.city || '',
      district: selectedCustomer.district || '',
      street: selectedCustomer.street || '',
      building_no: selectedCustomer.building_no || '',
      postal_code: selectedCustomer.postal_code || '',
      full_address: selectedCustomer.full_address || '',
      mobile: selectedCustomer.mobile || '',
      phone: selectedCustomer.phone || '',
      email: selectedCustomer.email || '',
      preferred_contact: selectedCustomer.preferred_contact || '',
      notes: selectedCustomer.notes || '',
    } : {}
  };
}





    // ========================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ==========================
       // ========================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ==========================
    (function init() {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† ØµÙØ­Ø© customer-manager
        populateCustomerDropdown();

        // ØªØ­Ù…ÙŠÙ„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        renderQuotesTable();

        const customerSelect = document.getElementById('customer_select');
        if (customerSelect) {
            customerSelect.addEventListener('change', () => {
    const idx = customerSelect.value;

    if (idx === '') {
        selectedCustomer = null;
        renderCustomerDetails(null);
        return;
    }

    const customers = loadStoredCustomers();
    const customer = customers[Number(idx)];
    applyCustomerToForm(customer);
});

        }

   document.getElementById("printOfferButton").addEventListener("click", function () {
    const selected = document.querySelector(".quote-check:checked");

    if (!selected) {
        alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø±Ø¶ Ø³Ø¹Ø± ÙˆØ§Ø­Ø¯ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
    }

    const index = selected.dataset.index;

    // Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ØªØ§Ø±
    localStorage.setItem("rkl_current_quote_index", index);

    // ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¹Ø±Ø¶
    window.open("elevator-quote-offer.html", "_blank");
});




        // Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„ÙŠØ© ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        document.getElementById('numbers-wrapper').innerHTML =
            '<div class="hint">Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ø«Ù… Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±.</div>';

        // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ©: ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø³Ø¹Ø§Øª
        document.getElementById('brand').addEventListener('change', async function () {
            const brandKey = this.value;
            document.getElementById('capacity').disabled = true;
            document.getElementById('speed').disabled = true;

            if (!brandKey) {
                currentBrandData = null;
                document.getElementById('numbers-wrapper').innerHTML =
                    '<div class="hint">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ø£ÙˆÙ„Ø§Ù‹.</div>';
                return;
            }

            await loadBrandData(brandKey);
            if (!currentBrandData) return;

            fillCapacityOptions();
            document.getElementById('numbers-wrapper').innerHTML =
                '<div class="hint">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© Ø«Ù… Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ø¶ØºØ· "Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±".</div>';
        });

        // Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø¹Ø©: ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø³Ø±Ø¹Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        document.getElementById('capacity').addEventListener('change', fillSpeedOptions);

        // Ø²Ø± Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±
        document.getElementById('calc-btn').addEventListener('click', async () => {
  const mode = await window.RKL_REQUEST_PRICING_MODE();
  if (!mode) return; // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ØºÙ„Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø£Ùˆ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø·Ø£
  window.__rklPricingMode = mode; // "totalOnly" Ø£Ùˆ "full"
  await calculateQuote();
});


        // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        document.getElementById('reset-btn').addEventListener('click', function () {
            currentBrandData = null;
            document.getElementById('capacity').innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¹Ø©...</option>';
            document.getElementById('capacity').disabled = true;
            document.getElementById('speed').innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø±Ø¹Ø©...</option>';
            document.getElementById('speed').disabled = true;
            document.getElementById('numbers-wrapper').innerHTML =
                '<div class="hint">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø³Ø¹Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø© Ø«Ù… Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±.</div>';
            document.getElementById('quote_text').value = '';

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„
            populateCustomerDropdown();
            renderQuotesTable();

            selectedCustomer = null;
            if (customerSelect) customerSelect.value = '';
        });

        // Ø²Ø± Ù†Ø³Ø® Ø§Ù„Ù†Øµ
        document.getElementById('copy-btn').addEventListener('click', function () {
            const textarea = document.getElementById('quote_text');
            if (!textarea.value.trim()) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ Ù„Ù†Ø³Ø®Ù‡ØŒ Ù‚Ù… Ø¨Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            textarea.select();
            document.execCommand('copy');
            alert('ØªÙ… Ù†Ø³Ø® Ù†Øµ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±.');
        });

         // Ø²Ø± Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
    const saveBtn = document.getElementById('save-quote-btn');
    if (saveBtn) {
        saveBtn.addEventListener('click', () => {
            if (!lastQuoteSnapshot) {
                alert('Ù‚Ù… Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø­Ø³Ø§Ø¨ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„ Ø­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„.');
                return;
            }

            // 1) Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ø®Ø²Ù†Ø© ÙˆØªØ¬Ù‡ÙŠØ² Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯
            const quotes = loadStoredQuotes();

            const nextIndex = quotes.length + 1;
            const today = new Date();
            const ymd = today.toISOString().slice(0, 10).replace(/-/g, '');
            const quoteNumber = 'Q-' + new Date().toISOString().slice(0,10).replaceAll('-','') 
                    + '-' + Math.floor(Math.random() * 1000);

            // 2) Ù‚Ø±Ø§Ø¡Ø© Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
            const manualCustomerName = document.getElementById('customer_name').value.trim();
            const projectName = document.getElementById('project_name').value.trim();
            const projectLocation = document.getElementById("project_location")?.value || "";

            const finalCustomerName =
                (selectedCustomer?.customer_name || manualCustomerName || 'Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„ÙƒØ±ÙŠÙ…').trim();
            



            // 3) ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø°ÙŠ ÙŠØ°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„
            const entry = {
    ...lastQuoteSnapshot,
    quoteNumber,
    customerName: finalCustomerName,
    projectName,
    projectLocation: projectLocation || '', // âœ…

    // âœ… ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„Ø©
    customerDetails: selectedCustomer ? {
        customer_type: selectedCustomer.customer_type || '',
        contact_person: selectedCustomer.contact_person || '',
        id_number: selectedCustomer.id_number || '',
        cr_number: selectedCustomer.cr_number || '',
        tax_number: selectedCustomer.tax_number || '',
        city: selectedCustomer.city || '',
        district: selectedCustomer.district || '',
        street: selectedCustomer.street || '',
        building_no: selectedCustomer.building_no || '',
        postal_code: selectedCustomer.postal_code || '',
        full_address: selectedCustomer.full_address || '',
        mobile: selectedCustomer.mobile || '',
        phone: selectedCustomer.phone || '',
        email: selectedCustomer.email || '',
       

        notes: selectedCustomer.notes || ''
    } : null
};



            // Ø­ÙØ¸Ù‡ ÙÙŠ Ù…ØµÙÙˆÙØ© Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
            quotes.push(entry);
            saveQuotesToStorage(quotes);
            renderQuotesTable();

            // 4) ØªØ¬Ù‡ÙŠØ² Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ (Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ elevator-quote-offer.html)
            const offerData = {
                quoteNumber,

                customer: {
                    name: finalCustomerName,
                    type: selectedCustomer?.customer_type || null,
                    contactPerson: selectedCustomer?.contact_person || null,
                    idNumber: selectedCustomer?.id_number || null,
                    crNumber: selectedCustomer?.cr_number || null,
                    tax_Number: selectedCustomer?.tax_number || null,
                    city: selectedCustomer?.city || null,
                    district: selectedCustomer?.district || null,
                    street: selectedCustomer?.street || null,
                    buildingNo: selectedCustomer?.building_no || null,
                    postalCode: selectedCustomer?.postal_code || null,
                    address: selectedCustomer?.full_address || null,
                    mobile: selectedCustomer?.mobile || null,
                    phone: selectedCustomer?.phone || null,
                    email: selectedCustomer?.email || null,
                    preferredContact: selectedCustomer?.preferred_contact || null,
                    notes: selectedCustomer?.notes || null
                },

                project: {
                    name: projectName,
                    date: entry.timestamp,
                    brandKey: entry.brandKey,
                    brandLabel: entry.brandLabel,
                    capacityKg: entry.capacity,
                    speedMps: entry.speed,
                    floors: entry.floors,
                    liftsCount: entry.liftsCount
                },

pricing: {
  currency: entry.currency,
  vatRate: entry.vatRate,
  includeVat: entry.includeVat,

  // âœ… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
  totalWithVat: Number(entry.totalWithVat || 0),

  // âœ… Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© (Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø§Ù„Ù€ entry)
  totalBeforeVat: Number(entry.totalBeforeVat || 0),
  vatAmount: Number(entry.vatAmount || 0),

  // âœ… Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (Ø­ØªÙ‰ Ù„Ø§ ØªÙ†Ø¶Ø±Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© Ø¨Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©)
  unitTotalWithVat: Number(entry.pricePerUnit || 0),

  unitTotalBeforeVat: (Number(entry.totalBeforeVat || 0) && Number(entry.liftsCount || 1))
    ? (Number(entry.totalBeforeVat || 0) / Number(entry.liftsCount || 1))
    : 0,

  unitVatAmount: (Number(entry.vatAmount || 0) && Number(entry.liftsCount || 1))
    ? (Number(entry.vatAmount || 0) / Number(entry.liftsCount || 1))
    : 0,

  liftsCount: Number(entry.liftsCount || 1)
},



                quoteText: document.getElementById('quote_text').value
            };
            // ØªØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ù…Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ§Ø¹Ø¯
const shaftRows = document.querySelectorAll("#shaft-table tbody tr");
const shaftData = [];
// Ø­Ø³Ø§Ø¨ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø±Ø­Ù„Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
document.getElementById('floors')?.addEventListener('input', calculateTravelHeight);

// Ø­Ø³Ø§Ø¨ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø±Ø­Ù„Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¯ÙˆØ±
document.getElementById('floorHeight')?.addEventListener('input', calculateTravelHeight);

            
shaftRows.forEach((row, index) => {
    const shaft = row.querySelector(".shaft-select")?.value || "";
    const cabin = row.querySelector(".cabin-cell")?.innerText || "";
    const door = row.querySelector(".door-cell")?.innerText || "";
    const note = row.querySelector(".note-input")?.value || "";

    shaftData.push({
        elevator: index + 1,
        shaft,
        cabin,
        door,
        note
    });
});

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ offerData
offerData.shafts = shaftData;


            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ elevator-quote-offer.html
            localStorage.setItem('rkl_last_offer', JSON.stringify(offerData));

            alert('ØªÙ… Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø³Ø¬Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².');
        });
    }

        // Ø²Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„ Ø¥Ù„Ù‰ CSV
        const exportBtn = document.getElementById('export-quotes-btn');
        if (exportBtn) {
            exportBtn.addEventListener('click', () => {
                const quotes = loadStoredQuotes();
                if (!quotes.length) {
                    alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ø¹Ø±ÙˆØ¶ Ø£Ø³Ø¹Ø§Ø± Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„ØªØµØ¯ÙŠØ±.');
                    return;
                }

                const header = [
                    '#',
                    'Ø±Ù‚Ù… Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±',
                    'Ø§Ù„ØªØ§Ø±ÙŠØ®',
                    'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„',
                    'Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
                    'Ø§Ù„Ù…Ø§Ø±ÙƒØ©',
                    'Ø§Ù„Ø³Ø¹Ø©',
                    'Ø§Ù„Ø³Ø±Ø¹Ø©',
                    'Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯',
                    'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©',
                    'Ø§Ù„Ø¹Ù…Ù„Ø©'
                ];

                const rows = [header.join(',')];

                quotes.forEach((q, index) => {
                    const dateStr = q.timestamp ? q.timestamp.slice(0, 10) : '';
                    const totalStr = (Number(q.totalWithVat) || 0).toFixed(2);

                    rows.push([
                        index + 1,
                        q.quoteNumber || '',
                        dateStr,
                        `"${q.customerName || ''}"`,
                        `"${q.projectName || ''}"`,
                        `"${q.brandLabel || q.brandKey || ''}"`,
                        q.capacity || '',
                        q.speed || '',
                        q.liftsCount || '',
                        totalStr,
                        q.currency || 'SAR'
                    ].join(','));
                });

                const csvContent = '\uFEFF' + rows.join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'rkl_elevator_quotes.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }
    })();

    const CURRENT_QUOTE_SELECTION_KEY = "rkl_current_quote_number";

   const en81Options = [
  { shaft: "1500 Ã— 1700", cabin: "1000 Ã— 1100", door: "700", pit: "1200", oh: "3500" },
  { shaft: "1600 Ã— 1800", cabin: "1100 Ã— 1200", door: "700", pit: "1200", oh: "3500" },
  { shaft: "1800 Ã— 2000", cabin: "1100 Ã— 1400", door: "900", pit: "1300", oh: "3600" },
  { shaft: "2000 Ã— 2400", cabin: "1400 Ã— 1600", door: "1000", pit: "1400", oh: "3700" },
  { shaft: "2400 Ã— 2600", cabin: "1600 Ã— 1800", door: "1100", pit: "1400", oh: "3800" }
];


// Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¹Ø¯
document.getElementById("lifts_count").addEventListener("input", function () {
    const count = Number(this.value);
    const container = document.getElementById("shaft-table-container");
    const tbody = document.querySelector("#shaft-table tbody");
    
    if (count > 0) container.style.display = "block";
    else container.style.display = "none";

    tbody.innerHTML = ""; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    
    for (let i = 1; i <= count; i++) {
        const row = document.createElement("tr");

       row.innerHTML = `
  <td>${i}</td>
  <td>
    <select class="shaft-select">
      <option value="">Ø§Ø®ØªØ± Ù…Ù‚Ø§Ø³ Ø§Ù„Ø¨Ø¦Ø±â€¦</option>
      ${en81Options.map(o => `<option value="${o.shaft}">${o.shaft}</option>`).join("")}
    </select>
  </td>
  <td class="cabin-cell"></td>
  <td class="door-cell"></td>
  <td class="pit-cell"></td>
  <td class="oh-cell"></td>
  <td>${document.getElementById('floorHeight')?.value || '-' } mm</td>
<td>${document.getElementById('travelHeight')?.value || '-' } mm</td>

`;

        
        tbody.appendChild(row);
    }

    // Ø±Ø¨Ø· ØªØºÙŠÙŠØ± ÙƒÙ„ Ø§Ø®ØªÙŠØ§Ø±
    document.querySelectorAll(".shaft-select").forEach((select, idx) => {
        select.addEventListener("change", function () {
            const opt = en81Options.find(o => o.shaft === this.value);
            const row = this.closest("tr");
            if (opt) {
                row.querySelector(".cabin-cell").innerText = opt.cabin;
row.querySelector(".door-cell").innerText  = opt.door;
row.querySelector(".pit-cell").innerText   = opt.pit;
row.querySelector(".oh-cell").innerText    = opt.oh;

            }
        });
    });
});



</script>

<script>
function calculateTravelHeight() {
    const floors = Number(document.getElementById('floors')?.value);
    const floorHeightMM = Number(document.getElementById('floorHeight')?.value);
    const travelInput = document.getElementById('travelHeight');

    if (!travelInput) return;

    if (floors >= 2 && floorHeightMM > 0) {
        const travelMM = (floors - 1) * floorHeightMM;
        travelInput.value = Math.round(travelMM);
    } else {
        travelInput.value = '';
    }
}


// Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
['floors', 'floorHeight'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;

    el.addEventListener('input', calculateTravelHeight);
    el.addEventListener('change', calculateTravelHeight);
});
// ===============================
// ØªÙØ¹ÙŠÙ„ / Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
// ===============================
document.getElementById('enable_compare').addEventListener('change', e => {
  document.getElementById('compare_brands_box').style.display =
    e.target.checked ? 'block' : 'none';
});

// ===============================
// Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
// ===============================
async function calculateComparison(baseInputs) {
  const selectedBrands = [...document.querySelectorAll('.compare-brand:checked')]
    .map(cb => cb.value)
    .slice(0, 3);

  if (selectedBrands.length < 2) return;

  const results = [];

  for (const brand of selectedBrands) {
    await loadBrandData(brand);              // Ù†ÙØ³ Ø¯Ø§Ù„ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    const model = findModel(baseInputs.capacity, baseInputs.speed);

    if (!model) continue;

    const quote = calculateInternalQuote(model, baseInputs);
    results.push({ brand, ...quote });
  }

  renderComparison(results);
}

// ===============================
// Ù†ÙØ³ Ù…Ù†Ø·Ù‚ calculateQuote ÙˆÙ„ÙƒÙ† Ø¯Ø§Ø®Ù„ÙŠ
// ===============================
// ===============================
// Ø§Ù„Ø­Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© (Ø§Ù„Ø£ÙƒØ«Ø± Ø¯Ù‚Ø©)
// ===============================
function calculateInternalQuote(model, base) {
  // 1. Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Ø§Ù„Ù…ØµÙ†Ø¹ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù„Ø±ÙŠØ§Ù„
  const extraFloors = Math.max(0, base.floors - model.baseFloors);
  const factoryUsd = model.basePriceUsd + (model.extraPerFloorUsd * extraFloors);
  const factorySar = factoryUsd * model.exchangeRateToSAR;

  // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø«Ø§Ø¨ØªØ© ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø© Ù…Ù† COST_PARAMS
  // Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ£ÙƒØ¯ Ø£Ù† COST_PARAMS Ù…Ø¹Ø±ÙØ© ÙÙŠ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø¹Ù„ÙˆÙŠ
  const shipping = COST_PARAMS.shippingUsd * model.exchangeRateToSAR; // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø´Ø­Ù† Ù„Ø±ÙŠØ§Ù„
  const insurance = factorySar * COST_PARAMS.insuranceRate; // 1% ØªØ£Ù…ÙŠÙ†
  const clearance = COST_PARAMS.clearanceSar; // 1200 Ø±ÙŠØ§Ù„
  const inland = COST_PARAMS.inlandTransportSar; // 1500 Ø±ÙŠØ§Ù„
  const installation = COST_PARAMS.installationBaseSar; // 9000 Ø±ÙŠØ§Ù„

  // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù†Ø³Ø¨Ø© 12% Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©)
  const totalOverhead = shipping + insurance + clearance + inland + installation;

  // 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ (25% Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©)
  const totalCost = factorySar + totalOverhead;
  const profit = totalCost * 0.25;

  // 4. Ø§Ù„Ø­Ø³Ø¨Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø©
  const beforeVat = totalCost + profit;
  const vat = beforeVat * 0.15;

  return {
    beforeVat: beforeVat,
    vat: vat,
    total: beforeVat + vat,
    delivery: model.delivery || '45-60 ÙŠÙˆÙ…'
  };
}

// ===============================
// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
// ===============================
function renderComparison(results) {
  document.getElementById('compare_result').style.display = 'block';

  results.forEach((r, i) => {
    const idx = i + 1;
    document.getElementById(`col_${idx}`).innerText = r.brand;
    document.getElementById(`c${idx}_before`).innerText = formatSAR(r.beforeVat);
    document.getElementById(`c${idx}_vat`).innerText = formatSAR(r.vat);
    document.getElementById(`c${idx}_total`).innerText = formatSAR(r.total);
    document.getElementById(`c${idx}_delivery`).innerText = r.delivery;
  });
}

// Ø­Ø³Ø§Ø¨ ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
calculateTravelHeight();
</script>







</body>
</html>




























