<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
   
<style>

   /* =================================================
   PRINT FIX – EN81 DIAGRAM PAGE (PAGE 6)
================================================= */
@media print {

  /* تأكيد أن الصفحة لا تنكسر */
  .page.en81-page {
    page-break-after: always !important;
    break-inside: avoid !important;
  }

  /* تخطيط الصفحة */
 .en81-layout {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    padding: 15px;
    background: #ffffff;
    border-radius: 12px;
}

  /* تكبير المخطط */
  .diagram-container {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .diagram-container svg {
    max-width: 100%;
    height: auto;
    transform: scale(1.08);
  }

  /* ضبط الجدول */
  .en81-table table {
    font-size: 11px;
  }

  .en81-table th,
  .en81-table td {
    padding: 6px 8px;
  }

}

/* ===============================
   HEADER (Final – Print Safe)
=============================== */
.page-header {
  position: relative;
  min-height: 70px;
  margin-bottom: 14px;
  padding-top: 6px;
  border-bottom: 1.5px solid #e5e7eb;
  font-size: 11px;
}

/* الشعار – ثابت لا يتحرك */
.header-logo {
  position: absolute;
  top: 6px;
  left: 0;
  width: 42px;
  height: auto;
}

/* النص بالمنتصف */
.header-text {
  text-align: center;
  padding: 0 90px; /* مساحة للشعار + بيانات العرض */
  line-height: 1.4;
}

.company-name {
  font-weight: 700;
  font-size: 14px;
}

.company-sub {
  font-size: 10px;
  color: #6b7280;
}

/* رقم وتاريخ العرض */
.header-meta {
  position: absolute;
  top: 6px;
  right: 0;
  text-align: right;
  font-size: 11px;
  line-height: 1.5;
}

@media print {
  .page {
    position: relative;
    overflow: hidden;
  }

  .page-header {
    break-inside: avoid;
  }
}


/* =================================================
   Editable
================================================= */
body[contenteditable="true"] { cursor: text; }
[contenteditable="true"]:focus { outline: none; }
.editable-highlight:hover { background: rgba(59,130,246,0.06); }

/* =================================================
   Header
================================================= */
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 2px solid #e5e7eb;
  padding-bottom: 8px;
  margin-bottom: 12px;
  font-size: 12px;
}

.header-left { text-align: right; }
.header-right { text-align: left; }

.logo-title { font-weight: 700; font-size: 18px; }
.logo-sub {
  font-size: 11px;
  color: #6b7280;
  line-height: 1.5;
}

/* =================================================
   العناوين
================================================= */
h1.main-title {
  text-align: center;
  font-size: 18px;
  margin: 10px 0 18px;
}

.section-title {
  font-weight: 700;
  font-size: 14px;
  margin: 18px 0 8px;
  border-right: 4px solid #2563eb;
  padding-right: 6px;
}

/* =================================================
   الجداول (عرض الشاشة)
================================================= */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}

th, td {
  border: 1px solid #d1d5db;
  padding: 6px 8px;
  vertical-align: top;
}

th {
  background: #f9fafb;
  font-weight: 600;
}

.spec-table th { width: 22%; background: #f8fafc; }
.spec-table td { width: 28%; }

/* =================================================
   تقسيمات
================================================= */
.two-col {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.small-note {
  font-size: 11px;
  color: #6b7280;
}

.terms p {
  font-size: 11.5px;
  margin: 4px 0;
  text-align: justify;
}

/* =================================================
   غلاف PDF
================================================= */
.pdf-cover {
  padding: 0 !important;
}

.fixed-pdf-img {
  width: 100%;
  display: block;
}

/* =================================================
   الشعارات
================================================= */
.partners-logos img {
  max-width: 180px;
  max-height: 90px;
  object-fit: contain;
  display: block;
  margin: 0 auto;
}

/* =================================================
   زر الطباعة
================================================= */
.btn-print {
  display: inline-block;
  margin: 12px auto 0;
  padding: 8px 18px;
  font-size: 13px;
  background: #2563eb;
  color: #fff;
  border-radius: 4px;
  border: none;
  cursor: pointer;
}

/* =================================================
   ================== الطباعة ==================
================================================= */
@media print {

 @page {
  size: A4;
  margin: 0;
}
.page-coverage {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-top: 18px;

  break-inside: avoid !important;
  page-break-inside: avoid !important;
}
     .price-adjust-section {
    display: none !important;
  }
.page-coverage img {
  max-height: 210mm; /* ضمان عدم تجاوز ارتفاع الصفحة */
  object-fit: contain;
}
   .coverage-table table {
  font-size: 11px;
}
  .diagram-container svg {
    transform: scale(1.05);
  }
   .diagram-container {
  align-items: center;
}
.coverage-table th,
.coverage-table td {
  padding: 5px 6px;
}
   

  html, body {
    margin: 0 !important;
    padding: 0 !important;
    background: #fff !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* كل صفحة = ورقة A4 مستقلة */
  .page {
    width: 210mm !important;
    min-height: 297mm !important;
    margin: 0 !important;
    padding: 15mm !important;
    box-sizing: border-box !important;

    page-break-after: always !important;
    break-after: page !important;

    display: block !important;
    position: relative !important;
    overflow: hidden !important;

    box-shadow: none !important;
  }

  .page:last-child {
    page-break-after: auto !important;
  }
    .print-small-text img {
    max-height: 60px !important; /* تصغير الشعارات */
  }

  /* الغلاف */
  .pdf-cover {
    padding: 0 !important;
  }

  .pdf-cover img,
  .fixed-pdf-img {
    width: 210mm !important;
    height: 297mm !important;
    object-fit: cover !important;
    display: block !important;
  }

  /* الجداول – السماح بالكسر الطبيعي */
  table {
    page-break-inside: auto !important;
    break-inside: auto !important;
     font-size: 10.2px !important;
  }

  thead {
    display: table-header-group !important;
  }


  tr {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
  }

  /* إلغاء grid / flex في الطباعة */
  .two-col,
  .page-header,
  .partners-logos {
    display: block !important;
  }

  /* إخفاء زر الطباعة */
  .btn-print {
    display: none !important;
  }
    .section-title {
    margin-top: 10px !important;
    margin-bottom: 6px !important;
    font-size: 13px !important;
  }
    p {
    margin-top: 6px !important;
    margin-bottom: 6px !important;
    line-height: 1.6 !important;
  }
.en81-layout {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    padding: 15px;
    background: #ffffff;
    border-radius: 12px;
}
   
/* ===== EN81 Auto Highlight ===== */
.en81-active {
  background: #f6fffa !important;
}
.en81-active .en81-count {
  background: #e6f7ef !important;
  color: #065f46 !important;
}

.en81-active .en81-count {
  background: #dcfce7 !important;
  color: #166534 !important;
  font-weight: 700 !important;
  text-align: center !important;
}
.en81-count {
  min-width: 70px;
  text-align: center;
  font-weight: 700;
}

  /* منع زيادة ارتفاع الصفوف */
  tr {
    height: auto !important;
  }
}

</style>


</head>


   <body contenteditable="true" spellcheck="false">

 

<!-- =================================================
 PAGE 0 | Cover Page – Corporate Identity
================================================= -->
<div class="page pdf-cover">
  <img src="/public/images/FIRST_PAGE_RKL1.png" class="fixed-pdf-img">
</div>

<!-- =================================================
 PAGE 1 | Cover Page – Company Profile
================================================= -->
<div class="page pdf-cover">
  <img src="/public/images/FIRST_PAGE_RKL2.png" class="fixed-pdf-img">
</div>

<!-- =================================================
 PAGE 2 | Introduction + Client File + Project Data
================================================= -->
<div class="page">

  <!-- ===== Header ===== -->
  <div class="page-header">

  <!-- شعار ثابت -->
  <img src="/public/images/logo.png" class="header-logo" alt="RKL Logo">

  <div class="header-text">
    <div class="company-name">RKL للمصاعد والسلالم الكهربائية</div>
    <div class="company-sub">
      السجل التجاري: 1010709355 – الرقم الضريبي: 302250422600003<br>
      السليمانية – الرياض – هاتف: 0114774021 – WWW.RKL.SA
    </div>
  </div>

  <div class="header-meta">
    رقم العرض: <strong class="bind_quote_number">—</strong><br>
    تاريخ العرض: <strong class="bind_offer_date">—</strong>
  </div>

</div>

  <!-- ===== Title ===== -->
  <h1 class="main-title">عرض سعر توريد وتركيب وتشغيل مصعد كهربائي</h1>

  <!-- ===== About RKL ===== -->
  <div class="section-title">أولاً: نبذة عن مؤسسة آر كي ال RKL</div>
  <p class="small-note editable" contenteditable="true">
    مؤسسة سعودية متخصصة في توريد وتركيب وصيانة المصاعد والسلالم الكهربائية،
    تعمل وفق أعلى معايير الجودة والسلامة، وتمتلك شراكات مع مصانع عالمية،
    مع خبرة في تنفيذ مشاريع حكومية وخاصة في مختلف مناطق المملكة.
  </p>

  <!-- ===== Client File ===== -->
  <div class="section-title">ثانياً: ملف العميل</div>

  <div class="formal-letter">
    
      إشارةً إلى طلبكم الكريم، نفيدكم بأن
      <strong>مؤسسة آر كي ال RKL للمصاعد والسلالم الكهربائية</strong>
      قامت بإعداد هذا العرض الفني والمالي بناءً على البيانات والمعلومات الرسمية
      المقدمة من طرفكم، وذلك وفق التفاصيل الموضحة أدناه.
   
  </div>

<!-- ===== Client Data – Formal Letter Style ===== -->
<div class="client-letter-box">

  <div class="client-line">
    <span>اسم العميل:</span>
    <strong class="bind_customer_name">—</strong>
    <span class="sep">|</span>
    <span>نوع العميل:</span>
    <strong class="bind_customer_type">—</strong>
  </div>

  <div class="client-line">
    <span>الشخص المسؤول:</span>
    <strong class="bind_contact_person">—</strong>
    <span class="sep">|</span>
    <span>السجل التجاري:</span>
    <strong class="bind_cr_number">—</strong>
  </div>

  <div class="client-line">
    <span>الرقم الضريبي:</span>
    <strong class="bind_tax_number">—</strong>
    <span class="sep">|</span>
    <span>رقم الهاتف:</span>
    <strong class="bind_customer_phone">—</strong>
  </div>

  <div class="client-line">
    <span>البريد الإلكتروني:</span>
    <strong class="bind_customer_email">—</strong>
  </div>

  <div class="client-line">
    <span>العنوان:</span>
    <strong>
      <span class="bind_city">—</span> /
      <span class="bind_district">—</span> /
      <span class="bind_street">—</span> /
      مبنى <span class="bind_building_number">—</span> /
      <span class="bind_postal_code">—</span>
    </strong>
  </div>

  <div class="client-line">
    <span>العنوان الوطني:</span>
    <strong class="bind_national_address">—</strong>
  </div>

</div>

  <!-- ===== Elevator Data ===== -->
  <div class="section-title" style="margin-top:20px">
    ثالثاً: بيانات المصاعد الخاصة بالمشروع
  </div>

  <p class="small-note">
    فيما يلي البيانات الفنية الأساسية للمصاعد المطلوبة للمشروع، وذلك حسب المعلومات المعتمدة من طرفكم:
  </p>

  <!-- ===== Table Wrap (important) ===== -->
  <div class="table-wrap">
    <table class="spec-table">
      <tbody>

        <tr>
          <th>اسم المشروع</th>
          <td class="bind_project_name">—</td>
          <th>موقع المشروع</th>
          <td class="bind_project_location">—</td>
        </tr>

        <tr>
          <th>ماركة المصعد</th>
          <td class="bind_brand">—</td>
          <th>نوع الاستخدام</th>
          <td class="bind_usage">Passenger Elevator</td>
        </tr>

        <tr>
          <th>عدد المصاعد</th>
          <td class="bind_lifts">—</td>
          <th>الحمولة الاسمية (kg)</th>
          <td class="bind_capacity">—</td>
        </tr>

        <tr>
          <th>السرعة (m/s)</th>
          <td class="bind_speed">—</td>
          <th>عدد التوقفات (Stops)</th>
          <td class="bind_stops">—</td>
        </tr>
          <tr>
          <th>ضمان المصاعد</th>
         <td>عشرة سنوات</td>
          <th>مدة الصيانة الوقائية</th>
          <td >سنه ميلاديه </td>
        </tr>

        <tr>
          <th>ارتفاع الدور الواحد (FH)</th>
          <td class="bind_fh">—</td>
          <th>ارتفاع الرحلة الكلي (TH)</th>
          <td class="bind_th">—</td>
        </tr>

        <tr>
          <th>نظام التركيب</th>
          <td colspan="3" class="bind_machine_type">
            MRL – Machine Room Less
          </td>
        </tr>

      </tbody>
    </table>
  </div>
<div style="margin-top: 15px; border-top: 2px solid #1e3a8a; padding-top: 10px; font-family: sans-serif;">
    
    <div style="display: grid; grid-template-columns: 1fr 1.2fr; gap: 20px;">
        
        <div style="background: #f8fafc; padding: 10px; border-radius: 5px; border: 1px solid #e2e8f0;">
            <h6 style="color: #1e3a8a; font-size: 11px; margin: 0 0 8px 0; border-bottom: 1px solid #1e3a8a; padding-bottom: 3px;">دليل الرموز الفنية (Legend)</h6>
            <table style="width: 100%; font-size: 10px; border-collapse: collapse; line-height: 1.5;">
                <tr>
                    <td style="font-weight: bold; color: #2563eb; width: 30%;">CW / CD</td>
                    <td>صافي عرض وعمق الكابينة الداخلي.</td>
                </tr>
                <tr>
                    <td style="font-weight: bold; color: #2563eb;">HW / HD</td>
                    <td>أبعاد بئر المصعد (الخلوص الخرساني).</td>
                </tr>
                <tr>
                    <td style="font-weight: bold; color: #2563eb;">Pit / OH</td>
                    <td>عمق الحفرة وأدنى ارتفاع علوي للأمان.</td>
                </tr>
                <tr>
                    <td style="font-weight: bold; color: #2563eb;">EN 81-20</td>
                    <td>المعيار الدولي لسلامة الركاب والفنيين.</td>
                </tr>
            </table>
        </div>

        <div>
            <h6 style="color: #1e3a8a; font-size: 11px; margin: 0 0 8px 0;">◎ ملاحظات هندسية ومعايير الجودة:</h6>
            <ul style="margin: 0; padding-right: 15px; font-size: 10.5px; line-height: 1.6; color: #333;">
                <li>تطابق هذه المقاسات متطلبات <strong>كود البناء السعودي (SBC)</strong> والدفاع المدني.</li>
                <li>تم تصميم المساحات لضمان تقليل الاحتكاك والضوضاء الميكانيكية داخل البئر.</li>
                <li>يتم تدقيق أبعاد الموقع فعلياً قبل التصنيع لضمان مطابقة الكابينة للبئر.</li>
                <li>تضمن مسافات الأمان (Pit/OH) حماية الفنيين أثناء عمليات الصيانة الدورية.</li>
                <li><strong>تنبيه:</strong> أي تعديل في أبعاد البئر بالموقع يتطلب مراجعة المكتب الفني لدينا.</li>
            </ul>
        </div>
    </div>

    <div style="margin-top: 12px; background: #1e3a8a; color: white; padding: 6px; text-align: center; border-radius: 4px; font-size: 10px;">
        جميع التصاميم الهندسية لشركة <strong>RKL</strong> تخضع لرقابة صارمة لضمان أعلى معايير الجودة والأمان المستدام.
    </div>
</div>
   
</div> <!-- نهاية .page -->

<!-- =================================================
 PAGE 3 | RKL Coverage & International Partnerships
================================================= -->
<div class="page">

  <div class="page-header">


  <!-- شعار ثابت -->
  <img src="/public/images/logo.png" class="header-logo" alt="RKL Logo">

  <div class="header-text">
    <div class="company-name">RKL للمصاعد والسلالم الكهربائية</div>
    <div class="company-sub">
      السجل التجاري: 1010709355 – الرقم الضريبي: 302250422600003<br>
      السليمانية – الرياض – هاتف: 0114774021 – WWW.RKL.SA
    </div>
  </div>

  <div class="header-meta">
    رقم العرض: <strong class="bind_quote_number">—</strong><br>
    تاريخ العرض: <strong class="bind_offer_date">—</strong>
  </div>

</div>

<div class="page-coverage">

    <!-- صورة الخريطة -->
    <div style="width:50%">
      <img
        src="/public/images/ksa-map.png"
        alt="RKL Coverage Map"
        style="width:100%;border-radius:10px;border:1px solid #e5e7eb"
      />
      <div style="font-size:11px;color:#6b7280;margin-top:6px;text-align:center">
        التوزيع الجغرافي لأعمال RKL داخل المملكة العربية السعودية
      </div>
    </div>

    <!-- جدول المناطق -->
    <div style="width:50%">
      <h4 style="margin:0 0 10px 0">
        ثالثا ملخص الأعمال حسب المناطق
      </h4>

      <table>
        <thead>
          <tr>
            <th>المنطقة</th>
            <th>Region</th>
            <th>عدد المصاعد</th>
            <th>Elevators</th>
          </tr>
        </thead>
         <tbody>
  <tr>
    <td>421</td>
    <td>421</td>
    <td>Riyadh</td>
    <td>الرياض</td>
  </tr>
  <tr>
    <td>98</td>
    <td>98</td>
    <td>Makkah</td>
    <td>مكة المكرمة</td>
  </tr>
  <tr>
    <td>72</td>
    <td>72</td>
    <td>Eastern Region</td>
    <td>المنطقة الشرقية</td>
  </tr>
  <tr>
    <td>34</td>
    <td>34</td>
    <td>Madinah</td>
    <td>المدينة المنورة</td>
  </tr>
  <tr>
    <td>26</td>
    <td>26</td>
    <td>Qassim</td>
    <td>القصيم</td>
  </tr>
  <tr>
    <td>19</td>
    <td>19</td>
    <td>Tabuk</td>
    <td>تبوك</td>
  </tr>
  <tr>
    <td>17</td>
    <td>17</td>
    <td>Hail</td>
    <td>حائل</td>
  </tr>
  <tr>
    <td>23</td>
    <td>23</td>
    <td>Najran</td>
    <td>نجران</td>
  </tr>
  <tr>
    <td>41</td>
    <td>41</td>
    <td>Asir & Jazan</td>
    <td>عسير وجازان</td>
  </tr>
</tbody>


      </table>
    </div>

  </div>
   <!-- =========================
     الاعتمادات والشراكات
========================= -->
<div class="section-title">الاعتمادات والشراكات الدولية</div>

<p class="section-text">
 <strong>RKL </strong> معتمدة في توريد وتنفيذ أنظمة المصاعد
من موردين عالميين،.
</p>

<div class="partners-logos">
  <div class="partner-box">
    <img src="public/images/fuji-logo.png" alt="FUJI Japan">
    <div class="partner-name">FUJI – Japan</div>
    <div class="partner-desc">مصاعد كهربائية – أنظمة MRL & Passenger</div>
  </div>

  <div class="partner-box">
    <img src="public/images/vertilift-logo.png" alt="VertiLift Italy">
    <div class="partner-name">VertiLift – Italy</div>
    <div class="partner-desc">مصاعد أوروبية – حلول حديثة</div>
  </div>
</div>

<!-- نبذة عن المؤسسة والمشاريع -->
<div style="margin-top:20px; border-top:1px solid #e5e7eb; padding-top:15px;">

  <strong>مشاريعنا داخل المملكة العربية السعودية</strong>
  <p style="font-size:12px; line-height:1.6; color:#374151; margin-top:6px;">
     RKL وقد نفذت أعمالها
    في عدة مناطق داخل المملكة العربية السعودية.
  </p>

<p style="font-size:11.5px; line-height:1.7; color:#374151; margin-top:10px; text-align:justify">
يعرض الجدول أعلاه ملخصًا لأعمال <strong>مؤسسة آر كي ال RKL</strong> في مختلف
مناطق المملكة العربية السعودية، ويشمل عدد المصاعد التي تم توريدها
وتركيبها وتشغيلها ضمن مشاريع سكنية وتجارية وطبية وتعليمية.

وتعكس هذه البيانات الانتشار الجغرافي الواسع لأعمال المؤسسة،
وقدرتها على تنفيذ المشاريع وفق أعلى معايير الجودة والسلامة،
وبما يتوافق مع متطلبات الجهات المالكة والاستشارية في مختلف المناطق.
</p>

<p style="font-size:11.5px; line-height:1.7; color:#374151; margin-top:6px; text-align:justify" dir="ltr">
The above table presents a summary of <strong>RKL</strong> elevator projects
across various regions of the Kingdom of Saudi Arabia, including the
number of elevators supplied, installed, and commissioned for residential,
commercial, medical, and educational developments.

This regional distribution reflects RKL’s extensive geographical presence
and its capability to deliver projects in compliance with international
quality and safety standards, meeting the requirements of clients,
consultants, and regulatory authorities across the Kingdom.
</p>

</div>
</div> <!-- نهاية .page -->

<!-- =================================================
 PAGE 4 | General Technical Specifications (Fixed)
================================================= -->
      
<div class="page">

  <div class="page-header">


  <!-- شعار ثابت -->
  <img src="/public/images/logo.png" class="header-logo" alt="RKL Logo">

  <div class="header-text">
    <div class="company-name">RKL للمصاعد والسلالم الكهربائية</div>
    <div class="company-sub">
      السجل التجاري: 1010709355 – الرقم الضريبي: 302250422600003<br>
      السليمانية – الرياض – هاتف: 0114774021 – WWW.RKL.SA
    </div>
  </div>

  <div class="header-meta">
    رقم العرض: <strong class="bind_quote_number">—</strong><br>
    تاريخ العرض: <strong class="bind_offer_date">—</strong>
  </div>

</div>

<div class="section-title">رابعاً: المواصفات القياسية الثابتة لنظام المصعد</div>

<table class="info-table">
<thead>
<tr>
  <th style="width:40px">م</th>
  <th>البند</th>
  <th>الوصف</th>
  <th>ملاحظات</th>
</tr>
</thead>

<tbody>

<!-- ===== Drive & Control System ===== -->
<tr><td>1</td><td>Drive System</td><td>VVVF – Variable Voltage Variable Frequency</td><td>تشغيل ناعم واقتصادي</td></tr>
<tr><td>2</td><td>Power Saver</td><td>Included</td><td>توفير استهلاك الطاقة</td></tr>
<tr><td>3</td><td>Anti-vibration & Motion Smoothing</td><td>Included</td><td>تقليل الاهتزاز والضوضاء</td></tr>
<tr><td>4</td><td>Speed Governor</td><td>Included</td><td>مطابق EN81</td></tr>
<tr><td>5</td><td>Overload Protection</td><td>Included</td><td>حماية من زيادة الحمولة</td></tr>
<tr><td>6</td><td>Auto Park Function</td><td>Included</td><td>إيقاف تلقائي عند عدم الاستخدام</td></tr>

<!-- ===== Doors System ===== -->
<tr><td>7</td><td>Door Type</td><td>Automatic</td><td></td></tr>
<tr><td>8</td><td>Door Opening</td><td>Center Opening</td><td></td></tr>
<tr><td>9</td><td>Door Material</td><td>Stainless Steel</td><td>باب الكابينة</td></tr>
<tr><td>10</td><td>Landing Door Material</td><td>Stainless Steel</td><td>أبواب الأدوار</td></tr>

<!-- ===== COP & HOP ===== -->
<tr><td>11</td><td>COP Type</td><td>Hairline Stainless Steel</td><td></td></tr>
<tr><td>12</td><td>COP Buttons</td><td>ANOD / Push Button</td><td></td></tr>
<tr><td>13</td><td>Display</td><td>LCD Display</td><td></td></tr>
<tr><td>14</td><td>Display Size</td><td>4.3 Inch LCD</td><td></td></tr>
<tr><td>15</td><td>Language</td><td>English</td><td></td></tr>
<tr><td>16</td><td>HOP Type</td><td>Hairline Stainless Steel</td><td></td></tr>
<tr><td>17</td><td>Indicators</td><td>Location & Direction Indicator</td><td></td></tr>

<!-- ===== Electrical ===== -->
<tr><td>18</td><td>Power Supply</td><td>380V – 60Hz – 3 Phase</td><td>التغذية الرئيسية</td></tr>
<tr><td>19</td><td>Lighting Power</td><td>220V – 60Hz</td><td>إنارة الكابينة</td></tr>

<!-- ===== Safety Systems ===== -->
<tr><td>20</td><td>ARD</td><td>Automatic Rescue Device</td><td>إنزال تلقائي عند انقطاع التيار</td></tr>
<tr><td>21</td><td>Fireman Key</td><td>Included</td><td>وضع الطوارئ للحريق</td></tr>
<tr><td>22</td><td>Two-way Intercom System</td><td>Included</td><td>اتصال داخلي للطوارئ</td></tr>
<tr><td>23</td><td>Emergency Car Light</td><td>Included</td><td></td></tr>
<tr><td>24</td><td>Emergency Alarm Bell</td><td>Included</td><td></td></tr>
<tr><td>25</td><td>Electric Blower</td><td>Included</td><td>تهوية الكابينة</td></tr>
<tr><td>26</td><td>Fire & Earthquake Sensor Ready</td><td>Included</td><td>جاهز للربط مع أنظمة المبنى</td></tr>
<tr><td>27</td><td>Car Top Safety Guard</td><td>Included (for travel &gt; 450cm)</td><td></td></tr>
<tr><td>28</td><td>Door Lock Monitoring</td><td>Included</td><td></td></tr>
<tr><td>29</td><td>Door Opening Prevention</td><td>Included</td><td>منع الفتح أثناء الحركة</td></tr>
<tr><td>30</td><td>Full Height Sensor</td><td>Included</td><td></td></tr>
<tr><td>31</td><td>Safe Landing System</td><td>Included</td><td></td></tr>
<tr><td>32</td><td>Self-diagnostic Electronic Devices</td><td>Included</td><td>تشخيص الأعطال ذاتياً</td></tr>
<tr><td>33</td><td>Phase / Voltage Protection</td><td>Included</td><td>حماية الجهد والفازات</td></tr>
<tr><td>34</td><td>Buffer in Pit</td><td>Included</td><td></td></tr>
<tr><td>35</td><td>Governor & Safety Gear</td><td>Included</td><td>مطابق EN81</td></tr>

</tbody>
</table>


  
</div>
     

<!-- =================================================
 PAGE 5 | EN81 Layout & Dimensional Drawings (ONE PAGE)
================================================= -->
<div class="page en81-page">

  <!-- ================= HEADER ================= -->
  <div class="page-header">
    <img src="/public/images/logo.png" class="header-logo" alt="RKL Logo">

    <div class="header-text">
      <div class="company-name">RKL للمصاعد والسلالم الكهربائية</div>
      <div class="company-sub">
        السجل التجاري: 1010709355 – الرقم الضريبي: 302250422600003<br>
        السليمانية – الرياض – هاتف: 0114774021 – WWW.RKL.SA
      </div>
    </div>

    <div class="header-meta">
      رقم العرض: <strong class="bind_quote_number">—</strong><br>
      تاريخ العرض: <strong class="bind_offer_date">—</strong>
    </div>
  </div>

  <!-- ================= TITLE ================= -->
  <div class="section-title center" style="margin-top:10px">
    خامساً: مخطط استرشادي هندسي لمقاسات بئر المصعد والكابينة (EN 81)<br>
    <span class="subtitle">Indicative Engineering Layout – EN 81</span>
  </div>

  <!-- ================= CONTENT GRID ================= -->
<div class="en81-grid">

  <table class="tech-table compact">
    <thead>
      <tr>
        <th>م</th>
        <th>البند</th>
        <th>القيمة (mm)</th>
        <th>ملاحظات</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td>مقاس بئر المصعد</td>
        <td data-bind="shaftSize">—</td>
        <td>حسب EN81 / الموقع</td>
      </tr>
      <tr>
        <td>2</td>
        <td>مقاس الكابينة</td>
        <td data-bind="cabinSize">—</td>
        <td>حسب EN81</td>
      </tr>
      <tr>
        <td>3</td>
        <td>عمق الحفرة (Pit)</td>
        <td data-bind="pit">—</td>
        <td></td>
      </tr>
      <tr>
        <td>4</td>
        <td>الأبواب</td>
        <td>طبقاً للتصميم المعتمد</td>
        <td></td>
      </tr>
      <tr>
        <td>5</td>
        <td>ارتفاع أعلى البئر (OH)</td>
        <td data-bind="oh">—</td>
        <td></td>
      </tr>
    </tbody>
  </table>

</div>


    <!-- ===== RIGHT: DIAGRAMS ===== -->
    <div class="diagram-container compact">

      <!-- SECTION VIEW -->
      <svg width="200" height="360" viewBox="0 0 220 420">
        <rect x="60" y="40" width="100" height="320"
              fill="none" stroke="#0f172a" stroke-width="2"/>
        <rect x="80" y="140" width="60" height="120"
              fill="#ecfdf5" stroke="#10b981" stroke-width="2"/>

        <text x="110" y="28" text-anchor="middle" font-size="12" font-weight="600">
          SECTION VIEW
        </text>
        <text x="110" y="205" text-anchor="middle" font-size="11">CABIN</text>

        <line x1="60" y1="360" x2="160" y2="360" stroke="#0f172a"/>
        <text x="110" y="395" text-anchor="middle" font-size="10">
          PIT = <tspan class="bind_pit">—</tspan> mm
        </text>

        <line x1="60" y1="40" x2="160" y2="40" stroke="#0f172a"/>
        <text x="110" y="18" text-anchor="middle" font-size="10">
          OH = <tspan class="bind_oh">—</tspan> mm
        </text>
      </svg>

    <!-- PLAN VIEW -->
<svg width="200" height="220" viewBox="0 0 220 240">

  <!-- Shaft -->
  <rect x="30" y="40" width="160" height="160"
        fill="none" stroke="#0f172a" stroke-width="2"/>

  <!-- Cabin -->
  <rect x="65" y="75" width="90" height="90"
        fill="#ecfdf5" stroke="#10b981" stroke-width="2"/>

  <!-- Title -->
  <text x="110" y="24" text-anchor="middle"
        font-size="12" font-weight="600">
    PLAN VIEW
  </text>

  <!-- CABIN label -->
  <text x="110" y="125" text-anchor="middle"
        font-size="11" fill="#065f46">
    CABIN
  </text>

  <!-- Cabin dimensions -->
  <text x="110" y="155" text-anchor="middle"
        font-size="10">
    CW × CD =
    <tspan class="bind_cabin_width">—</tspan> ×
    <tspan class="bind_cabin_depth">—</tspan> mm
  </text>

  <!-- Shaft dimensions -->
  <text x="110" y="205" text-anchor="middle"
        font-size="10">
    HW × HD =
    <tspan class="bind_shaft_width">—</tspan> ×
    <tspan class="bind_shaft_depth">—</tspan> mm
  </text>

</svg>
       
<svg viewBox="0 0 400 500" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
      <circle cx="1" cy="1" r="0.5" fill="#e2e8f0" />
    </pattern>
  </defs>
  <rect width="100%" height="100%" fill="url(#grid)" />

  <g transform="translate(50, 50)">
    <text x="0" y="-15" font-family="Arial" font-size="12" font-weight="bold" fill="#1e3a8a">SECTION VIEW</text>
    <rect x="0" y="0" width="80" height="350" fill="none" stroke="#64748b" stroke-width="2" />
    <path d="M0 0 L-5 5 M0 20 L-5 25 M0 40 L-5 45" stroke="#cbd5e1" stroke-width="1" /> <rect x="15" y="100" width="50" height="70" fill="#f1f5f9" stroke="#2563eb" stroke-width="1.5" />
    <line x1="15" y1="105" x2="65" y2="105" stroke="#2563eb" stroke-width="0.5" />
    
    <line x1="72" y1="0" x2="72" y2="350" stroke="#94a3b8" stroke-width="1" stroke-dasharray="4" />
    
    <g stroke="#ef4444" stroke-width="1">
      <line x1="-15" y1="0" x2="-15" y2="350" />
      <line x1="-20" y1="0" x2="-10" y2="0" />
      <line x1="-20" y1="350" x2="-10" y2="350" />
    </g>
    <text x="-45" y="180" font-size="9" fill="#ef4444" transform="rotate(-90 -45 180)">TOTAL HEIGHT</text>
  </g>

  <g transform="translate(220, 100)">
    <text x="0" y="-15" font-family="Arial" font-size="12" font-weight="bold" fill="#1e3a8a">PLAN VIEW (TOP)</text>
    <rect x="0" y="0" width="130" height="130" fill="none" stroke="#1e293b" stroke-width="2.5" />
    
    <rect x="25" y="25" width="80" height="80" fill="#ebf2ff" stroke="#2563eb" stroke-width="2" rx="2" />
    
    <line x1="25" y1="130" x2="105" y2="130" stroke="#1e3a8a" stroke-width="4" />
    <rect x="35" y="125" width="60" height="3" fill="#60a5fa" />
    
    <g fill="#475569" font-size="10">
      <text x="50" y="15">HW</text>
      <line x1="0" y1="20" x2="130" y2="20" stroke="#475569" stroke-width="0.5" />
      <text x="135" y="70">HD</text>
      <line x1="120" y1="0" x2="120" y2="130" stroke="#475569" stroke-width="0.5" />
    </g>
  </g>
</svg>

    </div>


  <!-- ================= SHORT EXPLANATION ================= -->
  <div class="en81-note">

    <p class="ar">
      يوضح هذا المخطط الاسترشادي الأبعاد الرئيسية لبئر المصعد والكابينة وفق متطلبات
      المواصفة الأوروبية EN81، ويُستخدم لأغراض التنسيق الهندسي المبدئي فقط.
    </p>

    <p class="en" dir="ltr">
      This indicative layout presents the principal shaft and cabin dimensions in accordance
      with EN 81 standards and is intended for preliminary coordination purposes only.
    </p>

  </div>

</div>

   

<!-- =================================================
 PAGE 6 | EN81 Standard Dimensions Table
================================================= -->
<div class="page en81-annex-page">

  <div class="page-header">
    <img src="/public/images/logo.png" class="header-logo" alt="RKL Logo">

    <div class="header-text">
      <div class="company-name">RKL للمصاعد والسلالم الكهربائية</div>
      <div class="company-sub">
        السجل التجاري: 1010709355 – الرقم الضريبي: 302250422600003<br>
        السليمانية – الرياض – هاتف: 0114774021 – WWW.RKL.SA
      </div>
    </div>

    <div class="header-meta">
      رقم العرض: <strong class="bind_quote_number">—</strong><br>
      تاريخ العرض: <strong class="bind_offer_date">—</strong>
    </div>
  </div>

  <div class="section-title center">
    ملحق (ب): جدول المقاسات القياسية المعتمدة حسب EN81<br>
    <span class="subtitle">EN81 Standard Shaft & Cabin Dimensions</span>
  </div>




<p style="font-size:12px; line-height:1.7; color:#374151; margin-bottom:10px">
يعتمد تصميم ومقاسات بئر المصعد والكابينة الواردة في هذا العرض على
<strong>المعايير الأوروبية EN81</strong> المعتمدة دوليًا.
وبناءً عليه، فإن المصعد المختار من قبل العميل سيتم تنفيذه بمقاسات
مطابقة لجدول الاعتماد الدولي EN81 أو بما يتوافق مع حالة الموقع والمخططات
التنفيذية المعتمدة، دون الإخلال بمتطلبات السلامة أو الأداء.
</p>

<div class="section-title">
  ملحق (ب): جدول المقاسات القياسية المعتمدة حسب EN81
</div>

<table>
  <thead>
    <tr>
      <th>الحمولة (kg)</th>
      <th style="background:#eef2ff">عدد المصاعد</th>
      <th>مقاس الكابينة (mm)</th>
      <th>مقاس البئر المطلوب (mm)</th>
      <th>عرض باب المصعد (mm)</th>
      <th>عمق الحفرة (Pit)</th>
      <th>ارتفاع أعلى البئر (OH)</th>
    </tr>
  </thead>

  <!-- ✅ مهم: ID للـ tbody حتى يشتغل السكربت -->
  <tbody id="en81-table">

    <tr data-capacity="450">
      <td>450</td>
      <td class="en81-count" style="font-weight:bold;text-align:center;background:#eef2ff">0</td>
      <td>1100 × 1000</td>
      <td>1700 × 1500</td>
      <td>700</td>
      <td>1200</td>
      <td>3500</td>
    </tr>

    <tr data-capacity="630">
      <td>630</td>
      <td class="en81-count" style="font-weight:bold;text-align:center;background:#eef2ff">0</td>
      <td>1400 × 1100</td>
      <td>1800 × 1600</td>
      <td>800</td>
      <td>1200</td>
      <td>3500</td>
    </tr>

    <tr data-capacity="800">
      <td>800</td>
      <td class="en81-count" style="font-weight:bold;text-align:center;background:#eef2ff">0</td>
      <td>1400 × 1350</td>
      <td>2000 × 1600</td>
      <td>900</td>
      <td>1300</td>
      <td>3600</td>
    </tr>

    <tr data-capacity="1000">
      <td>1000</td>
      <td class="en81-count" style="font-weight:bold;text-align:center;background:#eef2ff">0</td>
      <td>1500 × 1600</td>
      <td>2200 × 1800</td>
      <td>900</td>
      <td>1400</td>
      <td>3700</td>
    </tr>

    <tr data-capacity="1275">
      <td>1275</td>
      <td class="en81-count" style="font-weight:bold;text-align:center;background:#eef2ff">0</td>
      <td>1600 × 1800</td>
      <td>2400 × 1900</td>
      <td>1100</td>
      <td>1400</td>
      <td>3800</td>
    </tr>

    <tr data-capacity="1600">
      <td>1600</td>
      <td class="en81-count" style="font-weight:bold;text-align:center;background:#eef2ff">0</td>
      <td>2000 × 1800</td>
      <td>2600 × 2400</td>
      <td>1100</td>
      <td>1500</td>
      <td>4000</td>
    </tr>

  </tbody>
</table>

<p style="font-size:11px; color:#6b7280; margin-top:8px">
  جميع القيم الواردة في الجدول أعلاه هي قيم إرشادية وفق معيار EN81،
  وتخضع للتعديل بما يتوافق مع حالة الموقع والمخططات التنفيذية النهائية
  (Final Shop Drawings) المعتمدة من الاستشاري والجهات المختصة.
</p>
<div class="table-footer-explanation" style="margin-top: 20px; border-top: 2px solid #1e3a8a; padding-top: 15px;">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        
        <div class="exp-ar" style="text-align: right;">
            <h5 style="color: #1e3a8a; margin-bottom: 8px; font-size: 14px;">دليل قراءة المعايير الفنية:</h5>
            <p style="font-size: 12px; line-height: 1.6; color: #333;">
                تعتمد هذه المقاسات على المواصفة الأوروبية <strong>EN 81-20/50</strong> المعتمدة من كود البناء السعودي. 
                تضمن هذه القيم التوازن المثالي بين مساحة الكابينة وحجم البئر لتوفير أقصى درجات الأمان والهدوء أثناء التشغيل.
            </p>
            <ul style="font-size: 11.5px; color: #444; list-style: none; padding-right: 10px;">
                <li>• <strong>المساحات المخصصة:</strong> تضمن سهولة الصيانة وسلامة الفنيين (Pit/OH).</li>
                <li>• <strong>الدقة الهندسية:</strong> أي انحراف عن هذه المقاسات يتم معالجته بحلول هندسية خاصة من فريقنا.</li>
            </ul>
        </div>

        <div class="exp-en" style="text-align: left; direction: ltr; border-left: 1px solid #ddd; padding-left: 15px;">
            <h5 style="color: #1e3a8a; margin-bottom: 8px; font-size: 14px;">Technical Standard Guide:</h5>
            <p style="font-size: 11px; line-height: 1.6; color: #555;">
                These dimensions follow <strong>EN 81-20/50</strong> international safety standards. 
                RKL ensures that every elevator is engineered to provide maximum ride comfort, durability, and compliance with Saudi Building Codes.
            </p>
            <p style="font-size: 10px; color: #777; font-style: italic;">
                *Customized solutions are available for non-standard shaft dimensions.
            </p>
        </div>
    </div>
    
    <div style="margin-top: 15px; text-align: center; background-color: #f0f4f8; padding: 8px; border-radius: 5px;">
        <span style="font-size: 12px; color: #1e3a8a; font-weight: bold;">
             تلتزم مؤسسة RKL بتقديم أعلى معايير الجودة لضمان سلامة مستخدمينا 
        </span>
    </div>
</div>



</div>


<!-- =================================================
 PAGE 7 | Financial Summary & Payment Schedule
================================================= -->
<div class="page">

  <div class="page-header">


  <!-- شعار ثابت -->
  <img src="/public/images/logo.png" class="header-logo" alt="RKL Logo">

  <div class="header-text">
    <div class="company-name">RKL للمصاعد والسلالم الكهربائية</div>
    <div class="company-sub">
      السجل التجاري: 1010709355 – الرقم الضريبي: 302250422600003<br>
      السليمانية – الرياض – هاتف: 0114774021 – WWW.RKL.SA
    </div>
  </div>

  <div class="header-meta">
    رقم العرض: <strong class="bind_quote_number">—</strong><br>
    تاريخ العرض: <strong class="bind_offer_date">—</strong>
  </div>

</div>




<!-- ===============================
  سابعاً: ملخص القيمة المالية
================================ -->
<div class="section-title">سابعاً: ملخص القيمة المالية</div>

<!-- ===============================
  7-1) ملخص عرض السعر والبنود
================================ -->
<div class="section-title">7-1) ملخص عرض السعر والبنود</div>

<table id="items-table">
  <thead>
    <tr>
      <th style="width:40%">وصف البند</th>
      <th style="width:10%">الكمية</th>
      <th style="width:20%">سعر الوحدة (SAR)</th>
      <th style="width:20%">الإجمالي (SAR)</th>
      <th style="width:10%">✖</th>
    </tr>
  </thead>
  <tbody>
    <!-- بند رئيسي تلقائي من عرض السعر -->
    <tr>
      <td contenteditable="true" class="item-desc"></td>
      <td><input type="number" class="qty" value="1" min="1"></td>
      <td><input type="number" class="unit" value="0" min="0"></td>
      <td class="row-total">0.00</td>
      <td style="text-align:center">—</td>
    </tr>
  </tbody>

  <tfoot>
    <tr style="background:#f8fafc;font-weight:bold">
      <td colspan="3" style="text-align:right">الإجمالي قبل الضريبة</td>
      <td id="itemsSubtotal">SAR 0.00</td>
      <td></td>
    </tr>
  </tfoot>
</table>

<div style="margin-top:8px">
  <button type="button" onclick="addExtraRow()">➕ إضافة بند إضافي</button>
</div>

<!-- ===============================
  7-2) تعديل السعر قبل الضريبة (اختياري)
================================ -->
<div class="price-adjust-section">

  <div class="section-title">7-2) تعديل السعر قبل الضريبة (اختياري)</div>

  <select id="adjustmentType">
    <option value="none">بدون تعديل</option>
    <option value="discount">خصم</option>
    <option value="increase">زيادة</option>
  </select>

  <input type="number" id="adjustmentValue" placeholder="أدخل المبلغ">

</div>


<!-- ===============================
  7-3) جدول الدفعات المقترح
================================ -->
<div class="section-title">7-3) جدول الدفعات المقترح</div>

<table>
  <tbody>
    <tr><td>عند توقيع العقد</td><td>50%</td><td class="pay50">—</td></tr>
    <tr><td>عند الانتهاء من الأعمال الميكانيكية</td><td>25%</td><td class="pay25">—</td></tr>
    <tr><td>بعد الانتهاء من الأعمال الكهربائية والتشغيل</td><td>20%</td><td class="pay20">—</td></tr>
    <tr><td>عند التسليم النهائي للمصعد</td><td>5%</td><td class="pay5">—</td></tr>

    <tr><th>الإجمالي قبل التعديل</th><th></th><th class="subtotalBefore">—</th></tr>
    <tr><th>قيمة الخصم / الزيادة</th><th></th><th class="adjustmentAmount">—</th></tr>
    <tr><th>الإجمالي بعد التعديل</th><th></th><th class="subtotalAfter">—</th></tr>
    <tr><th>ضريبة القيمة المضافة (15%)</th><th></th><th class="vatAmount">—</th></tr>
    <tr style="background:#f0f9ff;font-weight:bold">
      <th>الإجمالي النهائي (شامل الضريبة)</th>
      <th>100%</th>
      <th class="grandTotal">—</th>
    </tr>
  </tbody>
</table>

<div class="contract-terms">
  <h4>٨) بنود رئيسية للعقد (قابلة للتعديل)</h4>

  <ol>
    <li>يُعد هذا العرض جزءًا لا يتجزأ ومكمّلًا لعقد توريد وتركيب وتشغيل المصعد، ويُعمل به بعد اعتماده وتوقيعه من الطرفين.</li>

    <li>جميع الأسعار الواردة في هذا العرض بالريال السعودي وتشمل ضريبة القيمة المضافة بنسبة (15%) ما لم يُذكر خلاف ذلك.</li>

    <li>يلتزم الطرف الأول بتوفير التغذية الكهربائية (3 فاز – 380 فولت) وتنفيذ جميع الأعمال المدنية الخاصة بالبئر والأبواب حسب المخططات المعتمدة.</li>

    <li>يلتزم الطرف الثاني بتنفيذ الأعمال وفق المواصفات الفنية المعتمدة ونطاق الأعمال الموضح في هذا العرض فقط.</li>

    <li>في حال تأخر الدفعات، يحق للطرف الثاني إيقاف الأعمال مؤقتًا دون أي مسؤولية عن التأخير الناتج.</li>

    <li>لا يتحمل الطرف الثاني أي مسؤولية عن الأعطال أو الأضرار الناتجة عن سوء الاستخدام، أو تدخل أطراف غير معتمدة، أو عدم استقرار التيار الكهربائي.</li>

    <li>تكون ولاية القضاء للمحاكم المختصة في المملكة العربية السعودية.</li>

    <li>يُعد هذا العرض لاغيًا في حال عدم توقيعه وسداد الدفعة الأولى خلال مدة سريان العرض.</li>
  </ol>
</div>



<!-- زر طباعة عام -->
<div style="text-align:center; margin-top:10px;">
  <button class="btn-print" onclick="printWithName()">طباعة / حفظ PDF</button>
    <div id="warn_no_data" class="warning" style="display:none;">
      لم يتم العثور على عرض سعر محفوظ في السجل. الرجاء العودة إلى نموذج التسعير وحفظ عرض السعر أولاً.
    </div>
</div>

   
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script src="/public/rkl-map.js"></script>
<script src="/public/rkl-summary.js"></script>



<script>
/* =================================================
   Helper: bind text safely
================================================= */
const bindAll = (selector, value) => {
  document.querySelectorAll(selector).forEach(el => {
    el.textContent =
      (value !== undefined && value !== null && value !== '')
        ? value
        : '—';
  });
};

const bind = (selector, value) => {
  document.querySelectorAll(selector).forEach(el => {
    el.textContent =
      (value !== undefined && value !== null && value !== '')
        ? value
        : '—';
  });
};

/* =================================================
   تحميل عرض السعر من LocalStorage
================================================= */
const quotes = JSON.parse(localStorage.getItem('rkl_quotes') || '[]');
const currentIndex = localStorage.getItem('rkl_current_quote_index');
window.q = quotes[currentIndex ?? quotes.length - 1];


if (!q) {
  alert('لا يوجد عرض سعر لعرضه');
}
/* =================================================
   (1) بيانات العرض العامة
================================================= */
bindAll('.bind_quote_number', q.quoteNumber);
bindAll('.bind_offer_date', q.timestamp?.slice(0, 10));


/* =================================================
   (2) بيانات العميل
================================================= */
bind('.bind_customer_name', q.customerName);
bind('.bind_customer_type', q.customerDetails?.customer_type || '—');
bind('.bind_contact_person', q.customerDetails?.contact_person || '—');
bind('.bind_cr_number', q.customerDetails?.cr_number || '—');
bind('.bind_tax_number', q.customerDetails?.tax_number || '—');
bind('.bind_customer_phone', q.customerDetails?.mobile || q.customerDetails?.phone || '—');
bind('.bind_customer_email', q.customerDetails?.email || '—');

/* =================================================
   (3) عنوان العميل
================================================= */
bind('.bind_city', q.customerDetails?.city || '—');
bind('.bind_district', q.customerDetails?.district || '—');
bind('.bind_street', q.customerDetails?.street || '—');
bind('.bind_building_number', q.customerDetails?.building_no || '—');
bind('.bind_postal_code', q.customerDetails?.postal_code || '—');
bind('.bind_national_address', q.customerDetails?.full_address || '—');

/* =================================================
   (4) بيانات المشروع
================================================= */
bind('.bind_project_name', q.projectName || '—');
bind('.bind_project_location', q.projectLocation || '—');

/* =================================================
   (5) بيانات المصاعد – FINAL STABLE
================================================= */

bind('.bind_brand', q.brandLabel);
bind('.bind_usage', 'Passenger Elevator');

bind('.bind_lifts', q.liftsCount);
bind('.bind_capacity', q.capacity);
bind('.bind_speed', q.speed);

// عدد التوقفات
bind('.bind_stops', q.stops || q.floors);

// الارتفاعات
bind('.bind_fh', q.floorHeight ? q.floorHeight + ' mm' : null);
bind('.bind_th', q.travelHeight ? q.travelHeight + ' mm' : null);

// نظام التركيب
bind('.bind_machine_type', q.machineType || 'MRL – Machine Room Less');

/* =================================================
   EN81: تظليل الصف حسب مواصفات المصعد
================================================= */
function highlightEN81Row() {
  if (!window.q) return;

  // استخراج رقم الحمولة من نص مثل: "kg 630" أو "630 kg"
  const capacity = String(q.capacity || '').replace(/[^\d]/g, '');
  const lifts    = Number(q.liftsCount || 1);

  document.querySelectorAll('#en81-table tr').forEach(row => {
    const rowCap = row.dataset.capacity;
    const countCell = row.querySelector('.en81-count');

    // تنظيف
    row.classList.remove('en81-active');
    if (countCell) countCell.textContent = '0';

    // تطابق الحمولة
    if (rowCap === capacity) {
      row.classList.add('en81-active');
      if (countCell) countCell.textContent = lifts;
    }
  });
}

window.addEventListener('load', highlightEN81Row);


/* =================================================
   (3) البيانات الفنية الرئيسية – ربط نهائي صحيح
================================================= */

bind('.bind_brand', q.brandLabel);                 // ماركة المصعد / النظام

bind('.bind_capacity', q.capacity);               // الحمولة
bind('.bind_speed', q.speed);                     // السرعة
bind('.bind_stops', q.stops);                     // عدد التوقفات
bind('.bind_lifts', q.liftsCount);                // عدد المصاعد
bind('.bind_machine_type', q.machineType);        // نوع الماكينة

bind('.bind_cabin_design', q.cabinDesign);        // تشطيب داخلي
bind('.bind_floor_finish', q.floorFinish);        // أرضية الكابينة

bind('.bind_dim_shaft', q.shaftSize);              // مقاس البئر
bind('.bind_dim_cabin', q.cabinSize);              // مقاس الكابينة

bind('.bind_pit', q.pit);                          // PIT
bind('.bind_oh', q.oh);                            // OH

bind('.bind_fh', q.floorHeight);                   // FH
bind('.bind_th', q.travelHeight);                  // TH



/* =================================================
   Helper: format currency (SAR)
================================================= */
function formatCurrency(value) {
  const v = Number(value) || 0;
  return v.toLocaleString('en-US', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  }) + ' SAR';
}

/* =================================================
   (5 + 6 + 6-1 + 7) الحساب المالي الكامل
================================================= */

// ✅ الإجمالي الشامل القادم من سجل عروض الأسعار
const grandTotal = Number(q.totalWithVat || 0);

// ✅ عدد المصاعد
const units = Number(q.liftsCount || 1);

// ✅ نسبة الضريبة
const vatRate = Number(q.vatRate || 15);

   /* =================================================
   مخطط المقاسات – فك القيم بالأرقام
================================================= */
if (!q.shaftSize) q.shaftSize = "1800 x 1600";


// Cabin: "1100 x 1000"
if (q.cabinSize) {
  const [cw, cd] = q.cabinSize.split('x').map(v => v.trim());
  bind('.bind_cabin_width', cw);
  bind('.bind_cabin_depth', cd);
}

// Shaft: "1800 x 1600"
if (q.shaftSize) {
  const [hw, hd] = q.shaftSize.split('x').map(v => v.trim());
  bind('.bind_shaft_width', hw);
  bind('.bind_shaft_depth', hd);
}


// ✅ السعر قبل الضريبة (عكسي)
const baseSubtotal = grandTotal / (1 + vatRate / 100);




/* ✅ تشغيل أولي */
recalcFinancialSummary();

/* ✅ إعادة الحساب عند أي تعديل */
document.getElementById('adjust_type')?.addEventListener('change', recalcFinancialSummary);
document.getElementById('adjust_value')?.addEventListener('input', recalcFinancialSummary);
</script>


<script>
function renderPricingTable(q) {
  const tbody = document.querySelector("#pricing-table tbody");
  if (!tbody || !q.items) return;

  tbody.innerHTML = "";

  q.items.forEach(item => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${item.description}</td>
      <td style="text-align:center">${item.quantity}</td>
      <td>${item.unitPrice.toLocaleString()} SAR</td>
      <td>${item.total.toLocaleString()} SAR</td>
    `;
    tbody.appendChild(tr);
  });

  document.querySelector(".bind_subtotal").textContent =
    q.subtotal.toLocaleString() + " SAR";

  document.querySelector(".bind_vat").textContent =
    q.vatAmount.toLocaleString() + " SAR";

  document.querySelector(".bind_total").textContent =
    q.totalWithVat.toLocaleString() + " SAR";
}
</script>
<script>
function renderPayments(q) {
  const tbody = document.querySelector("#payments-table tbody");
  if (!tbody || !q.payments) return;

  tbody.innerHTML = "";

  q.payments.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.label}</td>
      <td style="text-align:center">${p.percent}%</td>
      <td>${p.amount.toLocaleString()} SAR</td>
    `;
    tbody.appendChild(tr);
  });
}
</script>


<script>
function syncEditableFieldsToStorage() {
  const index = localStorage.getItem('rkl_current_quote_index');
  if (index === null) return;

  const quotes = JSON.parse(localStorage.getItem('rkl_quotes') || '[]');
  const q = quotes[index];
  if (!q) return;

  // ✅ البيانات المعدلة يدويًا
  q.brandLabel   = document.querySelector('.bind_brand')?.textContent?.trim() || q.brandLabel;
  q.capacity     = document.querySelector('.bind_capacity')?.textContent?.trim() || q.capacity;
  q.speed        = document.querySelector('.bind_speed')?.textContent?.trim() || q.speed;
  q.floors       = document.querySelector('.bind_floors')?.textContent?.trim() || q.floors;
  q.cabinSize    = document.querySelector('.bind_dim_cabin')?.textContent?.trim() || q.cabinSize;
  q.shaftSize    = document.querySelector('.bind_dim_shaft')?.textContent?.trim() || q.shaftSize;
  q.pit          = document.querySelector('.bind_pit')?.textContent?.trim() || q.pit;
  q.oh           = document.querySelector('.bind_oh')?.textContent?.trim() || q.oh;

  quotes[index] = q;
  localStorage.setItem('rkl_quotes', JSON.stringify(quotes));
}
</script>


<script>
function printWithName() {
  syncEditableFieldsToStorage();

  const quoteNo = document.querySelector('.bind_quote_number')?.textContent?.trim() || 'quotation';
  const cleanNo = quoteNo.replace(/[^\w\d-]/g, '');

  document.title = `RKL_Quotation_${cleanNo}`;
  window.print();

  setTimeout(() => {
    document.title = 'RKL Elevator Offer';
  }, 1000);
}

</script>



<script>
/* ===============================
   أدوات مساعدة
===============================*/
function formatSAR(v){
  return 'SAR ' + (Number(v)||0).toLocaleString('en-US',{
    minimumFractionDigits:2,
    maximumFractionDigits:2
  });
}

/* ===============================
   إعادة حساب البنود + الدفعات
===============================*/
function recalcPricing(){
  const rows = document.querySelectorAll('#items-table tbody tr');
  let subtotal = 0;

  rows.forEach(row=>{
    const qty  = row.querySelector('.qty');
    const unit = row.querySelector('.unit');
    const totalCell = row.querySelector('.row-total');

    if(!qty || !unit || !totalCell) return;

    const rowTotal = (Number(qty.value)||0) * (Number(unit.value)||0);
    totalCell.textContent = rowTotal.toFixed(2);
    subtotal += rowTotal;
  });

  // إجمالي جدول البنود
  document.getElementById('itemsSubtotal').textContent = formatSAR(subtotal);

  // التعديل قبل الضريبة
  const adjTypeEl = document.getElementById('adjustmentType');
  const adjValEl  = document.getElementById('adjustmentValue');

  let adjAmount = 0;
  if(adjTypeEl && adjValEl){
    const adjVal = Number(adjValEl.value||0);
    if(adjTypeEl.value === 'discount') adjAmount = -adjVal;
    if(adjTypeEl.value === 'increase') adjAmount =  adjVal;
  }

  const afterAdj = subtotal + adjAmount;
  const vat      = afterAdj * 0.15;
  const total    = afterAdj + vat;

  // ربط جدول الدفعات
  document.querySelector('.subtotalBefore').textContent = formatSAR(subtotal);
  document.querySelector('.adjustmentAmount').textContent = formatSAR(adjAmount);
  document.querySelector('.subtotalAfter').textContent = formatSAR(afterAdj);
  document.querySelector('.vatAmount').textContent = formatSAR(vat);
  document.querySelector('.grandTotal').textContent = formatSAR(total);

  document.querySelector('.pay50').textContent = formatSAR(total * 0.50);
  document.querySelector('.pay25').textContent = formatSAR(total * 0.25);
  document.querySelector('.pay20').textContent = formatSAR(total * 0.20);
  document.querySelector('.pay5').textContent  = formatSAR(total * 0.05);
}

/* ===============================
   إضافة بند إضافي
===============================*/
function addExtraRow(){
  const tbody = document.querySelector('#items-table tbody');
  const tr = document.createElement('tr');

  tr.innerHTML = `
    <td contenteditable="true">بند إضافي</td>
    <td><input type="number" class="qty" value="1" min="1"></td>
    <td><input type="number" class="unit" value="0" min="0"></td>
    <td class="row-total">0.00</td>
    <td style="text-align:center">
      <button onclick="this.closest('tr').remove();recalcPricing()">✖</button>
    </td>
  `;

  tbody.appendChild(tr);
  recalcPricing();
}

/* ===============================
   مراقبة التغييرات
===============================*/
document.addEventListener('input',e=>{
  if(
    e.target.closest('#items-table') ||
    e.target.id === 'adjustmentType' ||
    e.target.id === 'adjustmentValue'
  ){
    recalcPricing();
  }
});

/* ===============================
   تعبئة البند الرئيسي تلقائيًا
===============================*/
window.addEventListener('load', () => {

  if (!window.q) return;

  const quoteNumber = q.quoteNumber || '—';
  const liftsCount  = Number(q.liftsCount || 1);

  const priceBeforeVat =
    q.totalBeforeVat
      ? Number(q.totalBeforeVat)
      : (Number(q.totalWithVat || 0) / 1.15);

  const firstRow = document.querySelector('#items-table tbody tr:first-child');
  if (!firstRow) return;

  const desc = firstRow.querySelector('td[contenteditable]');
  const qty  = firstRow.querySelector('.qty');
  const unit = firstRow.querySelector('.unit');

  if (desc) {
    desc.textContent =
`توريد وتركيب وتشغيل مصعد/مصاعد كهربائية

اسم المشروع: ${q.projectName || '—'}
موقع المشروع: ${q.projectLocation || '—'}
رقم عرض السعر: ${quoteNumber}

نوع المصعد: ${q.brandLabel || '—'}
الحمولة الاسمية: ${q.capacity || '—'}
عدد الأدوار / التوقفات: ${q.stops || q.floors || '—'}

حسب المواصفات الفنية المعتمدة والواردة في هذا العرض.`;
  }

  if (qty)  qty.value  = liftsCount;
  if (unit) unit.value = priceBeforeVat.toFixed(2);

  recalcPricing();
});

</script>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const index = localStorage.getItem('rkl_current_quote_index');
  if (index === null) return;

  const quotes = JSON.parse(localStorage.getItem('rkl_quotes') || '[]');
  const q = quotes[index];
  if (!q) return;

  // تعبئة جدول EN81
  document.querySelectorAll('[data-bind]').forEach(el => {
    const key = el.getAttribute('data-bind');
    if (q[key] !== undefined && q[key] !== null && q[key] !== '') {
      el.textContent = q[key];
    }
  });

});
</script>

<style>
/* ===============================
   PRINT STYLE – OFFICIAL RKL
=============================== */
@media print {

  /* لون الورقة */
  body {
    background: #f5f1e6 !important; /* بني فاتح رسمي */
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* خلفية الشعار */
  body::before {
    content: "";
    position: fixed;
    top: 50%;
    left: 50%;
    width: 420px;
    height: 420px;
    background: url("/public/images/logo.png") no-repeat center center;
    background-size: contain;
    opacity: 0.06; /* شفافية راقية */
    transform: translate(-50%, -50%);
    z-index: 0;
    pointer-events: none;
  }

  /* تأكيد أن المحتوى فوق الخلفية */
  .page,
  .print-page,
  table,
  div,
  section {
    position: relative;
    z-index: 1;
    background: transparent !important;
  }

  /* منع أي فواصل صفحات غير مرغوبة */
  .en81-grid,
  .tech-table,
  .plan-view,
  .section-view,
  .print-footer {
    page-break-inside: avoid;
  }

}
</style>


</body>
</html>






































